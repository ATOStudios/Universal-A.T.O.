<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal A.T.O. V6.3.1a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Space Grotesk -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            cursor: crosshair;
        }
        canvas {
            display: block;
            outline: none;
            width: 100% !important;
            height: 100% !important;
        }
        
        /* --- Gƒ∞Rƒ∞≈û EKRANI (LANDING PAGE) --- */
        #landing-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Daha canlƒ± ve yƒ±ldƒ±zlƒ± bir arka plan */
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=2011&auto=format&fit=crop') no-repeat center center/cover;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            /* Transition JS ile y√∂netilecek classlar i√ßin */
        }

        /* Sinematik √áƒ±kƒ±≈ü Animasyonu */
        @keyframes warpOutEffect {
            0% {
                opacity: 1;
                transform: scale(1);
                filter: blur(0px) brightness(1);
            }
            40% {
                opacity: 0.8;
                transform: scale(1.1);
                filter: blur(2px) brightness(1.5);
            }
            100% {
                opacity: 0;
                transform: scale(3); /* Kameranƒ±n i√ßine giriyormu≈ü hissi */
                filter: blur(20px) brightness(3); /* I≈üƒ±k patlamasƒ± */
            }
        }

        .warp-out {
            animation: warpOutEffect 1.5s cubic-bezier(0.7, 0, 0.3, 1) forwards;
            pointer-events: none; /* Tƒ±klamalarƒ± engelle */
        }
        
        .landing-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 6rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 10px;
            /* B√ºy√ºk harf zorunluluƒüu kaldƒ±rƒ±ldƒ± */
            text-transform: none; 
            background: linear-gradient(to bottom right, #ffffff, #93c5fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 50px rgba(59, 130, 246, 0.6);
            z-index: 10;
            text-align: center;
        }

        .landing-subtitle {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.1rem;
            color: #cbd5e1;
            letter-spacing: 1px;
            margin-bottom: 60px;
            text-align: center;
            max-width: 800px;
            z-index: 10;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        .enter-btn {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.5);
            color: #60a5fa;
            padding: 16px 48px;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Space Grotesk', sans-serif;
            text-transform: uppercase;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
            z-index: 10;
        }
        
        .enter-btn:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.8);
            transform: translateY(-2px) scale(1.05);
        }

        .landing-footer {
            position: absolute;
            bottom: 30px;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.8rem;
            color: #64748b;
            z-index: 10;
            letter-spacing: 1px;
        }

        /* --- Y√úKLEME EKRANI --- */
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            z-index: 100;
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 80px rgba(59, 130, 246, 0.4);
            pointer-events: none;
            transition: opacity 0.8s ease;
            display: none; 
            font-family: 'Space Grotesk', sans-serif;
        }

        .game-ui {
            opacity: 0;
            transition: opacity 2s ease; /* Daha yumu≈üak ge√ßi≈ü */
            pointer-events: none;
        }
        .game-ui.active {
            opacity: 1;
            pointer-events: auto;
        }

        .ui-overlay {
            position: absolute;
            bottom: 30px;
            left: 30px;
            color: rgba(255, 255, 255, 0.95);
            pointer-events: none;
            z-index: 5;
            text-shadow: 0 2px 10px rgba(0,0,0,1);
        }

        .credits-text {
            font-size: 0.7rem;
            color: #60a5fa;
            opacity: 0.8;
            margin-top: 5px;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }

        /* --- ZAMAN SAYACI --- */
        #cosmic-date {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Courier New', monospace;
            color: #fbbf24;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 5;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
            pointer-events: none;
        }

        /* --- OLAY Bƒ∞LDƒ∞Rƒ∞Mƒ∞ --- */
        #event-notification {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 60;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .event-title {
            font-size: 2rem;
            font-weight: 900;
            color: #ef4444;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.8);
            margin-bottom: 5px;
        }
        .event-desc {
            font-size: 1rem;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.7);
            padding: 5px 15px;
            border-radius: 5px;
        }

        #time-control-btn {
            position: absolute;
            top: 20px; 
            left: 360px; 
            background: rgba(16, 185, 129, 0.8);
            color: white;
            padding: 8px 24px;
            border-radius: 8px;
            border: 1px solid #34d399;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            z-index: 40;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            pointer-events: auto;
            height: 30px;
            font-size: 0.8rem;
        }
        #time-control-btn:hover {
            transform: scale(1.05);
            background: rgba(16, 185, 129, 1);
        }
        #time-control-btn.paused {
            background: rgba(245, 158, 11, 0.8);
            border-color: #fbbf24;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
        }

        /* --- √áARPI≈ûMA BUTONU --- */
        #collision-btn {
            position: absolute;
            top: 60px; 
            left: 360px;
            background: rgba(220, 38, 38, 0.8);
            color: white;
            padding: 8px 24px;
            border-radius: 8px;
            border: 1px solid #f87171;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            z-index: 40;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.4);
            display: none; 
            align-items: center;
            gap: 8px;
            pointer-events: auto;
            height: 30px;
            font-size: 0.8rem;
        }
        #collision-btn:hover {
            transform: scale(1.05);
            background: rgba(220, 38, 38, 1);
        }

        /* --- FREECAM BUTONU --- */
        #freecam-btn {
            position: absolute;
            top: 100px;
            left: 360px;
            background: rgba(59, 130, 246, 0.8);
            color: white;
            padding: 8px 24px;
            border-radius: 8px;
            border: 1px solid #3b82f6;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            z-index: 40;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            pointer-events: auto;
            height: 30px;
            font-size: 0.8rem;
        }
        #freecam-btn:hover {
            transform: scale(1.05);
            background: rgba(59, 130, 246, 1);
        }
        #freecam-btn.active {
            background: rgba(37, 99, 235, 1);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
            border-color: #93c5fd;
        }


        
        

        /* --- Dƒ∞L SE√áƒ∞Cƒ∞ --- */
        .lang-container {
            position: absolute;
            top: 20px;
            right: 400px; /* AI panelinin solunda */
            z-index: 50;
        }
        .lang-btn {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .lang-btn:hover {
            background: #334155;
            color: white;
        }
        .lang-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 5px;
            display: none;
            flex-direction: column;
            width: 120px;
            backdrop-filter: blur(5px);
        }
        .lang-dropdown.show {
            display: flex;
        }
        .lang-option {
            padding: 8px 12px;
            color: #cbd5e1;
            cursor: pointer;
            font-size: 0.8rem;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .lang-option:hover {
            background: rgba(59, 130, 246, 0.3);
            color: white;
        }

        /* --- GRAFƒ∞K AYARLARI --- */
        .graphics-container {
            position: absolute;
            top: 70px; /* Dil butonunun altƒ±nda */
            right: 400px;
            z-index: 50;
        }
        .graphics-btn {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .graphics-btn:hover {
            background: #334155;
            color: white;
        }
        .graphics-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 5px;
            display: none;
            flex-direction: column;
            width: 120px;
            backdrop-filter: blur(5px);
        }
        .graphics-dropdown.show {
            display: flex;
        }
        .graphics-option {
            padding: 8px 12px;
            color: #cbd5e1;
            cursor: pointer;
            font-size: 0.8rem;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .graphics-option:hover {
            background: rgba(59, 130, 246, 0.3);
            color: white;
        }

        .planet-label {
            position: absolute;
            color: rgba(255, 255, 255, 0.8);
            font-size: 10px;
            font-family: 'Courier New', monospace;
            font-weight: normal;
            pointer-events: none;
            text-shadow: 0 0 2px #000;
            transform: translate(-50%, -200%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 2;
            padding: 1px 4px;
        }

        .galaxy-label {
            position: absolute;
            color: #60a5fa;
            font-size: 11px;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: bold;
            pointer-events: auto;
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.8);
            transform: translate(-50%, -250%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        #reset-view-btn {
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(220, 38, 38, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            border: 1px solid #f87171;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            z-index: 50;
            display: none;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
            pointer-events: auto;
        }
        #reset-view-btn:hover {
            background: rgba(239, 68, 68, 1);
            transform: translateX(-50%) scale(1.05);
        }

        .galaxy-selector {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 300px;
            background: rgba(8, 12, 25, 0.95);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 15px;
            z-index: 20;
            font-family: 'Courier New', monospace;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            max-height: 400px;
            display: flex;
            flex-direction: column;
            pointer-events: auto;
        }

        .selector-header {
            color: #60a5fa;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .galaxy-list {
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 10px;
            padding-right: 5px;
        }

        .galaxy-list::-webkit-scrollbar { width: 4px; }
        .galaxy-list::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 2px; }
        .galaxy-list::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }

        .galaxy-item {
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .galaxy-item:hover {
            background: rgba(59, 130, 246, 0.2);
            padding-left: 15px;
        }

        .galaxy-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.3), transparent);
            border-left: 3px solid #60a5fa;
            color: white;
        }

        .galaxy-name {
            font-weight: bold;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .galaxy-type {
            font-size: 0.7rem;
            color: #94a3b8;
        }

        .create-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
            transition: 0.3s;
            margin-top: auto;
        }

        .create-btn:hover {
            background: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
        }

        .scanner-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(150%);
            width: 320px;
            background: rgba(10, 15, 30, 0.9);
            border-top: 4px solid #3b82f6;
            padding: 20px;
            font-family: 'Courier New', Courier, monospace;
            color: #93c5fd;
            backdrop-filter: blur(10px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
            border-radius: 8px;
            z-index: 25;
        }

        .scanner-panel.active {
            transform: translateX(-50%) translateY(0);
        }

        .click-hint {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(37, 99, 235, 0.8);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            white-space: nowrap;
        }
        
        .scanner-panel.clickable .click-hint {
            opacity: 1;
        }

        .scanner-line {
            height: 2px;
            width: 100%;
            background: #3b82f6;
            margin: 8px 0;
            box-shadow: 0 0 15px #3b82f6;
            animation: scanAnim 0.8s infinite alternate;
        }

        @keyframes scanAnim {
            from { width: 5%; opacity: 0.3; }
            to { width: 100%; opacity: 1; }
        }

        .ai-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 350px;
            background: rgba(10, 10, 25, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 20px;
            color: white;
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            z-index: 10;
        }

        .ai-btn {
            position: relative;
            border: 2px solid #3b82f6;
            border-radius: 10px;
            padding: 0;
            width: 100%;
            height: 60px;
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(37, 99, 235, 0.5);
            transition: all 0.3s;
            background-color: #000;
            margin-bottom: 15px;
        }

        .btn-bg-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 20%;
            opacity: 0.4;
            z-index: 0;
            transition: transform 0.5s ease, opacity 0.3s;
        }

        .btn-content {
            position: relative;
            z-index: 1;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: white;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-size: 1.0rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.9);
        }

        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.8);
            border-color: #60a5fa;
        }

        .ai-btn:hover .btn-bg-img {
            transform: scale(1.1);
            opacity: 0.6;
        }

        .story-content {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #bfdbfe;
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 15px;
            margin-top: 10px;
        }
        
        #cinematic-mode {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid red;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            letter-spacing: 2px;
            display: none;
            animation: pulseRed 2s infinite;
        }
        
        @keyframes pulseRed {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        /* Modern GUI Styles */
        .lil-gui { 
            --background-color: rgba(15, 23, 42, 0.85);
            --text-color: #e2e8f0;
            --title-background-color: rgba(30, 41, 59, 0.9);
            --widget-color: #334155;
            --hover-color: #475569;
            --focus-color: #3b82f6;
            --number-color: #60a5fa;
            --string-color: #93c5fd;
            font-family: 'Space Grotesk', sans-serif;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .lil-gui.root {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 320px;
            --width: 320px;
            z-index: 100;
        }
        .lil-gui .title {
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #60a5fa;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            height: 36px;
            line-height: 36px;
        }
        
        .sub-info {
            font-size: 0.65rem;
            color: #4ade80;
            margin-top: 2px;
            display: none;
        }
        .galaxy-item.active .sub-info {
            display: block;
        }
    </style>
</head>
<body>

    <!-- Gƒ∞Rƒ∞≈û EKRANI (LANDING PAGE) -->
    <div id="landing-page">
        <div class="landing-title">Universal A.T.O.</div>
        <div class="landing-subtitle">Evrensel Astronomik Y√∂r√ºnge Operasyon V6.2.1a sistemine ho≈ü geldiniz.</div>
        <button class="enter-btn" onclick="enterSimulation()">EVRENE DALI≈û YAP!</button>
        <button class="enter-btn" style="margin-top: 15px; font-size: 0.8rem; padding: 10px 30px; background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: #ccc;" onclick="openScenarioModal()">SENARYOLAR</button>
        <div class="landing-footer">ALPHA VERSION | made by BatusIzmm and Malalea</div>
    </div>

    <div id="event-horizon-overlay"></div>

    <!-- Y√úKLEME EKRANI -->
    <div id="loading">
        <div class="text-5xl font-black mb-4 text-blue-500 tracking-tighter" style="filter: drop-shadow(0 0 10px rgba(59,130,246,0.5));">MULTIVERSE V6.2.0</div>
        <div class="text-sm text-blue-200 animate-pulse font-mono" id="loading-text">
            >> Evrensel √áeviri Mod√ºl√º Aktif...<br>
            >> Sistem hazƒ±r.
        </div>
    </div>

    <!-- UI ELEMENTLERƒ∞ (Ba≈ülangƒ±√ßta gizli 'game-ui' sƒ±nƒ±fƒ± ile) -->
    <div class="game-ui">
        <!-- Dƒ∞L SE√áƒ∞Cƒ∞ -->
        <div class="lang-container">
            <div class="lang-btn" onclick="document.querySelector('.lang-dropdown').classList.toggle('show')">
                <i class="fas fa-globe"></i>
            </div>
            <div class="lang-dropdown">
                <div class="lang-option" onclick="changeLanguage('tr')">üáπüá∑ T√ºrk√ße</div>
                <div class="lang-option" onclick="changeLanguage('en')">üá¨üáß English</div>
                <div class="lang-option" onclick="changeLanguage('fr')">üá´üá∑ Fran√ßais</div>
                <div class="lang-option" onclick="changeLanguage('de')">üá©üá™ Deutsch</div>
                <div class="lang-option" onclick="changeLanguage('ja')">üáØüáµ Êó•Êú¨Ë™û</div>
                <div class="lang-option" onclick="changeLanguage('es')">üá™üá∏ Espa√±ol</div>
            </div>
        </div>

        <!-- GRAFƒ∞K AYARLARI -->
        <div class="graphics-container">
            <div class="graphics-btn" onclick="document.querySelector('.graphics-dropdown').classList.toggle('show')">
                <i class="fas fa-desktop"></i>
            </div>
            <div class="graphics-dropdown">
                <div class="graphics-option" onclick="setGraphicsQuality('low')">Low</div>
                <div class="graphics-option" onclick="setGraphicsQuality('medium')">Medium</div>
                <div class="graphics-option" onclick="setGraphicsQuality('high')">High</div>
                <div class="graphics-option" onclick="setGraphicsQuality('extreme')">Extreme</div>
            </div>
        </div>

        <!-- KOZMƒ∞K TARƒ∞H -->
        <div id="cosmic-date">YIL: 3024</div>

        <!-- OLAY Bƒ∞LDƒ∞Rƒ∞Mƒ∞ -->
        <div id="event-notification">
            <div class="event-title" id="event-title">S√úPERNOVA</div>
            <div class="event-desc" id="event-desc">Yakƒ±n sistemlerde b√ºy√ºk patlama tespit edildi.</div>
        </div>

        <div id="cinematic-mode">WARP S√úR√úC√úS√ú AKTƒ∞F</div>
        
        <div id="time-control-btn" onclick="toggleTime()">
            <span id="time-icon">‚ùö‚ùö</span> <span id="time-text">ZAMANI DURDUR</span>
        </div>
        
        <div id="scenario-btn" onclick="openScenarioModal()" style="position: absolute; top: 140px; left: 360px; background: rgba(124, 58, 237, 0.8); color: white; padding: 8px 24px; border-radius: 8px; border: 1px solid #a78bfa; cursor: pointer; font-weight: bold; letter-spacing: 1px; z-index: 40; transition: all 0.3s; box-shadow: 0 0 15px rgba(124, 58, 237, 0.4); display: flex; align-items: center; gap: 8px; pointer-events: auto; height: 30px; font-size: 0.8rem;">
            <span>‚òÖ</span> <span>SENARYOLAR</span>
        </div>

        <div id="collision-btn" onclick="triggerManualCollision()">
            ‚ö† √áARPI≈ûMA BA≈ûLAT
        </div>

        <div id="freecam-btn" onclick="toggleFreeCam()">
            üì∑ SERBEST KAMERA
        </div>

        <div id="reset-view-btn" onclick="resetCameraView()">ROTAYI SIFIRLA / GERƒ∞ D√ñN</div>

        <div class="ui-overlay">
            <h1 class="text-6xl font-black text-white mb-2 tracking-tighter" style="text-shadow: 0 0 30px rgba(37, 99, 235, 0.8);" id="ui-title">EVREN AƒûI</h1>
            <p class="text-blue-300 text-sm tracking-[0.3em] uppercase font-bold pl-1" id="current-galaxy-name">GALAKSƒ∞: ALPHA-1</p>
            <p class="credits-text">made by BatusIzmm and Malalea</p>
        </div>

        <div id="scanner" class="scanner-panel">
            <div class="click-hint" id="scanner-warp-hint">WARP ƒ∞√áƒ∞N TIKLA</div>
            <div class="text-[10px] uppercase text-blue-400 mb-2 font-bold tracking-widest" id="scan-status-text">Hedef Kilitlendi</div>
            <div class="text-xl font-bold mb-2 text-white" id="scan-target">Sƒ∞STEM</div>
            <div class="scanner-line"></div>
            <div class="grid grid-cols-2 gap-3 text-xs mt-3">
                <div><span id="label-class">SINIF</span>: <span id="scan-class" class="text-white font-bold">G-Tipi</span></div>
                <div><span id="label-temp">ISI</span>: <span id="scan-temp" class="text-white font-bold">5700K</span></div>
                <div><span id="label-dist">UZAKLIK</span>: <span id="scan-dist" class="text-blue-300 font-bold">12 IY</span></div>
                <div><span id="label-status">DURUM</span>: <span id="scan-life" class="text-green-400 font-bold">Stabil</span></div>
            </div>
        </div>

        <div class="galaxy-selector">
            <div class="selector-header">
                <span id="nav-title">Navigasyon</span>
                <span style="font-size:0.7em; opacity:0.7">ONLINE</span>
            </div>
            <div class="galaxy-list" id="galaxy-list"></div>
            <button class="create-btn" id="create-btn" onclick="createNewGalaxy()">+ Yeni Evren Ke≈üfet</button>
        </div>

        <div class="ai-panel">
            <button id="generate-btn" class="ai-btn" onclick="generateStory()">
                <img src="https://i.imgur.com/nxUt8iu.jpeg" alt="CJ" class="btn-bg-img" referrerpolicy="no-referrer">
                <span class="btn-content" id="ai-btn-text">
                    <span>‚ú¶</span> Kozmik Analiz Ba≈ülat
                </span>
            </button>
            <div id="story-title" class="font-bold text-pink-400 mb-2 hidden uppercase tracking-wide">G√∂rev Raporu</div>
            <div id="story-output" class="story-content text-gray-300 text-sm">
                Se√ßili galaksinin verilerini analiz etmek i√ßin butona tƒ±kla.
            </div>
        </div>
    </div>

    <!-- --- SHADERS --- -->
    <script id="planet-vertex" type="x-shader/x-vertex">
        varying vec2 vUv; varying vec3 vNormal; varying vec3 vPosition;
        void main() { vUv = uv; vNormal = normalize(normalMatrix * normal); vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }
    </script>
    <script id="planet-terrestrial-fragment" type="x-shader/x-fragment">
        uniform float uTime; uniform vec3 uColor1; uniform vec3 uColor2; varying vec2 vUv; varying vec3 vNormal; varying vec3 vPosition; 
        vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
        float snoise(vec2 v){ const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439); vec2 i  = floor(v + dot(v, C.yy) ); vec2 x0 = v -   i + dot(i, C.xx); vec2 i1; i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0); vec4 x12 = x0.xyxy + C.xxzz; x12.xy -= i1; i = mod(i, 289.0); vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 )); vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0); m = m*m ; m = m*m ; vec3 x = 2.0 * fract(p * C.www) - 1.0; vec3 h = abs(x) - 0.5; vec3 ox = floor(x + 0.5); vec3 a0 = x - ox; m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h ); vec3 g; g.x  = a0.x  * x0.x  + h.x  * x0.y; g.yz = a0.yz * x12.xz + h.yz * x12.yw; return 130.0 * dot(m, g); }
        void main() { vec3 lightDir = normalize(vec3(1.0, 0.5, 1.0)); float diff = max(dot(vNormal, lightDir), 0.0); float ambient = 0.1; float n = snoise(vUv * 4.0 + vec2(uTime * 0.01, 0.0)); float n2 = snoise(vUv * 12.0); float combined = n + n2 * 0.5; vec3 col = mix(uColor1, uColor2, step(0.1, combined)); float coast = smoothstep(0.05, 0.1, combined) - smoothstep(0.1, 0.15, combined); col = mix(col, vec3(0.9, 0.9, 0.7), coast * 0.5); vec3 viewDir = normalize(-vPosition); float rim = 1.0 - max(dot(vNormal, vec3(0,0,1)), 0.0); rim = pow(rim, 4.0); vec3 atmosphere = vec3(0.4, 0.6, 1.0) * rim; gl_FragColor = vec4((col * (diff + ambient)) + atmosphere, 1.0); }
    </script>
    <script id="planet-gas-fragment" type="x-shader/x-fragment">
        uniform float uTime; uniform vec3 uColor1; uniform vec3 uColor2; varying vec2 vUv; varying vec3 vNormal; float noise(vec2 p) { return sin(p.x * 10.0 + p.y * 10.0); }
        void main() { vec3 lightDir = normalize(vec3(1.0, 0.5, 1.0)); float diff = max(dot(vNormal, lightDir), 0.0); float ambient = 0.15; float bands = sin(vUv.y * 20.0 + sin(vUv.x * 5.0 + uTime * 0.2) * 0.5); float fine = sin(vUv.y * 100.0 + uTime) * 0.1; vec3 col = mix(uColor1, uColor2, bands * 0.5 + 0.5 + fine); float eye = 1.0 - length(vUv - vec2(0.6, 0.4)); if(eye > 0.95) col = mix(col, vec3(0.8, 0.3, 0.2), 0.5); gl_FragColor = vec4(col * (diff + ambient), 1.0); }
    </script>
    <script id="planet-rock-fragment" type="x-shader/x-fragment">
        uniform float uTime; uniform vec3 uColor1; uniform vec3 uColor2; uniform float uLava; uniform float uAtmosphere; varying vec2 vUv; varying vec3 vNormal; varying vec3 vPosition; float rand(vec2 co){ return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453); }
        void main() { vec3 lightDir = normalize(vec3(1.0, 0.5, 1.0)); float diff = max(dot(vNormal, lightDir), 0.0); float n = rand(floor(vUv * 50.0)); vec3 col = mix(uColor1, uColor2, n); vec3 emissive = vec3(0.0); if(uLava > 0.5) { float lavaPath = sin(vUv.x * 20.0 + uTime * 0.5) * cos(vUv.y * 20.0 + uTime * 0.2); if(lavaPath > 0.5) { col = vec3(1.0, 0.3, 0.0); emissive = vec3(0.8, 0.2, 0.0); } } vec3 atmosphere = vec3(0.0); if(uAtmosphere > 0.0) { float rim = 1.0 - max(dot(vNormal, vec3(0,0,1)), 0.0); rim = pow(rim, 3.0); atmosphere = vec3(0.5, 0.7, 1.0) * rim * uAtmosphere; } gl_FragColor = vec4((col * (diff + 0.1) + emissive) + atmosphere, 1.0); }
    </script>
    <script id="lensing-vertex" type="x-shader/x-vertex">varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }</script>
    <script id="lensing-fragment" type="x-shader/x-fragment">uniform float uTime; uniform vec3 uColor; varying vec2 vUv; void main() { vec2 center = vec2(0.5, 0.5); vec2 pos = vUv - center; float dist = length(pos); float angle = atan(pos.y, pos.x); float radius = 0.25; float thickness = 0.03; float wave = sin(angle * 6.0 + uTime * 2.0) * 0.01 + sin(angle * 13.0 - uTime * 4.0) * 0.005; float ring = 1.0 - smoothstep(thickness, thickness + 0.02, abs(dist - radius + wave)); float glow = 0.015 / (abs(dist - radius + wave) + 0.01); float coreDarkness = smoothstep(0.18, 0.22, dist); vec3 finalColor = uColor * (ring * 4.0 + glow * 1.0); float alpha = (ring + glow) * coreDarkness; if(dist < 0.21) alpha = 0.0; gl_FragColor = vec4(finalColor, alpha); }</script>
    <script id="jet-vertex" type="x-shader/x-vertex">varying vec2 vUv; varying vec3 vPos; void main() { vUv = uv; vPos = position; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }</script>
    <script id="jet-fragment" type="x-shader/x-fragment">uniform float uTime; uniform vec3 uColor; uniform float uIntensity; uniform float uSpeed; varying vec2 vUv; varying vec3 vPos; void main() { float fade = 1.0 - smoothstep(0.0, 1.0, abs(vUv.y - 0.5) * 2.0); float core = 1.0 - smoothstep(0.0, 0.6, abs(vUv.x - 0.5) * 2.0); float energy = sin(vPos.y * 2.0 - uTime * uSpeed * 20.0) * 0.5 + 0.5; float noise = sin(vPos.y * 10.0 + uTime * uSpeed * 30.0) * 0.2; vec3 coreColor = mix(uColor, vec3(1.0), core * 0.8); vec3 finalColor = coreColor * (core * uIntensity + energy * 0.5 + noise); float alpha = core * fade * 0.9; gl_FragColor = vec4(finalColor, alpha); }</script>
    <script id="chromatic-aberration-fragment" type="x-shader/x-fragment">uniform sampler2D tDiffuse; uniform float uAmount; varying vec2 vUv; void main() { vec2 dist = vUv - 0.5; vec2 offset = uAmount * dist; float r = texture2D(tDiffuse, vUv + offset).r; float g = texture2D(tDiffuse, vUv).g; float b = texture2D(tDiffuse, vUv - offset).b; gl_FragColor = vec4(r, g, b, 1.0); }</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.17.0/dist/lil-gui.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/utils/BufferGeometryUtils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>

    <script>
        const themes = {
            'Varsayƒ±lan': { in: '#ff6030', out: '#1b3984' },
            'Cehennem': { in: '#ff0000', out: '#ffaa00' },
            'Buzul': { in: '#00ffff', out: '#ffffff' },
            'Zehirli': { in: '#00ff00', out: '#ccff00' },
            'Mistik': { in: '#ff00ff', out: '#0000ff' },
            'Karanlƒ±k': { in: '#8b5cf6', out: '#000000' }
        };

        // --- √áEVƒ∞Rƒ∞ Sƒ∞STEMƒ∞ ---
        const translations = {
            tr: {
                landing_title: "Universal A.T.O.",
                landing_btn: "EVRENE DALI≈û YAP!",
                landing_subtitle: "Evrensel Astronomik Y√∂r√ºnge Operasyon V6.2.1a sistemine ho≈ü geldiniz.",
                loading: ">> √áeviri Mod√ºl√º Aktif...<br>>> Sistem hazƒ±r.",
                landing_support: "Destek Ol",
                landing_github: "GitHub",
                landing_report: "Bildir",
                bug_modal_title: "Hata Bildir",
                bug_email_ph: "E-posta Adresiniz",
                bug_subject_ph: "Konu Ba≈ülƒ±ƒüƒ±",
                bug_text_ph: "Hata detaylarƒ±nƒ± buraya yazƒ±n...",
                bug_cancel: "ƒ∞ptal",
                bug_send: "G√∂nder",
                bug_alert_empty: "L√ºtfen t√ºm alanlarƒ± doldurun.",
                bug_alert_success: "Hata raporunuz ba≈üarƒ±yla g√∂nderildi! Te≈üekk√ºrler.",
                title: "EVREN AƒûI",
                galaxy_label: "GALAKSƒ∞:",
                nav_title: "Navigasyon",
                new_univ_btn: "+ YENƒ∞ EVREN KE≈ûFET",
                warp_btn: "WARP ƒ∞√áƒ∞N TIKLA",
                scan_locked: "HEDEF Kƒ∞Lƒ∞TLENDƒ∞",
                scan_system: "Sƒ∞STEM",
                lbl_class: "SINIF",
                lbl_temp: "ISI",
                lbl_dist: "UZAKLIK",
                lbl_status: "DURUM",
                status_stable: "Stabil",
                status_unknown: "Bilinmiyor",
                status_analyze: "Analiz Gerekli",
                ai_btn: "<span>‚ú¶</span> Kozmik Analiz Ba≈ülat",
                ai_analyzing: "<span>üì°</span> Analiz Ediliyor...",
                ai_report: "G√∂rev Raporu",
                ai_desc: "Se√ßili galaksinin verilerini analiz etmek i√ßin butona tƒ±kla.",
                time_stop: "ZAMANI DURDUR",
                time_start: "ZAMANI BA≈ûLAT",
                collision_btn: "‚ö† √áARPI≈ûMA BA≈ûLAT",
                freecam_btn: "üì∑ SERBEST KAMERA",
                reset_btn: "ROTAYI SIFIRLA / GERƒ∞ D√ñN",
                year: "YIL",
                planet_types: { "Gaz Dev": "Gaz Devi", "Buzul": "Buzul", "Kayalƒ±k": "Kayalƒ±k", "Okyanus": "Okyanus", "Lav": "Lav", "√á√∂l": "√á√∂l", "Terra": "Terra", "Singularity": "Tekillik", "√ñl√º Gezegen": "√ñl√º Gezegen" },
                galaxy_types: { "Standart": "Standart", "Spiral": "Spiral", "Eliptik": "Eliptik", "Kaotik": "Kaotik", "Quasar Aktif": "Quasar Aktif", "Nebula Yoƒüun": "Nebula Yoƒüun", "Karanlƒ±k Madde": "Karanlƒ±k Madde", "Uydu Galaksi": "Uydu Galaksi", "Kaotik Birle≈üme": "Kaotik Birle≈üme", "Birle≈üik Dev": "Birle≈üik Dev", "N√∂tron Yƒ±ldƒ±zƒ±": "N√∂tron Yƒ±ldƒ±zƒ±" },
                events: {
                    supernova_t: "S√úPERNOVA", supernova_d: "Yƒ±ldƒ±z √ß√∂k√º≈ü√º. Gezegenler yok oluyor.",
                    ice_age_t: "BUZUL √áAƒûI", ice_age_d: "Sistem entropisi d√º≈üt√º. Gezegenler donuyor.",
                    gamma_t: "GAMA I≈ûINI", gamma_d: "Y√ºksek enerji patlamasƒ±. Atmosferler yok oldu.",
                    life_t: "YA≈ûAM BELƒ∞RTƒ∞Sƒ∞", life_d: "Yeni bir d√ºnya doƒüuyor.",
                    collision_t: "GALAKSƒ∞ √áARPI≈ûMASI", collision_d: "K√ºtle √ßekim anomalisi! ƒ∞ki galaksi birle≈üiyor."
                },
                micro_bh: "Mikro Karadelik",
                loc_prefix: "Konum:",
                loc_center: "Merkez Sekt√∂r",
                cinematic_warp: "WARP S√úR√úC√úS√ú AKTƒ∞F:",
                cinematic_route: "ROTA:",
                cinematic_return: "ANA ROTAYA D√ñN√úL√úYOR",
                gui: {
                    folder_struct: "Galaksi Yapƒ±sƒ±",
                    star_count: "Yƒ±ldƒ±z Sayƒ±sƒ±",
                    galaxy_age: "Galaksi Ya≈üƒ± (Milyar Yƒ±l)",
                    radius: "Yarƒ±√ßap",
                    branches: "Kol Sayƒ±sƒ±",
                    spin: "Sarmal Eƒüimi",
                    nebula_op: "Nebula Opaklƒ±ƒüƒ±",
                    dust_op: "Toz Yoƒüunluƒüu",
                    in_color: "ƒ∞√ß Renk",
                    out_color: "Dƒ±≈ü Renk",
                    folder_phys: "Fizik & Olay Ufku",
                    gravity: "Karadelik K√ºtlesi",
                    rot_speed: "Galaktik D√∂n√º≈ü Hƒ±zƒ±",
                    comet_freq: "Kuyruklu Yƒ±ldƒ±z Sƒ±klƒ±ƒüƒ±",
                    folder_quasar: "Quasar Jetleri",
                    jet_len: "Jet Uzunluƒüu",
                    jet_int: "Enerji Yoƒüunluƒüu",
                    jet_spd: "Akƒ±≈ü Hƒ±zƒ±",
                    folder_time: "Zaman Kontrol√º",
                    time_flow: "Evrensel Zaman Akƒ±≈üƒ±",
                    planet_evol: "Gezegen Evrim Hƒ±zƒ±",
                    cinematic: "Sinematik Mod",
                    theme: "Renk Temasƒ±",
                    folder_graphics: "Grafik & Performans",
                    show_fps: "FPS G√∂ster",
                    resolution: "√á√∂z√ºn√ºrl√ºk"
                }
            },
            en: {
                landing_title: "Universal A.T.O.",
                landing_btn: "DIVE INTO THE UNIVERSE!",
                landing_subtitle: "Welcome to the Universal Astronomical Orbit Operation system.",
                loading: ">> Translation Module Active...<br>>> System ready.",
                landing_support: "Support",
                landing_github: "GitHub",
                landing_report: "Report",
                bug_modal_title: "Report Bug",
                bug_email_ph: "Your Email Address",
                bug_subject_ph: "Subject",
                bug_text_ph: "Describe the bug here...",
                bug_cancel: "Cancel",
                bug_send: "Send",
                bug_alert_empty: "Please fill in all fields.",
                bug_alert_success: "Bug report sent successfully! Thanks.",
                title: "COSMIC WEB",
                galaxy_label: "GALAXY:",
                nav_title: "Navigation",
                new_univ_btn: "+ DISCOVER NEW UNIVERSE",
                warp_btn: "CLICK TO WARP",
                scan_locked: "TARGET LOCKED",
                scan_system: "SYSTEM",
                lbl_class: "CLASS",
                lbl_temp: "TEMP",
                lbl_dist: "DIST",
                lbl_status: "STATUS",
                status_stable: "Stable",
                status_unknown: "Unknown",
                status_analyze: "Analysis Required",
                ai_btn: "<span>‚ú¶</span> Start Cosmic Analysis",
                ai_analyzing: "<span>üì°</span> Analyzing...",
                ai_report: "Mission Report",
                ai_desc: "Click the button to analyze data of the selected galaxy.",
                time_stop: "STOP TIME",
                time_start: "START TIME",
                collision_btn: "‚ö† TRIGGER COLLISION",
                freecam_btn: "üì∑ FREE CAMERA",
                reset_btn: "RESET ROUTE / RETURN",
                year: "YEAR",
                planet_types: { "Gaz Dev": "Gas Giant", "Buzul": "Ice", "Kayalƒ±k": "Rocky", "Okyanus": "Ocean", "Lav": "Lava", "√á√∂l": "Desert", "Terra": "Terra", "Singularity": "Singularity", "√ñl√º Gezegen": "Dead Planet" },
                galaxy_types: { "Standart": "Standard", "Spiral": "Spiral", "Eliptik": "Elliptical", "Kaotik": "Chaotic", "Quasar Aktif": "Active Quasar", "Nebula Yoƒüun": "Dense Nebula", "Karanlƒ±k Madde": "Dark Matter", "Uydu Galaksi": "Satellite Galaxy", "Kaotik Birle≈üme": "Chaotic Merger", "Birle≈üik Dev": "Merged Giant", "N√∂tron Yƒ±ldƒ±zƒ±": "Neutron Star" },
                events: {
                    supernova_t: "SUPERNOVA", supernova_d: "Star collapse detected. Planets vaporizing.",
                    ice_age_t: "ICE AGE", ice_age_d: "System entropy dropped. Planets freezing.",
                    gamma_t: "GAMMA RAY", gamma_d: "High energy burst. Atmospheres destroyed.",
                    life_t: "SIGNS OF LIFE", life_d: "A new world is born.",
                    collision_t: "GALAXY COLLISION", collision_d: "Gravitational anomaly! Two galaxies merging."
                },
                micro_bh: "Micro Black Hole",
                loc_prefix: "Location:",
                loc_center: "Center Sector",
                cinematic_warp: "WARP DRIVE ACTIVE:",
                cinematic_route: "ROUTE:",
                cinematic_return: "RETURNING TO MAIN ORBIT",
                gui: {
                    folder_struct: "Galaxy Structure",
                    star_count: "Star Count",
                    galaxy_age: "Galaxy Age (Billion Years)",
                    radius: "Radius",
                    branches: "Branch Count",
                    spin: "Spiral Spin",
                    nebula_op: "Nebula Opacity",
                    dust_op: "Dust Density",
                    in_color: "Inner Color",
                    out_color: "Outer Color",
                    folder_phys: "Physics & Event Horizon",
                    gravity: "Black Hole Mass",
                    rot_speed: "Galactic Rotation Speed",
                    comet_freq: "Comet Frequency",
                    folder_quasar: "Quasar Jets",
                    jet_len: "Jet Length",
                    jet_int: "Energy Density",
                    jet_spd: "Flow Speed",
                    folder_time: "Time Control",
                    time_flow: "Universal Time Flow",
                    planet_evol: "Planet Evol. Speed",
                    cinematic: "Cinematic Mode",
                    theme: "Color Theme",
                    folder_graphics: "Graphics & Performance",
                    show_fps: "Show FPS",
                    resolution: "Resolution"
                }
            },
            fr: {
                landing_title: "Universal A.T.O.",
                landing_btn: "PLONGEZ DANS L'UNIVERS!",
                landing_subtitle: "Bienvenue dans le syst√®me universel d'op√©ration orbitale astronomique.",
                loading: ">> Module de Traduction Actif...<br>>> Syst√®me pr√™t.",
                landing_support: "Soutenir",
                landing_github: "GitHub",
                landing_report: "Signaler",
                bug_modal_title: "Signaler un Bug",
                bug_email_ph: "Votre Adresse E-mail",
                bug_subject_ph: "Sujet",
                bug_text_ph: "D√©crivez le bug ici...",
                bug_cancel: "Annuler",
                bug_send: "Envoyer",
                bug_alert_empty: "Veuillez remplir tous les champs.",
                bug_alert_success: "Rapport de bug envoy√© avec succ√®s ! Merci.",
                title: "TOILE COSMIQUE",
                galaxy_label: "GALAXIE:",
                nav_title: "Navigation",
                new_univ_btn: "+ D√âCOUVRIR NOUVEL UNIVERS",
                warp_btn: "CLIQUER POUR WARP",
                scan_locked: "CIBLE VERROUILL√âE",
                scan_system: "SYST√àME",
                lbl_class: "CLASSE",
                lbl_temp: "TEMP",
                lbl_dist: "DIST",
                lbl_status: "STATUT",
                status_stable: "Stable",
                status_unknown: "Inconnu",
                status_analyze: "Analyse Requise",
                ai_btn: "<span>‚ú¶</span> Lancer l'Analyse",
                ai_analyzing: "<span>üì°</span> Analyse en cours...",
                ai_report: "Rapport de Mission",
                ai_desc: "Cliquez pour analyser les donn√©es de la galaxie s√©lectionn√©e.",
                time_stop: "ARR√äTER LE TEMPS",
                time_start: "LANCER LE TEMPS",
                collision_btn: "‚ö† D√âCLENCHER COLLISION",
                freecam_btn: "üì∑ CAM√âRA LIBRE",
                reset_btn: "R√âINITIALISER / RETOUR",
                year: "ANN√âE",
                planet_types: { "Gaz Dev": "G√©ante Gazeuse", "Buzul": "Glace", "Kayalƒ±k": "Rocheuse", "Okyanus": "Oc√©an", "Lav": "Lave", "√á√∂l": "D√©sert", "Terra": "Terra", "Singularity": "Singularit√©", "√ñl√º Gezegen": "Plan√®te Morte" },
                galaxy_types: { "Standart": "Standard", "Spiral": "Spirale", "Eliptik": "Elliptique", "Kaotik": "Chaotique", "Quasar Aktif": "Quasar Actif", "Nebula Yoƒüun": "N√©buleuse Dense", "Karanlƒ±k Madde": "Mati√®re Noire", "Uydu Galaksi": "Galaxie Satellite", "Kaotik Birle≈üme": "Fusion Chaotique", "Birle≈üik Dev": "G√©ante Fusionn√©e", "N√∂tron Yƒ±ldƒ±zƒ±": "√âtoile √† Neutrons" },
                events: {
                    supernova_t: "SUPERNOVA", supernova_d: "Effondrement d'√©toile. Plan√®tes d√©truites.",
                    ice_age_t: "√ÇGE DE GLACE", ice_age_d: "Entropie en baisse. Plan√®tes gel√©es.",
                    gamma_t: "RAYON GAMMA", gamma_d: "Explosion d'√©nergie. Atmosph√®res d√©truites.",
                    life_t: "SIGNES DE VIE", life_d: "Un nouveau monde est n√©.",
                    collision_t: "COLLISION GALACTIQUE", collision_d: "Anomalie gravitationnelle! Fusion en cours."
                },
                micro_bh: "Micro Trou Noir",
                loc_prefix: "Lieu:",
                loc_center: "Secteur Central",
                cinematic_warp: "PROPULSION WARP ACTIVE:",
                cinematic_route: "ROUTE:",
                cinematic_return: "RETOUR EN ORBITE PRINCIPALE",
                gui: {
                    folder_struct: "Structure Galactique",
                    star_count: "Nombre d'√âtoiles",
                    galaxy_age: "√Çge Galactique (Milliards)",
                    radius: "Rayon",
                    branches: "Nombre de Bras",
                    spin: "Rotation Spirale",
                    nebula_op: "Opacit√© N√©buleuse",
                    dust_op: "Densit√© Poussi√®re",
                    in_color: "Couleur Int√©rieure",
                    out_color: "Couleur Ext√©rieure",
                    folder_phys: "Physique & Horizon",
                    gravity: "Masse Trou Noir",
                    rot_speed: "Vitesse Rotation",
                    comet_freq: "Fr√©quence Com√®tes",
                    folder_quasar: "Jets Quasar",
                    jet_len: "Longueur Jet",
                    jet_int: "Densit√© √ânergie",
                    jet_spd: "Vitesse Flux",
                    folder_time: "Contr√¥le Temporel",
                    time_flow: "Flux Temporel",
                    planet_evol: "Vitesse √âvol. Plan√®te",
                    cinematic: "Mode Cin√©matique",
                    theme: "Th√®me Couleur",
                    folder_graphics: "Graphismes & Perf.",
                    show_fps: "Afficher FPS",
                    resolution: "R√©solution"
                }
            },
            de: {
                landing_title: "Universal A.T.O.",
                landing_btn: "TAUCHE EIN IN DAS UNIVERSUM!",
                landing_subtitle: "Willkommen beim Universal Astronomical Orbit Operation System.",
                loading: ">> √úbersetzungsmodul Aktiv...<br>>> System bereit.",
                landing_support: "Unterst√ºtzen",
                landing_github: "GitHub",
                landing_report: "Melden",
                bug_modal_title: "Fehler Melden",
                bug_email_ph: "Ihre E-Mail-Adresse",
                bug_subject_ph: "Betreff",
                bug_text_ph: "Beschreiben Sie den Fehler hier...",
                bug_cancel: "Abbrechen",
                bug_send: "Senden",
                bug_alert_empty: "Bitte f√ºllen Sie alle Felder aus.",
                bug_alert_success: "Fehlerbericht erfolgreich gesendet! Danke.",
                title: "KOSMISCHES NETZ",
                galaxy_label: "GALAXIE:",
                nav_title: "Navigation",
                new_univ_btn: "+ NEUES UNIVERSUM",
                warp_btn: "KLICKEN F√úR WARP",
                scan_locked: "ZIEL ERFASST",
                scan_system: "SYSTEM",
                lbl_class: "KLASSE",
                lbl_temp: "TEMP",
                lbl_dist: "DIST",
                lbl_status: "STATUS",
                status_stable: "Stabil",
                status_unknown: "Unbekannt",
                status_analyze: "Analyse Erforderlich",
                ai_btn: "<span>‚ú¶</span> Analyse Starten",
                ai_analyzing: "<span>üì°</span> Analysiere...",
                ai_report: "Missionsbericht",
                ai_desc: "Klicken Sie, um die Daten der ausgew√§hlten Galaxie zu analysieren.",
                time_stop: "ZEIT STOPPEN",
                time_start: "ZEIT STARTEN",
                collision_btn: "‚ö† KOLLISION AUSL√ñSEN",
                freecam_btn: "üì∑ FREIE KAMERA",
                reset_btn: "ROUTE ZUR√úCKSETZEN",
                year: "JAHR",
                planet_types: { "Gaz Dev": "Gasriese", "Buzul": "Eis", "Kayalƒ±k": "Felsig", "Okyanus": "Ozean", "Lav": "Lava", "√á√∂l": "W√ºste", "Terra": "Terra", "Singularity": "Singularit√§t", "√ñl√º Gezegen": "Toter Planet" },
                galaxy_types: { "Standart": "Standard", "Spiral": "Spirale", "Eliptik": "Elliptisch", "Kaotik": "Chaotisch", "Quasar Aktif": "Aktiver Quasar", "Nebula Yoƒüun": "Dichter Nebel", "Karanlƒ±k Madde": "Dunkle Materie", "Uydu Galaksi": "Satellitengalaxie", "Kaotik Birle≈üme": "Chaotische Fusion", "Birle≈üik Dev": "Fusionierter Riese", "N√∂tron Yƒ±ldƒ±zƒ±": "Neutronenstern" },
                events: {
                    supernova_t: "SUPERNOVA", supernova_d: "Sternenkollaps. Planeten zerst√∂rt.",
                    ice_age_t: "EISZEIT", ice_age_d: "Entropie gesunken. Planeten gefroren.",
                    gamma_t: "GAMMASTRAHL", gamma_d: "Energieexplosion. Atmosph√§ren vernichtet.",
                    life_t: "LEBENSZEICHEN", life_d: "Eine neue Welt ist geboren.",
                    collision_t: "GALAKTISCHE KOLLISION", collision_d: "Gravitationsanomalie! Galaxien verschmelzen."
                },
                micro_bh: "Mikro-Schwarzes Loch",
                loc_prefix: "Standort:",
                loc_center: "Zentraler Sektor",
                cinematic_warp: "WARP-ANTRIEB AKTIV:",
                cinematic_route: "ROUTE:",
                cinematic_return: "R√úCKKEHR ZUM HAUPTORBIT",
                gui: {
                    folder_struct: "Galaxiestruktur",
                    star_count: "Sternenanzahl",
                    galaxy_age: "Galaxienalter (Mrd. Jahre)",
                    radius: "Radius",
                    branches: "Armanzahl",
                    spin: "Spiralneigung",
                    nebula_op: "Nebeldeckkraft",
                    dust_op: "Staubdichte",
                    in_color: "Innenfarbe",
                    out_color: "Au√üenfarbe",
                    folder_phys: "Physik & Ereignishorizont",
                    gravity: "Schwarzes Loch Masse",
                    rot_speed: "Rotationsgeschwindigkeit",
                    comet_freq: "Kometenh√§ufigkeit",
                    folder_quasar: "Quasar-Jets",
                    jet_len: "Jet-L√§nge",
                    jet_int: "Energiedichte",
                    jet_spd: "Flussgeschwindigkeit",
                    folder_time: "Zeitsteuerung",
                    time_flow: "Zeitfluss",
                    planet_evol: "Planetenentwicklung",
                    cinematic: "Kinomodus",
                    theme: "Farbthema",
                    folder_graphics: "Grafik & Leistung",
                    show_fps: "FPS anzeigen",
                    resolution: "Aufl√∂sung"
                }
            },
            ja: {
                landing_title: "Universal A.T.O.",
                landing_btn: "ÂÆáÂÆô„Å∏È£õ„Å≥Ëæº„ÇÄÔºÅ",
                landing_subtitle: "Universal Astronomical Orbit Operation„Ç∑„Çπ„ÉÜ„É†„Å∏„Çà„ÅÜ„Åì„Åù„ÄÇ",
                loading: ">> ÁøªË®≥„É¢„Ç∏„É•„Éº„É´Ëµ∑Âãï‰∏≠...<br>>> „Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü„ÄÇ",
                landing_support: "„Çµ„Éù„Éº„Éà",
                landing_github: "GitHub",
                landing_report: "Â†±Âëä",
                bug_modal_title: "„Éê„Ç∞Â†±Âëä",
                bug_email_ph: "„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ",
                bug_subject_ph: "‰ª∂Âêç",
                bug_text_ph: "„Éê„Ç∞„ÅÆË©≥Á¥∞„Çí„Åì„Åì„Å´Ë®òËø∞...",
                bug_cancel: "„Ç≠„É£„É≥„Çª„É´",
                bug_send: "ÈÄÅ‰ø°",
                bug_alert_empty: "„Åô„Åπ„Å¶„ÅÆ„Éï„Ç£„Éº„É´„Éâ„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                bug_alert_success: "„Éê„Ç∞Â†±Âëä„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„ÅüÔºÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ",
                title: "„Ç≥„Ç∫„Éü„ÉÉ„ÇØ„Éª„Ç¶„Çß„Éñ",
                galaxy_label: "ÈäÄÊ≤≥:",
                nav_title: "„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥",
                new_univ_btn: "+ Êñ∞„Åó„ÅÑÂÆáÂÆô„ÇíÁô∫Ë¶ã",
                warp_btn: "„ÉØ„Éº„Éó„Åô„Çã„Å´„ÅØ„ÇØ„É™„ÉÉ„ÇØ",
                scan_locked: "„Çø„Éº„Ç≤„ÉÉ„Éà„É≠„ÉÉ„ÇØ",
                scan_system: "„Ç∑„Çπ„ÉÜ„É†",
                lbl_class: "„ÇØ„É©„Çπ",
                lbl_temp: "Ê∏©Â∫¶",
                lbl_dist: "Ë∑ùÈõ¢",
                lbl_status: "Áä∂ÊÖã",
                status_stable: "ÂÆâÂÆö",
                status_unknown: "‰∏çÊòé",
                status_analyze: "ÂàÜÊûê„ÅåÂøÖË¶Å",
                ai_btn: "<span>‚ú¶</span> ÂÆáÂÆôÂàÜÊûê„ÇíÈñãÂßã",
                ai_analyzing: "<span>üì°</span> ÂàÜÊûê‰∏≠...",
                ai_report: "„Éü„ÉÉ„Ç∑„Éß„É≥„É¨„Éù„Éº„Éà",
                ai_desc: "ÈÅ∏Êäû„Åó„ÅüÈäÄÊ≤≥„ÅÆ„Éá„Éº„Çø„ÇíÂàÜÊûê„Åô„Çã„Å´„ÅØ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                time_stop: "ÊôÇÈñì„ÇíÂÅúÊ≠¢",
                time_start: "ÊôÇÈñì„ÇíÈñãÂßã",
                collision_btn: "‚ö† Ë°ùÁ™Å„ÇíÈñãÂßã",
                freecam_btn: "üì∑ „Éï„É™„Éº„Ç´„É°„É©",
                reset_btn: "„É´„Éº„Éà„Çí„É™„Çª„ÉÉ„Éà / Êàª„Çã",
                year: "Âπ¥",
                planet_types: { "Gaz Dev": "Â∑®Â§ß„Ç¨„ÇπÊÉëÊòü", "Buzul": "Ê∞∑ÊÉëÊòü", "Kayalƒ±k": "Â≤©Áü≥ÊÉëÊòü", "Okyanus": "Êµ∑Ê¥ãÊÉëÊòü", "Lav": "Ê∫∂Â≤©ÊÉëÊòü", "√á√∂l": "Á†ÇÊº†ÊÉëÊòü", "Terra": "„ÉÜ„É© (Âú∞ÁêÉÂûã)", "Singularity": "ÁâπÁï∞ÁÇπ", "√ñl√º Gezegen": "Ê≠ª„ÅÆÊÉëÊòü" },
                galaxy_types: { "Standart": "Ê®ôÊ∫ñ", "Spiral": "Ê∏¶Â∑ªÈäÄÊ≤≥", "Eliptik": "Ê•ïÂÜÜÈäÄÊ≤≥", "Kaotik": "‰∏çË¶èÂâáÈäÄÊ≤≥", "Quasar Aktif": "Ê¥ªÂãïÈäÄÊ≤≥Ê†∏", "Nebula Yoƒüun": "È´òÂØÜÂ∫¶ÊòüÈõ≤", "Karanlƒ±k Madde": "ÊöóÈªíÁâ©Ë≥™", "Uydu Galaksi": "‰º¥ÈäÄÊ≤≥", "Kaotik Birle≈üme": "„Ç´„Ç™„ÇπÁöÑÂêà‰Ωì", "Birle≈üik Dev": "Âêà‰ΩìÂ∑®Â§ßÈäÄÊ≤≥", "N√∂tron Yƒ±ldƒ±zƒ±": "‰∏≠ÊÄßÂ≠êÊòü" },
                events: {
                    supernova_t: "Ë∂ÖÊñ∞ÊòüÁàÜÁô∫", supernova_d: "ÊÅíÊòüÂ¥©Â£ä„ÇíÊ§úÁü•„ÄÇÊÉëÊòü„ÅåÊ∂àÊªÖ„Åó„Åæ„Åó„Åü„ÄÇ",
                    ice_age_t: "Ê∞∑Ê≤≥Êúü", ice_age_d: "„Ç®„É≥„Éà„É≠„Éî„Éº‰Ωé‰∏ã„ÄÇÊÉëÊòü„ÅåÂáçÁµê‰∏≠„ÄÇ",
                    gamma_t: "„Ç¨„É≥„ÉûÁ∑ö„Éê„Éº„Çπ„Éà", gamma_d: "È´ò„Ç®„Éç„É´„ÇÆ„ÉºÁàÜÁô∫„ÄÇÂ§ßÊ∞ó„ÅåÁ†¥Â£ä„Åï„Çå„Åæ„Åó„Åü„ÄÇ",
                    life_t: "ÁîüÂëΩ„ÅÆÂÖÜÂÄô", life_d: "Êñ∞„Åó„ÅÑ‰∏ñÁïå„ÅåË™ïÁîü„Åó„Åæ„Åó„Åü„ÄÇ",
                    collision_t: "ÈäÄÊ≤≥Ë°ùÁ™Å", collision_d: "ÈáçÂäõÁï∞Â∏∏ÔºÅ‰∫å„Å§„ÅÆÈäÄÊ≤≥„ÅåËûçÂêà„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                },
                micro_bh: "„Éû„Ç§„ÇØ„É≠„Éñ„É©„ÉÉ„ÇØ„Éõ„Éº„É´",
                loc_prefix: "‰ΩçÁΩÆ:",
                loc_center: "‰∏≠Â§Æ„Çª„ÇØ„Çø„Éº",
                cinematic_warp: "„ÉØ„Éº„Éó„Éâ„É©„Ç§„ÉñËµ∑Âãï:",
                cinematic_route: "„É´„Éº„Éà:",
                cinematic_return: "‰∏ªËªåÈÅì„Å∏Â∏∞ÈÇÑ‰∏≠",
                gui: {
                    folder_struct: "ÈäÄÊ≤≥ÊßãÈÄ†",
                    star_count: "Êòü„ÅÆÊï∞",
                    galaxy_age: "ÈäÄÊ≤≥Âπ¥ÈΩ¢ (ÂçÅÂÑÑÂπ¥)",
                    radius: "ÂçäÂæÑ",
                    branches: "ËÖï„ÅÆÊï∞",
                    spin: "„Çπ„Éî„É≥",
                    nebula_op: "ÊòüÈõ≤„ÅÆ‰∏çÈÄèÊòéÂ∫¶",
                    dust_op: "Â°µ„ÅÆÂØÜÂ∫¶",
                    in_color: "ÂÜÖÈÉ®Ëâ≤",
                    out_color: "Â§ñÈÉ®Ëâ≤",
                    folder_phys: "Áâ©ÁêÜÂ≠¶„Å®‰∫ãË±°„ÅÆÂú∞Âπ≥Á∑ö",
                    gravity: "„Éñ„É©„ÉÉ„ÇØ„Éõ„Éº„É´Ë≥™Èáè",
                    rot_speed: "ÂõûËª¢ÈÄüÂ∫¶",
                    comet_freq: "ÂΩóÊòü„ÅÆÈ†ªÂ∫¶",
                    folder_quasar: "„ÇØ„Ç®„Éº„Çµ„Éº„Ç∏„Çß„ÉÉ„Éà",
                    jet_len: "„Ç∏„Çß„ÉÉ„Éà„ÅÆÈï∑„Åï",
                    jet_int: "„Ç®„Éç„É´„ÇÆ„ÉºÂØÜÂ∫¶",
                    jet_spd: "ÊµÅÈÄü",
                    folder_time: "ÊôÇÈñìÂà∂Âæ°",
                    time_flow: "ÊôÇÈñì„ÅÆÊµÅ„Çå",
                    planet_evol: "ÊÉëÊòüÈÄ≤ÂåñÈÄüÂ∫¶",
                    cinematic: "„Ç∑„Éç„Éû„ÉÜ„Ç£„ÉÉ„ÇØ„É¢„Éº„Éâ",
                    theme: "„Ç´„É©„Éº„ÉÜ„Éº„Éû",
                    folder_graphics: "„Ç∞„É©„Éï„Ç£„ÉÉ„ÇØ„Çπ„Å®„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ",
                    show_fps: "FPS„ÇíË°®Á§∫",
                    resolution: "Ëß£ÂÉèÂ∫¶"
                }
            },
            es: {
                landing_title: "Universal A.T.O.",
                landing_btn: "¬°SUM√âRGETE EN EL UNIVERSO!",
                landing_subtitle: "Bienvenido al sistema Universal Astronomical Orbit Operation.",
                loading: ">> M√≥dulo de Traducci√≥n Activo...<br>>> Sistema listo.",
                landing_support: "Apoyar",
                landing_github: "GitHub",
                landing_report: "Reportar",
                bug_modal_title: "Reportar Error",
                bug_email_ph: "Tu Correo Electr√≥nico",
                bug_subject_ph: "Asunto",
                bug_text_ph: "Describe el error aqu√≠...",
                bug_cancel: "Cancelar",
                bug_send: "Enviar",
                bug_alert_empty: "Por favor, rellena todos los campos.",
                bug_alert_success: "¬°Informe de error enviado con √©xito! Gracias.",
                title: "RED C√ìSMICA",
                galaxy_label: "GALAXIA:",
                nav_title: "Navegaci√≥n",
                new_univ_btn: "+ DESCUBRIR NUEVO UNIVERSO",
                warp_btn: "CLIC PARA WARP",
                scan_locked: "OBJETIVO FIJADO",
                scan_system: "SISTEMA",
                lbl_class: "CLASE",
                lbl_temp: "TEMP",
                lbl_dist: "DIST",
                lbl_status: "ESTADO",
                status_stable: "Estable",
                status_unknown: "Desconocido",
                status_analyze: "An√°lisis Requerido",
                ai_btn: "<span>‚ú¶</span> Iniciar An√°lisis C√≥smico",
                ai_analyzing: "<span>üì°</span> Analizando...",
                ai_report: "Informe de Misi√≥n",
                ai_desc: "Haga clic para analizar los datos de la galaxia seleccionada.",
                time_stop: "DETENER TIEMPO",
                time_start: "INICIAR TIEMPO",
                collision_btn: "‚ö† INICIAR COLISI√ìN",
                freecam_btn: "üì∑ C√ÅMARA LIBRE",
                reset_btn: "RESTABLECER RUTA / VOLVER",
                year: "A√ëO",
                planet_types: { "Gaz Dev": "Gigante Gaseoso", "Buzul": "Hielo", "Kayalƒ±k": "Rocoso", "Okyanus": "Oc√©ano", "Lav": "Lava", "√á√∂l": "Desierto", "Terra": "Terra", "Singularity": "Singularidad", "√ñl√º Gezegen": "Planeta Muerto" },
                galaxy_types: { "Standart": "Est√°ndar", "Spiral": "Espiral", "Eliptik": "El√≠ptica", "Kaotik": "Ca√≥tica", "Quasar Aktif": "Cu√°sar Activo", "Nebula Yoƒüun": "Nebulosa Densa", "Karanlƒ±k Madde": "Materia Oscura", "Uydu Galaksi": "Galaxia Sat√©lite", "Kaotik Birle≈üme": "Fusi√≥n Ca√≥tica", "Birle≈üik Dev": "Gigante Fusionada", "N√∂tron Yƒ±ldƒ±zƒ±": "Estrella de Neutrones" },
                events: {
                    supernova_t: "SUPERNOVA", supernova_d: "Colapso estelar detectado. Planetas destruidos.",
                    ice_age_t: "EDAD DE HIELO", ice_age_d: "Entrop√≠a baja. Planetas congel√°ndose.",
                    gamma_t: "RAYOS GAMMA", gamma_d: "Explosi√≥n de energ√≠a. Atm√≥sferas destruidas.",
                    life_t: "SIGNOS DE VIDA", life_d: "Ha nacido un nuevo mundo.",
                    collision_t: "COLISI√ìN GAL√ÅCTICA", collision_d: "¬°Anomal√≠a gravitacional! Fusi√≥n en curso."
                },
                micro_bh: "Micro Agujero Negro",
                loc_prefix: "Ubicaci√≥n:",
                loc_center: "Sector Central",
                cinematic_warp: "IMPULSO WARP ACTIVO:",
                cinematic_route: "RUTA:",
                cinematic_return: "VOLVIENDO A LA √ìRBITA PRINCIPAL",
                gui: {
                    folder_struct: "Estructura Gal√°ctica",
                    star_count: "Recuento de Estrellas",
                    galaxy_age: "Edad Gal√°ctica (Mil Millones)",
                    radius: "Radio",
                    branches: "N√∫mero de Brazos",
                    spin: "Giro Espiral",
                    nebula_op: "Opacidad Nebulosa",
                    dust_op: "Densidad Polvo",
                    in_color: "Color Interior",
                    out_color: "Color Exterior",
                    folder_phys: "F√≠sica y Horizonte",
                    gravity: "Masa Agujero Negro",
                    rot_speed: "Velocidad Rotaci√≥n",
                    comet_freq: "Frecuencia Cometas",
                    folder_quasar: "Chorros Cu√°sar",
                    jet_len: "Longitud Chorro",
                    jet_int: "Densidad Energ√≠a",
                    jet_spd: "Velocidad Flujo",
                    folder_time: "Control de Tiempo",
                    time_flow: "Flujo Temporal",
                    planet_evol: "Vel. Evoluci√≥n Planeta",
                    cinematic: "Modo Cinem√°tico",
                    theme: "Tema de Color",
                    folder_graphics: "Gr√°ficos y Rendimiento",
                    show_fps: "Mostrar FPS",
                    resolution: "Resoluci√≥n"
                }
            }
        };

        let currentLang = 'en';

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // Landing Page
            document.querySelector('.landing-title').innerText = t.landing_title;
            document.querySelector('.landing-subtitle').innerText = t.landing_subtitle;
            document.querySelector('.enter-btn').innerText = t.landing_btn;

            // Landing Butonlarƒ±nƒ± G√ºncelle
            const patreonBtn = document.getElementById('landing-patreon-btn');
            if(patreonBtn) patreonBtn.innerHTML = `<i class="fab fa-patreon" style="font-size: 1.2rem;"></i> ${t.landing_support}`;
            
            const githubBtn = document.getElementById('landing-github-btn');
            if(githubBtn) githubBtn.innerHTML = `<i class="fab fa-github" style="font-size: 1.2rem;"></i> ${t.landing_github}`;
            
            const bugBtn = document.getElementById('landing-bug-btn');
            if(bugBtn) bugBtn.innerHTML = `<i class="fas fa-bug"></i> ${t.landing_report}`;

            // UI Metinlerini G√ºncelle
            document.getElementById('ui-title').innerText = t.title;
            updateGalaxyNameDisplay(); 
            document.getElementById('nav-title').innerText = t.nav_title;
            document.getElementById('create-btn').innerText = t.new_univ_btn;
            document.getElementById('scanner-warp-hint').innerText = t.warp_btn;
            
            // Scanner Etiketleri
            document.getElementById('scan-status-text').innerText = t.scan_locked;
            document.getElementById('scan-target').innerText = t.scan_system;
            document.getElementById('label-class').innerText = t.lbl_class;
            document.getElementById('label-temp').innerText = t.lbl_temp;
            document.getElementById('label-dist').innerText = t.lbl_dist;
            document.getElementById('label-status').innerText = t.lbl_status;
            
            // AI Panel
            const aiBtn = document.getElementById('generate-btn');
            if (!aiBtn.disabled) {
                document.getElementById('ai-btn-text').innerHTML = t.ai_btn;
            }
            document.getElementById('story-title').innerText = t.ai_report;
            document.getElementById('story-output').innerText = t.ai_desc;

            // Butonlar
            updateTimeButtonText();
            document.getElementById('collision-btn').innerText = t.collision_btn;
            document.getElementById('freecam-btn').innerText = t.freecam_btn;
            document.getElementById('reset-view-btn').innerText = t.reset_btn;
            
            // Kozmik Tarih
            updateCosmicDateDisplay();

            // Galaksi Listesini Yenile
            renderGalaxyList();
            
            // GUI Yenile
            setupGUI();
            
            // A√ßƒ±k olan scanner verisini g√ºncelle
            if(hoveredObject && hoveredObject.userData) {
                const data = hoveredObject.userData;
                let statusText = t.status_analyze;
                updateScanner(t.scan_locked, data.name, getTranslatedPlanetType(data.type), data.distance, statusText);
            }

            // Dropdown'ƒ± kapat
            document.querySelector('.lang-dropdown').classList.remove('show');
        }

        function getTranslatedPlanetType(originalType) {
            const t = translations[currentLang];
            return t.planet_types[originalType] || originalType;
        }

        function getTranslatedGalaxyType(originalType) {
            const t = translations[currentLang];
            return t.galaxy_types[originalType] || originalType;
        }
        
        function updateGalaxyNameDisplay() {
            const t = translations[currentLang];
            document.getElementById('current-galaxy-name').innerText = `${t.galaxy_label} ${parameters.name}`;
        }

        function applyGraphicsSettings(level) {
            switch(level) {
                case 'low':
                    if(renderer) renderer.setPixelRatio(0.75);
                    parameters.count = 20000;
                    parameters.nebulaCount = 10000;
                    parameters.dustCount = 5000;
                    parameters.bloomStrength = 0.8;
                    break;
                case 'medium':
                    if(renderer) renderer.setPixelRatio(1.0);
                    parameters.count = 50000;
                    parameters.nebulaCount = 20000;
                    parameters.dustCount = 10000;
                    parameters.bloomStrength = 1.2;
                    break;
                case 'high':
                    if(renderer) renderer.setPixelRatio(window.devicePixelRatio);
                    parameters.count = 80000;
                    parameters.nebulaCount = 30000;
                    parameters.dustCount = 15000;
                    parameters.bloomStrength = 1.5;
                    break;
                case 'extreme':
                    if(renderer) renderer.setPixelRatio(window.devicePixelRatio);
                    parameters.count = 150000;
                    parameters.nebulaCount = 50000;
                    parameters.dustCount = 25000;
                    parameters.bloomStrength = 2.0;
                    break;
            }
        }

        function setGraphicsQuality(level) {
            currentGraphicsQuality = level;
            localStorage.setItem('graphicsQuality', level);
            applyGraphicsSettings(level);

            // Deƒüi≈üiklikleri uygula
            if(composer) composer.bloomPass.strength = parameters.bloomStrength;
            generateGalaxy(); // Par√ßacƒ±k sayƒ±larƒ±nƒ± g√ºncellemek i√ßin yeniden olu≈ütur
            setupGUI(); // GUI'yi yeni deƒüerlerle g√ºncelle
            document.querySelector('.graphics-dropdown').classList.remove('show');
        }
        
        function updateTimeButtonText() {
            const t = translations[currentLang];
            const text = document.getElementById('time-text');
            text.innerText = isTimePaused ? t.time_start : t.time_stop;
        }
        
        function updateCosmicDateDisplay() {
            const t = translations[currentLang];
            document.getElementById('cosmic-date').innerText = `${t.year}: ${Math.floor(cosmicYear)}`;
        }
        
        function enterSimulation() {
            const landing = document.getElementById('landing-page');
            const gameUI = document.querySelector('.game-ui');
            
            // Efekt ekle
            landing.classList.add('warp-out');
            
            setTimeout(() => {
                landing.style.display = 'none';
                gameUI.classList.add('active');
            }, 1400); // Animasyon s√ºresine yakƒ±n
        }

        // --- GLOBAL SCOPE CLASSES ---
        class Explosion {
            constructor(position, color, decay = 0.02, speedScale = 1.0) {
                this.position = position.clone(); this.life = 1.0; this.particlesCount = 30;
                this.decay = decay;
                const geo = new THREE.BufferGeometry(); const pos = []; const vels = [];
                for(let i=0; i<this.particlesCount; i++) { 
                    pos.push(0,0,0); 
                    let v = new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5);
                    if(v.lengthSq() === 0) v.set(0,1,0); // NaN korumasƒ±
                    vels.push(v.normalize().multiplyScalar((0.1 + Math.random()*0.1) * speedScale)); 
                }
                geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3)); this.velocities = vels;
                this.mesh = new THREE.Points(geo, new THREE.PointsMaterial({ color: color, size: 0.5, map: explosionTexture, transparent: true, blending: THREE.AdditiveBlending, depthWrite: false }));
                this.mesh.position.copy(this.position); scene.add(this.mesh);
            }
            update() {
                this.life -= this.decay; const positions = this.mesh.geometry.attributes.position.array;
                for(let i=0; i<this.particlesCount; i++) { positions[i*3] += this.velocities[i].x; positions[i*3+1] += this.velocities[i].y; positions[i*3+2] += this.velocities[i].z; }
                this.mesh.geometry.attributes.position.needsUpdate = true; this.mesh.material.opacity = this.life; this.mesh.scale.setScalar(2.0 - this.life);
                if(this.life <= 0) { scene.remove(this.mesh); this.mesh.geometry.dispose(); this.mesh.material.dispose(); return false; } return true;
            }
        }

        class Comet {
            constructor() {
                const angle = Math.random() * Math.PI * 2; const distance = 15 + Math.random() * 5; const height = (Math.random() - 0.5) * 8;
                this.position = new THREE.Vector3(Math.cos(angle) * distance, height, Math.sin(angle) * distance);
                const hue = Math.random(); this.color = new THREE.Color().setHSL(hue, 0.8, 0.7);
                const toCenter = new THREE.Vector3(0,0,0).sub(this.position).normalize();
                const up = new THREE.Vector3(0, 1, 0); const tangent = new THREE.Vector3().crossVectors(toCenter, up).normalize();
                const randomOffset = new THREE.Vector3((Math.random()-0.5), (Math.random()-0.5), (Math.random()-0.5)).multiplyScalar(0.3);
                const initialDir = toCenter.multiplyScalar(0.2).add(tangent.multiplyScalar(1.0)).add(randomOffset).normalize();
                this.velocity = initialDir.multiplyScalar(parameters.cometSpeed); 
                this.life = 1.0; this.decay = 0.003; 
                const geo = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,0,0)]);
                const mat = new THREE.PointsMaterial({ color: this.color, size: 0.4, map: cometTexture, transparent: true, opacity: 1, blending: THREE.AdditiveBlending, depthWrite: false });
                this.mesh = new THREE.Points(geo, mat); this.mesh.position.copy(this.position); scene.add(this.mesh);
                const trailGeo = new THREE.BufferGeometry();
                const trailMat = new THREE.LineBasicMaterial({ color: this.color, transparent: true, opacity: 0.6 });
                this.trail = new THREE.Line(trailGeo, trailMat); this.trailPoints = []; this.maxTrailPoints = 60; scene.add(this.trail);
            }
            update() {
                const center = new THREE.Vector3(0, 0, 0); const toCenter = center.clone().sub(this.position);
                const distanceSq = toCenter.lengthSq(); const safeDistSq = Math.max(distanceSq, 0.3); 
                const forceMagnitude = (parameters.gravityPower * 0.4) / safeDistSq;
                
                if(!isTimePaused) {
                    this.velocity.add(toCenter.normalize().multiplyScalar(forceMagnitude));
                    this.position.add(this.velocity); 
                }
                
                this.mesh.position.copy(this.position);
                if(distanceSq < (parameters.gravityPower * parameters.gravityPower * 0.5)) { explosions.push(new Explosion(this.position, this.color)); this.life = 0; }
                this.life -= this.decay; this.mesh.material.opacity = this.life; this.trail.material.opacity = this.life * 0.5;
                this.trailPoints.push(this.position.clone()); if(this.trailPoints.length > this.maxTrailPoints) this.trailPoints.shift();
                this.trail.geometry.setFromPoints(this.trailPoints);
                if (this.life <= 0) { this.dispose(); return false; } return true; 
            }
            dispose() { scene.remove(this.mesh); scene.remove(this.trail); this.mesh.geometry.dispose(); this.mesh.material.dispose(); this.trail.geometry.dispose(); this.trail.material.dispose(); }
        }

        class Shockwave {
            constructor(position, color) {
                this.position = position.clone();
                this.life = 0.0;
                this.maxRadius = 60.0; 
                this.speed = 0.8;

                const geometry = new THREE.RingGeometry(0.6, 1.0, 64);
                geometry.rotateX(-Math.PI / 2); 

                const material = new THREE.MeshBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 1.0,
                    side: THREE.DoubleSide,
                    depthWrite: false,
                    blending: THREE.AdditiveBlending
                });

                this.mesh = new THREE.Mesh(geometry, material);
                this.mesh.position.copy(this.position);
                this.mesh.scale.set(0.1, 0.1, 0.1);
                scene.add(this.mesh);
            }
            update() {
                this.life += this.speed;
                this.mesh.scale.setScalar(this.life);
                const progress = this.life / this.maxRadius;
                this.mesh.material.opacity = 1.0 * (1.0 - Math.pow(progress, 0.5));
                if (progress >= 1.0) { this.dispose(); return false; } return true;
            }
            dispose() { scene.remove(this.mesh); this.mesh.geometry.dispose(); this.mesh.material.dispose(); }
        }

        const defaultParams = {
            count: 80000, size: 0.015, radius: 5, branches: 3, spin: 1, randomness: 0.2, randomnessPower: 3,
            insideColor: '#ff6030', outsideColor: '#1b3984',
            galaxyAge: 5.0, // Varsayƒ±lan 5 Milyar Yƒ±l
            nebulaCount: 30000, nebulaSize: 0.06, nebulaOpacity: 0.3,
            dustCount: 15000, dustSize: 0.08, dustOpacity: 0.4,
            bloomStrength: 1.5, bloomRadius: 0.4, bloomThreshold: 0.1,
            gravityPower: 0.15, cometSpeed: 0.12, cometFrequency: 0.04, rotationSpeed: 0.05,
            jetLength: 10.0, jetWidth: 0.2, jetIntensity: 2.0, jetSpeed: 1.0,
            timeSpeed: 0.02, planetEvolutionSpeed: 1.0,
            cinematic: false,
            id: 'alpha-1', name: 'ALPHA-1', type: 'Standart', theme: 'Varsayƒ±lan',
            neighborList: [],
            year: 3024,
            hasMicroBlackHoles: false,
            showFPS: false,
            resolution: 'Native'
        };

        let parameters = { ...defaultParams };
        let galaxies = [{ ...defaultParams }]; 
        let currentGalaxyIndex = 0;
        let cosmicYear = 3024;
        let currentGraphicsQuality = localStorage.getItem('graphicsQuality') || 'high';

        const galaxyNamesPart1 = ["Andromeda", "Cygnus", "Lyra", "Orion", "Pegasus", "Draco", "Phoenix", "Centauri", "Vortex", "Nebula", "Aether", "Chronos", "Hyperion", "Xylos", "Kryon", "Zentaris", "Olympos", "Asgard", "ATOO", "Mahmut"];
        const galaxyNamesPart2 = ["Prime", "Major", "Minor", "X", "Alpha", "Omega", "Zero", "Nova", "Quasar", "Core", "Rim", "Sector", "Void", "Cluster", "Expanse", "System", "ATOO", "Mahmut"];
        
        const planetNames = ["Auryon", "Borealis", "Calypsa", "Drakon", "Elysium", "Fornax", "Gaia-X", "Helios", "Ignis", "Juno", "Krytos", "Lumina", "Midas", "Nyx", "Oberon", "Pyrrha", "Quintus", "Rhea", "Saphira", "Terra Nova", "Umbra", "Vesper", "Warpstone", "Xenon", "Ymir", "Zircon", "Thalassa", "Aethelgard", "Valhalla", "ATOO", "Mahmut"];

        const galaxyTypes = ["Spiral", "Eliptik", "Kaotik", "Quasar Aktif", "Nebula Yoƒüun", "Karanlƒ±k Madde", "N√∂tron Yƒ±ldƒ±zƒ±"];
        const planetTypes = ["Gaz Dev", "Buzul", "Kayalƒ±k", "Okyanus", "Lav", "√á√∂l", "Terra"];

        let scene, camera, renderer, controls, gui, composer, chromaticAberrationPass;
        let galaxyGroups = []; 
        let specialStructures = []; 
        let stats;
        
        let animatedObjects = []; 
        
        let comets = [];
        let explosions = [];
        let shockwaves = [];
        let interactables = []; 
        let starTexture, nebulaTexture, cometTexture, explosionTexture;
        let warpLines; // Warp efekti i√ßin
        let isWarping = false;
        
        let isTimePaused = false;
        let isInEventHorizon = false;
        let collisionSound; // YENƒ∞: √áarpƒ±≈üma Sesi
        
        // √áarpƒ±≈üma Deƒüi≈ükenleri
        let isCollisionActive = false;
        let collisionTargetGroup = null;
        let collisionMainGroup = null;
        let collisionProgress = 0;
        let collisionCenter = new THREE.Vector3();
        let collisionRadius = 0;
        let collisionAngle = 0;
        
        let lockedTarget = null;
        let lastTargetPos = new THREE.Vector3();
        let activeWarpTargetUUID = null;
        
        // FREECAM Deƒüi≈ükenleri
        let isFreeCam = false;
        let keysPressed = {};
        let freeCamSpeed = 0.5;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        
        let raycaster, mouse;
        let hoveredStarIndex = -1;
        let hoveredObject = null;
        let bgPoints; 
        
        let cumulativeTime = 0; 

        const defaultCamPos = new THREE.Vector3(0, 6, 8);
        const defaultTarget = new THREE.Vector3(0, 0, 0);
        
        // --- DETERMINISTIC RANDOM (SEED) ---
        let currentSeed = null;
        function rng() {
            if (currentSeed !== null) {
                let t = currentSeed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
            return Math.random();
        }

        function generateCreativeGalaxyName() {
            const p1 = galaxyNamesPart1[Math.floor(Math.random() * galaxyNamesPart1.length)];
            const p2 = galaxyNamesPart2[Math.floor(Math.random() * galaxyNamesPart2.length)];
            const num = Math.random() > 0.6 ? "-" + Math.floor(Math.random() * 99) : "";
            return `${p1} ${p2}${num}`;
        }

        function generatePlanetName() {
            const base = planetNames[Math.floor(Math.random() * planetNames.length)];
            const suffix = Math.random() > 0.7 ? " " + (Math.floor(Math.random() * 10) + 1) : "";
            return base + suffix;
        }

        function interpolateColors(color1, color2, factor) {
            const c1 = new THREE.Color(color1);
            const c2 = new THREE.Color(color2);
            c1.lerp(c2, factor);
            return '#' + c1.getHexString();
        }

        function toggleTime() {
            isTimePaused = !isTimePaused;
            updateTimeButtonText();
        }

        // --- FREECAM Sƒ∞STEMƒ∞ ---
        function toggleFreeCam() {
            isFreeCam = !isFreeCam;
            const btn = document.getElementById('freecam-btn');
            
            if (isFreeCam) {
                btn.classList.add('active');
                controls.enabled = false; 
                lockedTarget = null;
                activeWarpTargetUUID = null;
                document.body.style.cursor = 'move';
            } else {
                btn.classList.remove('active');
                controls.enabled = true; 
                document.body.style.cursor = 'crosshair';
            }
        }

        function updateFreeCamMovement() {
            if (!isFreeCam) return;
            const forward = new THREE.Vector3();
            camera.getWorldDirection(forward);
            const right = new THREE.Vector3();
            right.crossVectors(forward, camera.up).normalize();
            const speed = freeCamSpeed * (keysPressed['shift'] ? 2.5 : 1.0); 

            if (keysPressed['w']) camera.position.addScaledVector(forward, speed);
            if (keysPressed['s']) camera.position.addScaledVector(forward, -speed);
            if (keysPressed['d']) camera.position.addScaledVector(right, speed);
            if (keysPressed['a']) camera.position.addScaledVector(right, -speed);
            if (keysPressed['c']) camera.position.y += speed; 
            if (keysPressed['v']) camera.position.y -= speed; 
        }

        // --- MANUEL √áARPI≈ûMA ---
        function triggerManualCollision() {
            if(galaxyGroups.length < 2) return;
            collisionMainGroup = galaxyGroups.find(g => g.userData.isMain);
            collisionTargetGroup = galaxyGroups.find(g => g.userData.isNeighbor);

            if(collisionMainGroup && collisionTargetGroup) {
                startGalacticCollision();
                document.getElementById('collision-btn').style.display = 'none';
            }
        }

        function updateCollisionButtonVisibility() {
            const btn = document.getElementById('collision-btn');
            if (parameters.neighborList && parameters.neighborList.length > 0) {
                btn.style.display = 'flex';
            } else {
                btn.style.display = 'none';
            }
        }

        function clearLabels() {
            const labels = document.querySelectorAll('.planet-label');
            labels.forEach(l => l.remove());
            const gLabels = document.querySelectorAll('.galaxy-label');
            gLabels.forEach(l => l.remove());
        }

        // ... createTexture, createCosmicBackground, initPostProcessing (Aynƒ± kalƒ±yor) ...
        function createTexture(type) {
            const canvas = document.createElement('canvas'); canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,64,64);
            const gradient = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
            if (type === 'star') { gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); gradient.addColorStop(0.2, 'rgba(255, 255, 255, 0.8)'); gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); } 
            else if (type === 'nebula') { gradient.addColorStop(0, 'rgba(255, 255, 255, 0.5)'); gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); } 
            else if (type === 'comet') { gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); } 
            else if (type === 'explosion') { gradient.addColorStop(0, 'rgba(255, 200, 100, 1)'); gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); }
            ctx.fillStyle = gradient; ctx.fillRect(0, 0, 64, 64);
            const texture = new THREE.Texture(canvas); texture.needsUpdate = true; return texture;
        }

        function createWarpEffect() {
            const count = 1000;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 6); // Her √ßizgi i√ßin 2 nokta * 3 koordinat
            
            for(let i=0; i<count; i++) {
                let x = (Math.random() - 0.5) * 100;
                let y = (Math.random() - 0.5) * 100;
                let z = (Math.random() - 0.5) * 100;
                
                // T√ºnelin ortasƒ±nƒ± bo≈ü bƒ±rak (Kamera g√∂r√º≈ü√º i√ßin)
                if(Math.abs(x) < 2 && Math.abs(y) < 2) {
                    x *= 5; y *= 5;
                }

                // Ba≈ülangƒ±√ß noktasƒ±
                positions[i*6] = x;
                positions[i*6+1] = y;
                positions[i*6+2] = z;
                
                // Biti≈ü noktasƒ± (Ba≈ülangƒ±√ßta aynƒ±, animasyonda uzayacak)
                positions[i*6+3] = x;
                positions[i*6+4] = y;
                positions[i*6+5] = z - 2; 
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const material = new THREE.LineBasicMaterial({
                color: 0x88ccff, // A√ßƒ±k mavi warp rengi
                transparent: true, opacity: 0, blending: THREE.AdditiveBlending, depthWrite: false
            });
            
            warpLines = new THREE.LineSegments(geometry, material);
            warpLines.userData = { opacity: 0 };
            scene.add(warpLines);
        }

        function initPostProcessing() {
            const renderScene = new THREE.RenderPass(scene, camera);
            const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), parameters.bloomStrength, parameters.bloomRadius, parameters.bloomThreshold);
            composer = new THREE.EffectComposer(renderer); composer.addPass(renderScene); composer.addPass(bloomPass); composer.bloomPass = bloomPass;
            
            const caShader = {
                uniforms: { tDiffuse: { value: null }, uAmount: { value: 0.0 } },
                vertexShader: document.getElementById('lensing-vertex').textContent,
                fragmentShader: document.getElementById('chromatic-aberration-fragment').textContent
            };
            chromaticAberrationPass = new THREE.ShaderPass(caShader);
            composer.addPass(chromaticAberrationPass);
        }
        
        function addBlackHoleToGroup(group, bhParams) {
            const size = bhParams.gravityPower;
            
            // YENƒ∞: Renk Ayarƒ± (N√∂tron Yƒ±ldƒ±zƒ± i√ßin saf mavi - beyazla≈ümayƒ± √∂nle)
            let color;
            if (bhParams.type === 'N√∂tron Yƒ±ldƒ±zƒ±') {
                color = new THREE.Color(0x0055ff); // Parlak ve Derin Mavi
            } else {
                color = new THREE.Color(bhParams.insideColor).lerp(new THREE.Color(0xffffff), 0.6);
            }

            const bhGeo = new THREE.SphereGeometry(size, 32, 32);
            
            // YENƒ∞: N√∂tron Yƒ±ldƒ±zƒ± Kontrol√º (Mavi ve Parlak)
            let bhMat;
            if (bhParams.type === 'N√∂tron Yƒ±ldƒ±zƒ±') {
                bhMat = new THREE.MeshBasicMaterial({ color: 0x0055ff }); 
                const light = new THREE.PointLight(0x0055ff, 15, 100); // I≈üƒ±k ≈üiddeti artƒ±rƒ±ldƒ±
                group.add(light);
            } else {
                bhMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
            }
            
            const bhMesh = new THREE.Mesh(bhGeo, bhMat);
            group.add(bhMesh);
            animatedObjects.push({ mesh: bhMesh, type: 'core', speed: 0.5 });

            const haloGeo = new THREE.PlaneGeometry(size * 5.0, size * 5.0);
            const haloMat = new THREE.ShaderMaterial({
                uniforms: { uTime: { value: 0 }, uColor: { value: color } },
                vertexShader: document.getElementById('lensing-vertex').textContent,
                fragmentShader: document.getElementById('lensing-fragment').textContent,
                transparent: true, depthWrite: false, blending: THREE.AdditiveBlending
            });
            const haloMesh = new THREE.Mesh(haloGeo, haloMat);
            group.add(haloMesh);
            animatedObjects.push({ mesh: haloMesh, type: 'halo' });

            const topGeo = new THREE.CylinderGeometry(size * bhParams.jetWidth * 2.5, size * 0.1, bhParams.jetLength, 32, 10, true);
            topGeo.translate(0, bhParams.jetLength / 2, 0);

            const bottomGeo = new THREE.CylinderGeometry(size * bhParams.jetWidth * 2.5, size * 0.1, bhParams.jetLength, 32, 10, true);
            bottomGeo.rotateX(Math.PI);
            bottomGeo.translate(0, -bhParams.jetLength / 2, 0);

            let combinedGeo;
            if (THREE.BufferGeometryUtils) {
                combinedGeo = THREE.BufferGeometryUtils.mergeBufferGeometries([topGeo, bottomGeo]);
            } else {
                combinedGeo = topGeo; 
            }

            const jetMat = new THREE.ShaderMaterial({
                uniforms: { 
                    uTime: { value: 0 }, 
                    uColor: { value: color },
                    uIntensity: { value: bhParams.jetIntensity },
                    uSpeed: { value: bhParams.jetSpeed }
                },
                vertexShader: document.getElementById('jet-vertex').textContent,
                fragmentShader: document.getElementById('jet-fragment').textContent,
                transparent: true, depthWrite: false, blending: THREE.AdditiveBlending, side: THREE.DoubleSide
            });
            
            const jetMesh = new THREE.Mesh(combinedGeo, jetMat);
            group.add(jetMesh);
            animatedObjects.push({ mesh: jetMesh, type: 'jet' });
        }

        function createMicroBlackHoles(group, params, count) {
            for(let i=0; i<count; i++) {
                const r = rng() * params.radius * 0.8;
                const angle = rng() * Math.PI * 2;
                const x = Math.cos(angle) * r;
                const z = Math.sin(angle) * r;
                const y = (rng() - 0.5) * 2.0; 

                const size = 0.03 + rng() * 0.04;
                
                const bhGeo = new THREE.SphereGeometry(size, 16, 16);
                const bhMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
                const bhMesh = new THREE.Mesh(bhGeo, bhMat);
                bhMesh.position.set(x, y, z);

                const haloGeo = new THREE.PlaneGeometry(size * 4.0, size * 4.0);
                const haloMat = new THREE.ShaderMaterial({
                    uniforms: { uTime: { value: 0 }, uColor: { value: new THREE.Color(0xffffff) } },
                    vertexShader: document.getElementById('lensing-vertex').textContent,
                    fragmentShader: document.getElementById('lensing-fragment').textContent,
                    transparent: true, depthWrite: false, blending: THREE.AdditiveBlending
                });
                const haloMesh = new THREE.Mesh(haloGeo, haloMat);
                bhMesh.add(haloMesh); 
                
                const labelDiv = document.createElement('div');
                labelDiv.className = 'planet-label';
                labelDiv.textContent = translations[currentLang].micro_bh; // √áeviriyi kullan
                labelDiv.style.color = "#ff0000"; 
                document.body.appendChild(labelDiv);

                bhMesh.userData = {
                    isPlanet: true, 
                    isBlackHole: true,
                    name: `${translations[currentLang].micro_bh} ${i+1}`,
                    type: "Singularity",
                    distance: r.toFixed(1) + " IY",
                    parentGroup: group,
                    label: labelDiv
                };

                group.add(bhMesh);
                interactables.push(bhMesh);
                animatedObjects.push({ mesh: haloMesh, type: 'halo' });
            }
        }

        function createSpecialSystems(group, systems) {
            if (!systems || !Array.isArray(systems)) return;
            
            systems.forEach(sys => {
                const r = sys.distance;
                const angle = Math.random() * Math.PI * 2;
                const x = Math.cos(angle) * r;
                const z = Math.sin(angle) * r;
                const y = (Math.random() - 0.5) * 0.5;

                const sysGeo = new THREE.SphereGeometry(0.03, 16, 16);
                const sysMat = new THREE.MeshBasicMaterial({ color: sys.color || 0xffffff, toneMapped: false });
                const systemMesh = new THREE.Mesh(sysGeo, sysMat);
                systemMesh.position.set(x, y, z);

                const labelDiv = document.createElement('div');
                labelDiv.className = 'planet-label';
                labelDiv.textContent = sys.name;
                labelDiv.style.color = "#00ff00"; 
                labelDiv.style.fontSize = "10px";
                labelDiv.style.fontWeight = "bold";
                document.body.appendChild(labelDiv);

                systemMesh.userData = { isSystem: true, isLoaded: false, name: sys.name, distance: r.toFixed(1) + " IY", parentGroup: group, label: labelDiv, type: sys.type || 'Bilinmiyor' };
                group.add(systemMesh);
                interactables.push(systemMesh);
            });
        }

        // --- YENƒ∞ GEZEGEN YARATMA FONKSƒ∞YONU ---
        function createPlanetMaterial(type, baseColor) {
            let vertexShader = document.getElementById('planet-vertex').textContent;
            let fragmentShader;
            let uniforms = { uTime: { value: 0 }, uColor1: { value: new THREE.Color() }, uColor2: { value: new THREE.Color() }, uLava: { value: 0.0 }, uAtmosphere: { value: 0.0 } };

            if(type === 'Terra' || type === 'Okyanus') {
                fragmentShader = document.getElementById('planet-terrestrial-fragment').textContent;
                uniforms.uColor1.value.setHex(0x0044aa); // Derin Okyanus
                uniforms.uColor2.value.setHex(0x228822); // Ye≈üil Kara
                if (type === 'Okyanus') uniforms.uColor2.value.setHex(0x0066cc); // Sadece su
            } 
            else if(type === 'Gaz Dev') {
                fragmentShader = document.getElementById('planet-gas-fragment').textContent;
                uniforms.uColor1.value.copy(baseColor);
                uniforms.uColor2.value.copy(baseColor).multiplyScalar(0.7);
            }
            else {
                fragmentShader = document.getElementById('planet-rock-fragment').textContent;
                uniforms.uColor1.value.copy(baseColor);
                uniforms.uColor2.value.copy(baseColor).multiplyScalar(0.5);
                if(type === 'Lav') {
                    uniforms.uLava.value = 1.0;
                    uniforms.uColor1.value.setHex(0x330000); // Koyu ta≈ü
                    uniforms.uColor2.value.setHex(0x110000);
                } else if (type === 'Buzul') {
                    uniforms.uColor1.value.setHex(0xffffff);
                    uniforms.uColor2.value.setHex(0xaaccff);
                } else if (type === '√á√∂l') { // √á√∂l efekti eklendi
                    uniforms.uAtmosphere.value = 0.2; // Hafif tozlu atmosfer
                }
            }

            return new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: vertexShader,
                fragmentShader: fragmentShader
            });
        }

        // --- YENƒ∞ TEK GEZEGEN YARATMA (Olaylar ƒ∞√ßin) ---
        function createSinglePlanet(group, params, typeOverride) {
            const galColorInside = new THREE.Color(params.insideColor);
            const galColorOutside = new THREE.Color(params.outsideColor);
            
            const r = 3 + rng() * (params.radius - 4); 
            const angle = rng() * Math.PI * 2;
            const x = Math.cos(angle) * r;
            const z = Math.sin(angle) * r;
            const y = (rng() - 0.5) * 0.5;

            let type = typeOverride || planetTypes[Math.floor(rng() * planetTypes.length)];
            
            let radius = 0.05;
            if(type === "Gaz Dev") radius = 0.08;
            if(type === "Terra") radius = 0.06;
            
            let baseColor = new THREE.Color();
            if(type === "Gaz Dev") baseColor.setHex(0xd1d1d1);
            else if(type === "Buzul") baseColor.setHex(0xaaddff);
            else if(type === "Lav") baseColor.setHex(0xff3300);
            else if(type === "Okyanus") baseColor.setHex(0x0044ff);
            else if(type === "√á√∂l") baseColor.setHex(0xccaa66);
            else if(type === "Terra") baseColor.setHex(0x228822);
            else baseColor.setHex(0x888888); 
            
            const mixColor = galColorInside.clone().lerp(galColorOutside, r / params.radius);
            baseColor.lerp(mixColor, 0.2); 
            
            const pGeo = new THREE.SphereGeometry(radius, 64, 64);
            const pMat = createPlanetMaterial(type, baseColor);
            
            const planet = new THREE.Mesh(pGeo, pMat);
            planet.position.set(x, y, z);
            
            animatedObjects.push({ mesh: planet, type: 'planet' });

            const pName = generatePlanetName();
            const labelDiv = document.createElement('div');
            labelDiv.className = 'planet-label';
            labelDiv.textContent = pName;
            document.body.appendChild(labelDiv);
            
            planet.userData = {
                isPlanet: true, name: pName, type: type, distance: r.toFixed(1) + " IY", parentGroup: group,
                label: labelDiv 
            };
            
            group.add(planet);
            interactables.push(planet);
            
            return planet; // Referans d√∂nd√ºr
        }

        function createGalaxyGroup(params) {
            const group = new THREE.Group();
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(params.count * 3);
            const cols = new Float32Array(params.count * 3);
            const colorIn = new THREE.Color(params.insideColor);
            const colorOut = new THREE.Color(params.outsideColor);
            
            // YA≈û ETKƒ∞Sƒ∞ (Yƒ±ldƒ±z Renkleri)
            const age = params.galaxyAge !== undefined ? params.galaxyAge : 5.0;
            const isYoung = age < 3.0;
            const isOld = age > 9.0;

            for(let i=0; i<params.count; i++) {
                const i3 = i*3;
                const r = rng() * params.radius;
                const spin = r * params.spin;
                const branch = (i % params.branches) / params.branches * Math.PI * 2;
                const rndX = Math.pow(rng(), params.randomnessPower) * (rng() < 0.5 ? 1 : -1) * params.randomness * r;
                const rndY = Math.pow(rng(), params.randomnessPower) * (rng() < 0.5 ? 1 : -1) * params.randomness * r;
                const rndZ = Math.pow(rng(), params.randomnessPower) * (rng() < 0.5 ? 1 : -1) * params.randomness * r;
                pos[i3] = Math.cos(branch + spin) * r + rndX;
                pos[i3+1] = rndY;
                pos[i3+2] = Math.sin(branch + spin) * r + rndZ;
                const mixedColor = colorIn.clone(); mixedColor.lerp(colorOut, r / params.radius);
                
                // Ya≈üa g√∂re renk tonlamasƒ±
                if (isYoung) mixedColor.lerp(new THREE.Color(0x88ccff), 0.25); // Gen√ß: Maviye √ßal
                if (isOld) mixedColor.lerp(new THREE.Color(0xffaa88), 0.3); // Ya≈ülƒ±: Kƒ±rmƒ±zƒ±ya √ßal

                cols[i3] = mixedColor.r; cols[i3+1] = mixedColor.g; cols[i3+2] = mixedColor.b;
            }
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geo.setAttribute('color', new THREE.BufferAttribute(cols, 3));
            const mat = new THREE.PointsMaterial({ size: params.size, sizeAttenuation: true, depthWrite: false, blending: THREE.AdditiveBlending, vertexColors: true, map: starTexture, transparent: true });
            const mesh = new THREE.Points(geo, mat); group.add(mesh);

            // YA≈û ETKƒ∞Sƒ∞ (Nebula Yoƒüunluƒüu)
            let effectiveNebulaCount = params.nebulaCount;
            if (isYoung) effectiveNebulaCount = Math.floor(effectiveNebulaCount * 1.5); // Gen√ß: √áok nebula
            if (isOld) effectiveNebulaCount = Math.floor(effectiveNebulaCount * 0.3); // Ya≈ülƒ±: Az nebula (gaz bitmi≈ü)
            
            // Performans sƒ±nƒ±rƒ±
            effectiveNebulaCount = Math.min(effectiveNebulaCount, 100000);

            const nebGeo = new THREE.BufferGeometry();
            const nebPos = new Float32Array(effectiveNebulaCount * 3);
            const nebCols = new Float32Array(effectiveNebulaCount * 3);
            for(let i=0; i<effectiveNebulaCount; i++) {
                const i3 = i*3;
                const r = rng() * params.radius;
                const spin = r * params.spin;
                const branch = (i % params.branches) / params.branches * Math.PI * 2;
                const rndX = Math.pow(rng(), params.randomnessPower) * (rng() < 0.5 ? 1 : -1) * (params.randomness + 0.2) * r;
                const rndY = Math.pow(rng(), params.randomnessPower) * (rng() < 0.5 ? 1 : -1) * (parameters.randomness + 0.2) * r;
                const rndZ = Math.pow(rng(), params.randomnessPower) * (rng() < 0.5 ? 1 : -1) * (parameters.randomness + 0.2) * r;
                nebPos[i3] = Math.cos(branch + spin) * r + rndX; nebPos[i3+1] = rndY; nebPos[i3+2] = Math.sin(branch + spin) * r + rndZ;
                const mixedColor = colorIn.clone().lerp(colorOut, r / params.radius);
                nebCols[i3] = mixedColor.r * 1.2; nebCols[i3+1] = mixedColor.g * 0.8; nebCols[i3+2] = mixedColor.b * 1.5;
            }
            nebGeo.setAttribute('position', new THREE.BufferAttribute(nebPos, 3)); nebGeo.setAttribute('color', new THREE.BufferAttribute(nebCols, 3));
            const nebMat = new THREE.PointsMaterial({ size: params.nebulaSize, sizeAttenuation: true, depthWrite: false, blending: THREE.AdditiveBlending, vertexColors: true, map: nebulaTexture, transparent: true, opacity: params.nebulaOpacity });
            group.add(new THREE.Points(nebGeo, nebMat));
            return group;
        }

        // --- YENƒ∞ YILDIZ Sƒ∞STEMƒ∞ OLU≈ûTURUCU (ESKƒ∞ PLANET FONKSƒ∞YONU YERƒ∞NE) ---
        function createStarSystems(group, params, countOverride) {
            const systemCount = countOverride || Math.floor(params.count / 10000); 
            
            for(let i = 0; i < systemCount; i++) {
                // Konum Hesaplama
                const r = rng() * params.radius * 0.9 + 1; 
                const spin = r * params.spin;
                const branchAngle = (i % params.branches) / params.branches * Math.PI * 2;
                const randomness = params.randomness * r * 0.5; 

                const rndX = (rng() - 0.5) * randomness;
                const rndY = (rng() - 0.5) * (randomness * 0.5); 
                const rndZ = (rng() - 0.5) * randomness;

                const x = Math.cos(branchAngle + spin) * r + rndX;
                const z = Math.sin(branchAngle + spin) * r + rndZ;
                const y = rndY;

                // D√úZELTME: Boyut 0.015 yapƒ±ldƒ± (Toz tanesi)
                const sysGeo = new THREE.SphereGeometry(0.015, 8, 8); 
                const sysMat = new THREE.MeshBasicMaterial({ 
                    color: 0xffffff,
                    toneMapped: false // Bloom ile parlamasƒ± i√ßin
                });
                
                const systemMesh = new THREE.Mesh(sysGeo, sysMat);
                systemMesh.position.set(x, y, z);

                const sysName = generatePlanetName() + " Prime"; 
                
                // Etiket
                const labelDiv = document.createElement('div');
                labelDiv.className = 'planet-label';
                labelDiv.textContent = sysName;
                labelDiv.style.color = "#ffd700"; 
                labelDiv.style.fontSize = "9px";
                document.body.appendChild(labelDiv);

                // Veriler
                systemMesh.userData = {
                    isSystem: true, // √ñNEMLƒ∞: Bu bir sistem
                    isLoaded: false,
                    name: sysName,
                    distance: r.toFixed(1) + " IY",
                    parentGroup: group,
                    label: labelDiv
                };

                group.add(systemMesh);
                interactables.push(systemMesh);
            }
        }
        
// --- Sƒ∞STEM DETAYLARINI Y√úKLE (WARP SONRASI) ---
        function buildSolarSystem(systemMesh) {
            if(systemMesh.userData.isLoaded) return; 
            
            // Galaksi ya≈üƒ±nƒ± al
            const parentParams = systemMesh.userData.parentGroup ? systemMesh.userData.parentGroup.userData.params : parameters;
            const age = parentParams.galaxyAge !== undefined ? parentParams.galaxyAge : 5.0;

            // YILDIZ T√úR√ú BELƒ∞RLEME (Varyasyonlar)
            const starChance = rng();
            let starType = 'Main'; // Varsayƒ±lan
            let starSize = 0.02;
            let starColorVal = new THREE.Color().setHSL(rng() * 0.1 + 0.05, 1.0, 0.6);
            let lightIntensity = 2;
            
            // Ya≈üa g√∂re olasƒ±lƒ±klar
            let pNeutron = 0.15;
            let pRedGiant = 0.35; // K√ºm√ºlatif (0.15 + 0.20)
            let pBinary = 0.45;   // K√ºm√ºlatif (0.35 + 0.10)

            if (age < 3.0) {
                // Gen√ß Galaksi: N√∂tron ve Kƒ±zƒ±l Dev az, Mavi Dev (Main) √ßok
                pNeutron = 0.05;
                pRedGiant = 0.10;
                pBinary = 0.20;
            } else if (age > 9.0) {
                // Ya≈ülƒ± Galaksi: N√∂tron ve Kƒ±zƒ±l Dev √ßok
                pNeutron = 0.20;
                pRedGiant = 0.60; // %40 Kƒ±zƒ±l Dev ≈üansƒ±
                pBinary = 0.70;
            }

            if (starChance < pNeutron) {
                starType = 'Neutron'; // N√∂tron Yƒ±ldƒ±zƒ± (K√º√ß√ºk, Mavi, Yoƒüun)
                starSize = 0.005;
                starColorVal = new THREE.Color(0x00ffff);
                lightIntensity = 5;
            } else if (starChance < pRedGiant) {
                starType = 'RedGiant'; // Kƒ±zƒ±l Dev (B√ºy√ºk, Kƒ±rmƒ±zƒ±, S√∂n√ºk)
                starSize = 0.06;
                starColorVal = new THREE.Color(0xff3300);
                lightIntensity = 1.5;
            } else if (starChance < pBinary) {
                starType = 'Binary'; // √áift Yƒ±ldƒ±z (G√∂rsel hile ile)
                starSize = 0.025;
                starColorVal = new THREE.Color(0xffaa00);
            }

            // 1. Geometriyi G√ºncelle
            systemMesh.geometry.dispose();
            systemMesh.geometry = new THREE.SphereGeometry(starSize, 64, 64);
            
            // Binary sistem ise ≈üekli biraz uzat (elipsoid gibi dursun uzaktan)
            if (starType === 'Binary') {
                systemMesh.scale.set(1.5, 1, 1);
            } else {
                systemMesh.scale.set(1, 1, 1);
            }
            
            // Ana Kol Yƒ±ldƒ±zlarƒ± i√ßin Renk Ayarƒ± (Ya≈üa g√∂re)
            if (starType === 'Main') {
                if (age < 3.0) starColorVal = new THREE.Color().setHSL(0.6 + rng()*0.1, 0.9, 0.7); // Mavi/Beyaz (Gen√ß)
                else if (age > 9.0) starColorVal = new THREE.Color().setHSL(0.1 + rng()*0.1, 1.0, 0.8); // Sarƒ±/Turuncu (Ya≈ülƒ±)
            }

            systemMesh.material.dispose();
            systemMesh.material = new THREE.MeshBasicMaterial({ 
                color: starColorVal, 
                toneMapped: false 
            });
            
            // Animasyon i√ßin ba≈ülangƒ±√ß √∂l√ßeƒüi
            const startScale = starType === 'Binary' ? 0.15 : 0.1;
            systemMesh.scale.set(startScale, startScale, startScale); 
            systemMesh.userData.targetScale = 1.0;
            systemMesh.userData.starType = starType; // Animasyon i√ßin kaydet

            // I≈üƒ±k ekle
            const sunLight = new THREE.PointLight(starColorVal, lightIntensity, 100);
            systemMesh.add(sunLight);
            
            // 2. Gezegenleri ekle
            const planetCount = Math.floor(rng() * 5) + 2; 
            
            for(let i=0; i<planetCount; i++) {
                // Kƒ±zƒ±l devlerde gezegenler daha uzakta olur (yutulmamak i√ßin)
                const distOffset = starType === 'RedGiant' ? 0.1 : 0.06;
                const dist = distOffset + (i * 0.04) + (rng() * 0.01);
                
                const angle = rng() * Math.PI * 2;
                const type = planetTypes[Math.floor(rng() * planetTypes.length)];
                
                let pColor = new THREE.Color(rng() * 0xffffff);
                const mat = createPlanetMaterial(type, pColor);
                
                const radius = (type === 'Gaz Dev') ? 0.005 : 0.002; // Gezegenler mikroskobik
                
                // Y√∂r√ºnge √áizgisi (Orbit Line)
                const orbitPoints = [];
                for(let j=0; j<=64; j++) {
                    const th = (j/64) * Math.PI * 2;
                    orbitPoints.push(Math.cos(th) * dist, 0, Math.sin(th) * dist);
                }
                const orbitGeo = new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
                const orbitMat = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.08 });
                const orbitLine = new THREE.Line(orbitGeo, orbitMat);
                orbitLine.userData = { isOrbit: true };
                systemMesh.add(orbitLine);

                const geo = new THREE.SphereGeometry(radius, 32, 32);
                const planet = new THREE.Mesh(geo, mat);
                
                planet.position.set(Math.cos(angle) * dist, (rng()-0.5) * 0.5, Math.sin(angle) * dist);
                
                const pName = generatePlanetName();
                planet.userData = {
                    isPlanet: true,
                    name: pName,
                    type: type,
                    distance: dist.toFixed(1) + " AU",
                    orbitRadius: dist,
                    orbitAngle: angle,
                    orbitSpeed: 0.002 / Math.pow(dist, 1.5) // Hƒ±z dengelendi
                };
                
                systemMesh.add(planet);
                animatedObjects.push({ mesh: planet, type: 'planet' });

                // 3. UYDULAR (MOONS) - Varyasyon ve Rastgelelik
                // Galaksi t√ºr√º "Kaotik" veya "Birle≈üme" ise uydu ≈üansƒ± artar
                let moonChance = 0.3;
                if (parameters.type.includes('Kaotik') || parameters.type.includes('Birle≈üme')) moonChance = 0.7;
                if (type === 'Gaz Dev') moonChance += 0.4; // Gaz devlerinin uydusu olma ihtimali y√ºksek

                if (rng() < moonChance) {
                    const moonCount = Math.floor(rng() * 3) + 1;
                    for(let m=0; m<moonCount; m++) {
                        const mRadius = radius * (0.2 + rng() * 0.2);
                        const mDist = radius * (2.5 + rng() * 2.0);
                        const mAngle = rng() * Math.PI * 2;
                        const mGeo = new THREE.SphereGeometry(mRadius, 8, 8);
                        const mMat = new THREE.MeshBasicMaterial({ color: 0xaaaaaa }); // Basit gri ay
                        const moon = new THREE.Mesh(mGeo, mMat);
                        
                        moon.position.set(Math.cos(mAngle) * mDist, (rng()-0.5)*mDist*0.5, Math.sin(mAngle) * mDist);
                        planet.add(moon);
                    }
                }
            }
            
            systemMesh.userData.isLoaded = true;
        }

        function unloadSolarSystem(systemMesh) {
            if (!systemMesh.userData.isLoaded) return;

            // Iterate backwards to safely remove children (planets, lights)
            for (let i = systemMesh.children.length - 1; i >= 0; i--) {
                const child = systemMesh.children[i];

                // If it's a planet, find and remove it from animatedObjects
                if (child.isMesh && child.userData.isPlanet) {
                    const animIndex = animatedObjects.findIndex(ao => ao.mesh.uuid === child.uuid);
                    if (animIndex > -1) {
                        animatedObjects.splice(animIndex, 1);
                    }
                    // Dispose of its resources
                    child.geometry.dispose();
                    if (child.material.dispose) child.material.dispose();
                }

                // Y√∂r√ºnge √ßizgilerini temizle
                if (child.userData.isOrbit) {
                    child.geometry.dispose();
                    if (child.material.dispose) child.material.dispose();
                }
                
                // Remove child from the system mesh
                systemMesh.remove(child);
            }

            // Reset the system mesh itself to be a small point again
            systemMesh.geometry.dispose();
            systemMesh.geometry = new THREE.SphereGeometry(0.015, 8, 8);

            systemMesh.material.dispose();
            systemMesh.material = new THREE.MeshBasicMaterial({ color: 0xffffff, toneMapped: false });

            // Mark as unloaded
            systemMesh.userData.isLoaded = false;
        }

        function generateDistantNebula() {
            const count = 4000; // Optimizasyon i√ßin makul sayƒ±
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(count * 3);
            const cols = new Float32Array(count * 3);
            
            // Uzak mesafe (60 - 120 birim arasƒ± - Galaksi yarƒ±√ßapƒ± genelde 5-10)
            const dist = 60 + rng() * 60;
            const theta = rng() * Math.PI * 2;
            const phi = (rng() - 0.5) * Math.PI; 
            
            const cx = dist * Math.sin(theta) * Math.cos(phi);
            const cy = dist * Math.sin(phi);
            const cz = dist * Math.cos(theta) * Math.cos(phi);
            
            const hue = rng();
            const type = Math.floor(rng() * 20); // Geni≈ületilmi≈ü t√ºr sayƒ±sƒ±
            
            let blending = THREE.AdditiveBlending;
            let opacity = 0.4;
            let size = 0.8;
            
            for(let i=0; i<count; i++) {
                const i3 = i*3;
                let x = 0, y = 0, z = 0; // NaN √∂nlemek i√ßin ba≈ülangƒ±√ß deƒüeri
                let color = new THREE.Color();

                if (type === 0) { // Yaratƒ±lƒ±≈ü S√ºtunlarƒ± / Kartal (Pillars/Eagle)
                    const pillarId = i % 3;
                    const h = rng() * 30; 
                    const w = 1.0 + rng() * 3.0 * (1.0 - h/30);
                    const noiseX = Math.sin(h * 0.5) * 2.0; // Kƒ±vrƒ±m
                    const noiseZ = Math.cos(h * 0.3) * 2.0;
                    
                    x = (rng() - 0.5) * w + (pillarId * 8) + noiseX; 
                    y = h + (rng() - 0.5) * 3;
                    z = (rng() - 0.5) * w + noiseZ;
                    
                    color.setHSL(hue + (rng()-0.5)*0.1, 0.8, 0.6);
                } 
                else if (type === 1) { // Gezegenimsi / Halka / Helis / K√º√ß√ºk Hayalet (Ring/Helix)
                    const r = 10 + rng() * 2; // ƒ∞nce kabuk
                    const u = rng();
                    const v = rng();
                    const th = 2 * Math.PI * u;
                    const ph = Math.acos(2 * v - 1);
                    
                    x = r * Math.sin(ph) * Math.cos(th);
                    y = r * Math.sin(ph) * Math.sin(th);
                    z = r * Math.cos(ph);
                    
                    color.setHSL((hue + 0.5 * u) % 1.0, 0.9, 0.6);
                }
                else if (type === 2) { // S√ºpernova / Yenge√ß (Supernova/Crab)
                    const r = 15 * Math.pow(rng(), 0.5);
                    const u = rng();
                    const v = rng();
                    const th = 2 * Math.PI * u;
                    const ph = Math.acos(2 * v - 1);
                    
                    const filament = Math.sin(th * 10) * Math.cos(ph * 10); // Doku
                    const rMod = r + filament * 2;

                    x = rMod * Math.sin(ph) * Math.cos(th);
                    y = rMod * Math.sin(ph) * Math.sin(th);
                    z = rMod * Math.cos(ph);
                    
                    color.setHSL(0.0 + rng() * 0.1, 1.0, 0.6); // Genelde kƒ±rmƒ±zƒ±/turuncu
                }
                else if (type === 3) { // H II / Orion / Karina (Diffuse/Orion/Carina)
                    const r = rng() * 15;
                    const th = rng() * Math.PI * 2;
                    const ph = rng() * Math.PI;
                    const noise = Math.sin(r) * 5; // Blob etkisi
                    
                    x = (r + noise) * Math.sin(ph) * Math.cos(th);
                    y = (r + noise) * Math.sin(ph) * Math.sin(th);
                    z = (r + noise) * Math.cos(ph);
                    
                    color.setHSL(0.9 + rng() * 0.2, 0.8, 0.5); // Pembe/Mor
                }
                else if (type === 4) { // Rozet (Rosette)
                    const r = 5 + rng() * 10;
                    const th = rng() * Math.PI * 2;
                    const petal = Math.abs(Math.sin(th * 2.5)); 
                    const rMod = r * (0.5 + 0.5 * petal);
                    
                    x = rMod * Math.cos(th);
                    y = (rng() - 0.5) * 5; // Yassƒ±
                    z = rMod * Math.sin(th);
                    
                    color.setHSL(0.0 + rng() * 0.1, 0.9, 0.5); 
                }
                else if (type === 5) { // Karanlƒ±k / Atba≈üƒ± (Dark/Horsehead)
                    blending = THREE.NormalBlending; // I≈üƒ±ƒüƒ± kesmesi i√ßin
                    opacity = 0.8;
                    size = 1.5;
                    
                    const r = rng() * 15;
                    const th = rng() * Math.PI * 2;
                    const ph = rng() * Math.PI;
                    
                    x = r * Math.sin(ph) * Math.cos(th) + (rng()-0.5)*2;
                    y = r * Math.sin(ph) * Math.sin(th) * 0.5 + (rng()-0.5)*2;
                    z = r * Math.cos(ph) + (rng()-0.5)*2;
                    
                    color.setRGB(0.02, 0.02, 0.02); // Koyu gri/siyah
                }
                else if (type === 6) { // Karƒ±nca / Kum Saati (Ant/Hourglass)
                    const t = rng() * Math.PI * 2;
                    const h = (rng() - 0.5) * 2; 
                    const r = 0.5 + Math.abs(h) * 4.0 * rng(); 
                    
                    x = r * Math.cos(t);
                    y = h * 10.0;
                    z = r * Math.sin(t);
                    
                    color.setHSL(hue + h*0.1, 0.8, 0.6);
                }
                else if (type === 7) { // Barnard ƒ∞lmiƒüi (Loop)
                    const t = rng() * Math.PI; 
                    const r = 15 + rng() * 2;
                    const tubeR = 2 * rng();
                    
                    x = (r + tubeR * Math.cos(rng()*Math.PI*2)) * Math.cos(t);
                    y = (r + tubeR * Math.cos(rng()*Math.PI*2)) * Math.sin(t);
                    z = tubeR * Math.sin(rng()*Math.PI*2);
                    
                    color.setHSL(0.0, 1.0, 0.4); 
                }
                else if (type === 8) { // Bumerang (Boomerang)
                    const t = rng() * Math.PI * 2;
                    const r = rng() * 10;
                    const width = Math.abs(Math.cos(t)) * r + 0.5;
                    
                    x = width * Math.cos(t);
                    y = (rng()-0.5) * 2;
                    z = width * Math.sin(t);
                    
                    color.setHSL(0.6, 0.5, 0.7); 
                }
                else if (type === 9) { // Kedi G√∂z√º (Cat's Eye)
                    const t = rng() * Math.PI * 2;
                    const layer = rng() > 0.5 ? 1 : 0.5;
                    const r = 5 * layer + rng();
                    const x0 = r * Math.cos(t);
                    const z0 = r * Math.sin(t);
                    const y0 = (rng()-0.5) * r;
                    const rot = layer === 1 ? 0 : Math.PI/2;
                    x = x0 * Math.cos(rot) - z0 * Math.sin(rot);
                    z = x0 * Math.sin(rot) + z0 * Math.cos(rot);
                    y = y0;
                    color.setHSL(0.1 + layer * 0.4, 0.8, 0.5);
                }
                else if (type === 10) { // Eskimo
                    const isInner = rng() > 0.7;
                    const r = isInner ? 3 + rng() : 8 + rng() * 4; 
                    const u = rng();
                    const v = rng();
                    const th = 2 * Math.PI * u;
                    const ph = Math.acos(2 * v - 1);
                    x = r * Math.sin(ph) * Math.cos(th);
                    y = r * Math.sin(ph) * Math.sin(th);
                    z = r * Math.cos(ph);
                    color.setHSL(isInner ? 0.1 : 0.6, 0.8, 0.5);
                }
                else if (type === 11) { // Tarantula
                    const arms = 8;
                    const armIndex = Math.floor(rng() * arms);
                    const t = (armIndex / arms) * Math.PI * 2 + (rng() - 0.5) * 0.5;
                    const r = rng() * 15;
                    const noise = Math.sin(r * 2) * 2;
                    x = (r + noise) * Math.cos(t);
                    y = (rng() - 0.5) * 5;
                    z = (r + noise) * Math.sin(t);
                    color.setHSL(0.9, 0.7, 0.6); 
                }
                else if (type === 12) { // Tilki K√ºrk√º / Pelikan (Fox Fur/Pelican)
                    const w = 10;
                    const h = 15;
                    x = (rng() - 0.5) * w;
                    y = (rng() - 0.5) * h;
                    z = (rng() - 0.5) * 5;
                    const noise = Math.sin(x) * Math.cos(y);
                    z += noise * 2;
                    color.setHSL(0.05, 0.6, 0.4); 
                }
                else if (type === 13) { // Bayku≈ü (Owl)
                    const r = 8 + rng();
                    const u = rng();
                    const v = rng();
                    const th = 2 * Math.PI * u;
                    const ph = Math.acos(2 * v - 1);
                    x = r * Math.sin(ph) * Math.cos(th);
                    y = r * Math.sin(ph) * Math.sin(th);
                    z = r * Math.cos(ph);
                    if (Math.abs(x) < 3 && Math.abs(y) > 2) { x = 0; y = 0; z = 0; size = 0; }
                    color.setHSL(0.5, 0.6, 0.5); 
                }
                else if (type === 14) { // Kelebek (Butterfly)
                    const t = rng() * Math.PI * 2;
                    const r = rng() * 10;
                    const wings = Math.abs(Math.sin(t * 2)); 
                    const rMod = r * wings;
                    x = rMod * Math.cos(t);
                    y = (rng()-0.5) * rMod * 0.5;
                    z = rMod * Math.sin(t);
                    color.setHSL(0.0, 1.0, 0.5);
                }
                else if (type === 15) { // Deniz Kulaƒüƒ± (Lagoon)
                    const r = rng() * 12;
                    const t = rng() * Math.PI * 2;
                    if (Math.abs(Math.cos(t)) < 0.1) size = 0;
                    x = r * Math.cos(t);
                    y = (rng()-0.5) * 8;
                    z = r * Math.sin(t);
                    color.setHSL(0.95, 0.8, 0.6);
                }
                else if (type === 16) { // Pe√ße (Veil)
                    const t = rng() * Math.PI * 0.5; 
                    const r = 15 + (rng()-0.5) * 1;
                    x = r * Math.cos(t);
                    y = (rng()-0.5) * 10; 
                    z = r * Math.sin(t) + Math.sin(y)*2; 
                    color.setHSL(0.5 + rng()*0.2, 0.8, 0.6);
                }
                else if (type === 17) { // Kuzey Amerika (North America)
                    x = (rng() - 0.5) * 15;
                    y = (rng() - 0.5) * 15;
                    z = (rng() - 0.5) * 5;
                    if (x > 0 && y < 0) size = 0;
                    color.setHSL(0.9, 0.7, 0.5);
                }
                else if (type === 18) { // Kalp / Ruh (Heart/Soul)
                    const t = rng() * Math.PI * 2;
                    const r = 10 * (1 - Math.abs(t - Math.PI)/Math.PI); 
                    x = r * Math.cos(t);
                    y = r * Math.sin(t) + Math.abs(x)*0.5;
                    z = (rng()-0.5) * 5;
                    color.setHSL(0.0, 0.8, 0.4);
                }
                else { // Default
                    const r = rng() * 10;
                    const t = rng() * Math.PI * 2;
                    const p = rng() * Math.PI;
                    x = r * Math.sin(p) * Math.cos(t);
                    y = r * Math.sin(p) * Math.sin(t);
                    z = r * Math.cos(p);
                    color.setHSL(rng(), 0.5, 0.5);
                }

                pos[i3] = x; pos[i3+1] = y; pos[i3+2] = z;
                cols[i3] = color.r; cols[i3+1] = color.g; cols[i3+2] = color.b;
            }
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geo.setAttribute('color', new THREE.BufferAttribute(cols, 3));
            
            const mat = new THREE.PointsMaterial({ 
                size: size, 
                transparent: true, 
                opacity: opacity, 
                vertexColors: true, 
                map: nebulaTexture, 
                depthWrite: false, 
                blending: blending 
            });
            
            const mesh = new THREE.Points(geo, mat);
            mesh.position.set(cx, cy, cz);
            mesh.lookAt(0,0,0); // Merkeze baksƒ±n
            mesh.rotation.z = rng() * Math.PI; // Rastgele a√ßƒ±
            
            scene.add(mesh); specialStructures.push(mesh);
        }
        
        // --- √áARPI≈ûMA KONTROL√ú ---
        function checkGalacticCollision() {
            if(isCollisionActive) return;
            if(galaxyGroups.length < 2) return;
            collisionMainGroup = galaxyGroups.find(g => g.userData.isMain);
            collisionTargetGroup = galaxyGroups.find(g => g.userData.isNeighbor);
            if(!collisionMainGroup || !collisionTargetGroup) return;
        }
        
        function startGalacticCollision() {
            isCollisionActive = true;
            collisionProgress = 0;
            
            // YENƒ∞: √ñl√ºm Sarmalƒ± (Death Spiral) Ba≈ülangƒ±√ß Deƒüerleri
            // ƒ∞ki galaksinin orta noktasƒ±nƒ± bul
            collisionCenter.copy(collisionMainGroup.position).add(collisionTargetGroup.position).multiplyScalar(0.5);
            
            // Ba≈ülangƒ±√ß yarƒ±√ßapƒ± (Merkeze olan uzaklƒ±k)
            collisionRadius = collisionMainGroup.position.distanceTo(collisionCenter);
            
            // Ba≈ülangƒ±√ß a√ßƒ±sƒ±
            collisionAngle = Math.atan2(collisionMainGroup.position.z - collisionCenter.z, collisionMainGroup.position.x - collisionCenter.x);
            
            // YENƒ∞: Sesi Ba≈ülat
            if(collisionSound) {
                collisionSound.currentTime = 0;
                collisionSound.volume = 0.5;
                collisionSound.play().catch(e => console.log("Ses √ßalma hatasƒ±:", e));
            }

            const t = translations[currentLang].events;
            const notif = document.getElementById('event-notification');
            document.getElementById('event-title').innerText = t.collision_t;
            document.getElementById('event-title').style.color = "#ff0000";
            document.getElementById('event-desc').innerText = t.collision_d;
            notif.style.opacity = 1;
            setTimeout(() => { notif.style.opacity = 0; }, 5000);

            // Kuyruklu yƒ±ldƒ±zlarƒ± temizle (√áarpƒ±≈üma sƒ±rasƒ±nda kafa karƒ±≈ütƒ±rmasƒ±n)
            comets.forEach(c => c.dispose());
            comets = [];
        }
        
        function mergeGalaxies() {
            isCollisionActive = false;

            // YENƒ∞: Sesi Durdur (Fade Out)
            if(collisionSound) {
                const fadeOut = setInterval(() => {
                    if(collisionSound.volume > 0.05) {
                        collisionSound.volume -= 0.05;
                    } else {
                        collisionSound.pause();
                        collisionSound.volume = 0.5;
                        clearInterval(fadeOut);
                    }
                }, 100);
            }

            for(let i=0; i<20; i++) {
                 // Patlamalar merkezde olsun (Yeni galaksi merkeze oturacak)
                 // Tidal Tails Efekti: √áok yava≈ü s√∂nen (0.002) ve geni≈ü yayƒ±lan (0.5 hƒ±z) par√ßacƒ±klar
                 explosions.push(new Explosion(new THREE.Vector3(0,0,0), new THREE.Color(0xffffff), 0.002, 0.5));
            }

            // 1. Hayatta Kalanlarƒ± Belirle (BUG FIX: Diƒüer kom≈üular silinmesin)
            const survivors = galaxyGroups.filter(g => g !== collisionMainGroup && g !== collisionTargetGroup);

            // 2. √áarpƒ±≈üanlarƒ± Sahneden Sil
            scene.remove(collisionMainGroup);
            scene.remove(collisionTargetGroup);

            // Etiketleri temizle
            if (collisionTargetGroup.userData.label) collisionTargetGroup.userData.label.remove();
            if (collisionMainGroup.userData.label) collisionMainGroup.userData.label.remove();

            // 3. Etkile≈üimli Objeleri (Gezegenler vb.) Filtrele
            interactables = interactables.filter(p => {
                if (p.userData.parentGroup === collisionMainGroup || p.userData.parentGroup === collisionTargetGroup) {
                     if(p.userData.label) p.userData.label.remove();
                     return false;
                }
                return true;
            });

            // 4. Animasyonlu Objeleri Filtrele
            animatedObjects = animatedObjects.filter(obj => {
                let parent = obj.mesh.parent;
                if (parent === collisionMainGroup || parent === collisionTargetGroup) return false;
                return true;
            });

            // 5. Global Listeyi G√ºncelle
            galaxyGroups = [...survivors];

            // 6. Parametreleri G√ºncelle (√ñlen kom≈üuyu listeden sil)
            if (collisionTargetGroup.userData.params && parameters.neighborList) {
                parameters.neighborList = parameters.neighborList.filter(n => n.name !== collisionTargetGroup.userData.params.name);
            }

            // 7. Yeni Mega Galaksiyi Yarat
            const mainParams = collisionMainGroup.userData.params;
            const targetParams = collisionTargetGroup.userData.params;

            // N√∂tron Yƒ±ldƒ±zƒ± √áarpƒ±≈ümasƒ± Kontrol√º
            const isNeutronCollision = (mainParams.type === 'N√∂tron Yƒ±ldƒ±zƒ±' || targetParams.type === 'N√∂tron Yƒ±ldƒ±zƒ±');

            const newParams = { ...parameters };
            newParams.radius = Math.max(mainParams.radius, targetParams.radius) * 1.8;
            newParams.count = mainParams.count + targetParams.count;
            newParams.type = isNeutronCollision ? "Kilonova Kalƒ±ntƒ±sƒ±" : "Kaotik Birle≈üme";
            
            // SA√áILMA EFEKTƒ∞ (ƒ∞stek #3)
            newParams.randomness = 1.5; 
            newParams.spin = (mainParams.spin + targetParams.spin) / 2 + 1.0; 
            newParams.insideColor = interpolateColors(mainParams.insideColor, targetParams.insideColor, 0.5);
            newParams.outsideColor = interpolateColors(mainParams.outsideColor, targetParams.outsideColor, 0.5);
            newParams.gravityPower = Math.max(mainParams.gravityPower, targetParams.gravityPower) * 2.0;

            const newGroup = createGalaxyGroup(newParams);
            newGroup.userData.isMain = true;
            newGroup.userData.isGalaxy = true;
            newGroup.userData.params = newParams;
            
            // Galaksiyi merkeze oturt (Kamera ve sistemler i√ßin)
            newGroup.position.set(0, 0, 0);
            
            // YENƒ∞: Doƒüum Animasyonu (K√º√ß√ºkten b√ºy√ºƒüe patlama efekti)
            newGroup.scale.set(0.01, 0.01, 0.01); // √áok k√º√ß√ºk ba≈üla
            newGroup.userData.isBorn = true; // B√ºy√ºme animasyonunu tetikle

            // ≈ûok Dalgasƒ± Efekti
            shockwaves.push(new Shockwave(newGroup.position, new THREE.Color(newParams.insideColor).lerp(new THREE.Color(0xffffff), 0.5)));

            scene.add(newGroup);
            galaxyGroups.push(newGroup);

            if (!isNeutronCollision) {
                addBlackHoleToGroup(newGroup, newParams);
                createStarSystems(newGroup, newParams);
                // Mƒ∞KRO KARADELƒ∞KLER (ƒ∞stek #2)
                createMicroBlackHoles(newGroup, newParams, 5); 
                // BAYRAK EKLE (YENƒ∞)
                newParams.hasMicroBlackHoles = true;
            } else {
                // N√∂tron yƒ±ldƒ±zƒ± √ßarpƒ±≈ümasƒ±nda karadelik ve yƒ±ldƒ±z sistemleri olu≈üturma
                // Sadece merkezi bir parlama ekle
                const light = new THREE.PointLight(0xffffff, 5, 50);
                newGroup.add(light);
            }

            Object.assign(parameters, newParams);
            // D√úZELTME: VERƒ∞ SENKRONƒ∞ZASYONU
            // Mevcut parametreleri galaxies listesindeki veriye kaydet
            Object.assign(galaxies[currentGalaxyIndex], newParams);

            parameters.name = "MEGA-" + generateCreativeGalaxyName();
            galaxies[currentGalaxyIndex].name = parameters.name; // ƒ∞sim de g√ºncellenmeli

            // Kamera Sarsƒ±ntƒ±sƒ±
            let shake = 0;
            const shaker = setInterval(() => {
                shake += 0.1;
                camera.fov = 75 + Math.sin(shake * 10) * 2;
                camera.updateProjectionMatrix();
                if(shake > 2) {
                    clearInterval(shaker);
                    camera.fov = 75;
                    camera.updateProjectionMatrix();
                }
            }, 16);
            
            // Kamera konumunu g√ºvenli bir yere √ßek (karadeliƒüin i√ßi olmasƒ±n)
            camera.position.set(0, 10, 20);
            controls.target.set(0,0,0);

            // Aray√ºz g√ºncelle
            updateGalaxyNameDisplay();
            
            // D√úZELTME: Listeyi yenile
            renderGalaxyList();
            updateCollisionButtonVisibility();
            setupGUI();
        }

        // --- OLAY Sƒ∞STEMƒ∞ ---
        function triggerCosmicEvent() {
            const chance = Math.random();
            const speedFactor = Math.abs(parameters.timeSpeed);
            
            if (speedFactor < 2.0) return; 
            if (chance > 0.0005 * speedFactor) return; 

            const eventTypes = ['SUPERNOVA', 'ICE_AGE', 'GAMMA_BURST', 'LIFE_BOOM'];
            const eventType = eventTypes[Math.floor(Math.random() * eventTypes.length)];
            
            showEventNotification(eventType);
            applyEventEffects(eventType);
        }

        function showEventNotification(type) {
            const t = translations[currentLang].events;
            const notif = document.getElementById('event-notification');
            const title = document.getElementById('event-title');
            const desc = document.getElementById('event-desc');
            
            notif.style.opacity = 1;
            
            if(type === 'SUPERNOVA') {
                title.innerText = t.supernova_t;
                title.style.color = "#ef4444";
                desc.innerText = t.supernova_d;
            } else if(type === 'ICE_AGE') {
                title.innerText = t.ice_age_t;
                title.style.color = "#3b82f6";
                desc.innerText = t.ice_age_d;
            } else if(type === 'GAMMA_BURST') {
                title.innerText = t.gamma_t;
                title.style.color = "#a855f7";
                desc.innerText = t.gamma_d;
            } else if(type === 'LIFE_BOOM') {
                title.innerText = t.life_t;
                title.style.color = "#22c55e";
                desc.innerText = t.life_d;
            }

            setTimeout(() => {
                notif.style.opacity = 0;
            }, 4000);
        }

        function applyEventEffects(type) {
            const mainGroup = galaxyGroups.find(g => g.userData.isMain);
            if(!mainGroup) return;

            if(type === 'SUPERNOVA') {
                if(interactables.length > 0) {
                    const targetIndex = Math.floor(Math.random() * interactables.length);
                    const targetPlanet = interactables[targetIndex];
                    const centerPos = targetPlanet.position.clone();
                    
                    explosions.push(new Explosion(targetPlanet.position, new THREE.Color(0xff0000)));
                    
                    for (let i = interactables.length - 1; i >= 0; i--) {
                        const p = interactables[i];
                        if (p.position.distanceTo(centerPos) < 5.0) { 
                            if(p.parent) p.parent.remove(p);
                            if(p.userData.label) p.userData.label.remove();
                            interactables.splice(i, 1);
                        }
                    }
                }
            } 
            else if(type === 'ICE_AGE') {
                for(let i=0; i<3; i++) {
                    if(interactables.length > 0) {
                        const p = interactables[Math.floor(Math.random() * interactables.length)];
                        p.material = createPlanetMaterial('Buzul', new THREE.Color(0xaaddff));
                        p.userData.type = 'Buzul';
                    }
                }
            } 
            else if(type === 'GAMMA_BURST') {
                interactables.forEach(p => {
                    if(Math.random() > 0.5) {
                        p.material = createPlanetMaterial('√á√∂l', new THREE.Color(0xccaa66));
                        p.userData.type = '√ñl√º Gezegen';
                        if(p.material.uniforms.uAtmosphere) p.material.uniforms.uAtmosphere.value = 0.0;
                    }
                });
            } 
            else if(type === 'LIFE_BOOM') {
                createSinglePlanet(mainGroup, parameters, 'Terra');
            }
        }

        function onMouseMove(event) {
            // Eƒüer Freecam modu aktifse ve s√ºr√ºkleme yapƒ±lƒ±yorsa, mouse hareketini raycaster'a g√∂nderme
            if (isFreeCam && isDragging) {
                // Kamera d√∂n√º≈ü√º
                const movementX = event.movementX || event.mozMovementX || 0;
                const movementY = event.movementY || event.mozMovementY || 0;
                
                // Euler rotasyonunu g√ºncelle
                // Y ekseni etrafƒ±nda d√∂n√º≈ü (Yaw) - Saƒüa sola bakma
                camera.rotation.y -= movementX * 0.002;
                
                // X ekseni etrafƒ±nda d√∂n√º≈ü (Pitch) - Yukarƒ± a≈üaƒüƒ± bakma
                camera.rotation.x -= movementY * 0.002;

                // X ekseni rotasyonunu sƒ±nƒ±rlama (Tepetaklak olmayƒ± √∂nle)
                camera.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, camera.rotation.x));
                
                return;
            }

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            
            const intersectsObj = raycaster.intersectObjects(interactables);
            
            let foundTarget = false;

            if (intersectsObj.length > 0) {
                hoveredObject = intersectsObj[0].object;
                foundTarget = true;
                
                const data = hoveredObject.userData;
                const t = translations[currentLang];
                updateScanner(t.scan_locked, data.name, getTranslatedPlanetType(data.type), data.distance, t.status_analyze);
            } else {
                let allPoints = [];
                galaxyGroups.forEach(g => {
                     if(g.userData.isNeighbor) allPoints.push(...g.children);
                });
                
                const intersectsPoints = raycaster.intersectObjects(allPoints);
                if (intersectsPoints.length > 0) {
                    const parentGroup = intersectsPoints[0].object.parent;
                    if (parentGroup && parentGroup.userData.isNeighbor) {
                        if (parentGroup.uuid !== activeWarpTargetUUID) {
                            hoveredObject = parentGroup;
                            foundTarget = true;
                            
                            const p = parentGroup.userData.params;
                            const t = translations[currentLang];
                            const dist = Math.floor(parentGroup.position.distanceTo(camera.position)) + " IY";
                            // Kom≈üu galaksiye bakarken
                            const locLabel = t.loc_prefix || "Konum:";
                            const typeLabel = getTranslatedGalaxyType(p.type);
                            // Scanner status alanƒ±nƒ± kullanarak bilgiyi g√∂steriyoruz
                            updateScanner(t.warp_btn, p.name, typeLabel, dist, t.status_unknown);
                        }
                    }
                }
            }

            if(foundTarget) {
                document.body.style.cursor = 'pointer';
                document.getElementById('scanner').classList.add('active', 'clickable');
            } else {
                document.getElementById('scanner').classList.remove('active', 'clickable');
                document.body.style.cursor = isFreeCam ? 'move' : 'crosshair';
                hoveredObject = null;
            }
        }

        function onMouseClick(event) {
            if (isFreeCam) return;

            if (hoveredObject) {
                // Kom≈üu Galaksi Kontrol√º
                if (hoveredObject.userData.isNeighbor) {
                    warpToTarget(hoveredObject, hoveredObject.userData.params.name, true);
                } 
                // D√úZELTME: Hem Gezegen HEM DE Sistem kontrol√º eklendi
                else if (hoveredObject.userData.isPlanet || hoveredObject.userData.isSystem) {
                    warpToTarget(hoveredObject, hoveredObject.userData.name, false);
                }
            }
        }
        
        function updateScanner(status, target, cls, dist, life) {
            document.getElementById('scan-status-text').innerText = status;
            document.getElementById('scan-target').innerText = target;
            document.getElementById('scan-class').innerText = cls;
            document.getElementById('scan-dist').innerText = dist;
            document.getElementById('scan-life').innerText = life;
        }

        function setupGUI() {
            if(gui) gui.destroy();
            
            const t = translations[currentLang].gui;
            const t_main = translations[currentLang];

            gui = new lil.GUI({ title: t_main.galaxy_label + ' ' + parameters.name });
            
            // Temalar nesnesinin anahtarlarƒ±nƒ± alƒ±p √ßeviri yapmamƒ±z gerekmiyor √ß√ºnk√º tema isimleri √∂zel isim gibi kalabilir
            // veya manuel √ßevrilebilir. ≈ûimdilik olduƒüu gibi bƒ±rakƒ±yoruz.
            gui.add(parameters, 'theme', Object.keys(themes)).name(t.theme).onChange(val => {
                const theme = themes[val]; parameters.insideColor = theme.in; parameters.outsideColor = theme.out;
                generateGalaxy(); 
            });
            
            const timeFolder = gui.addFolder(t.folder_time);
            timeFolder.add(parameters, 'timeSpeed', -20, 20).name(t.time_flow).listen();
            timeFolder.add(parameters, 'planetEvolutionSpeed', 0, 10).name(t.planet_evol);
            timeFolder.open();

            const struct = gui.addFolder(t.folder_struct);
            struct.add(parameters, 'count').min(1000).max(100000).step(1000).name(t.star_count).onFinishChange(generateGalaxy);
            struct.add(parameters, 'galaxyAge', 0.1, 13.8).step(0.1).name(t.galaxy_age).onFinishChange(generateGalaxy);
            struct.add(parameters, 'radius').min(1).max(20).step(0.1).name(t.radius).onFinishChange(generateGalaxy);
            struct.add(parameters, 'branches').min(2).max(12).step(1).name(t.branches).onFinishChange(generateGalaxy);
            struct.add(parameters, 'spin').min(-5).max(5).step(0.05).name(t.spin).onFinishChange(generateGalaxy);
            struct.add(parameters, 'nebulaOpacity', 0, 1).name(t.nebula_op).onFinishChange(generateGalaxy);
            struct.add(parameters, 'dustOpacity', 0, 1).name(t.dust_op).onFinishChange(generateGalaxy);
            struct.addColor(parameters, 'insideColor').name(t.in_color).onChange(generateGalaxy);
            struct.addColor(parameters, 'outsideColor').name(t.out_color).onChange(generateGalaxy);
            
            const gfx = gui.addFolder(t.folder_graphics);
            gfx.add(parameters, 'showFPS').name(t.show_fps).onChange(val => {
                if(stats) stats.dom.style.display = val ? 'block' : 'none';
            });
            gfx.add(parameters, 'resolution', ['Native', '1280x720', '1366x768', '1600x900', '1920x1080', '2560x1440', '3840x2160']).name(t.resolution).onChange(val => {
                onWindowResize(); // √á√∂z√ºn√ºrl√ºk deƒüi≈üikliƒüini uygula
            });
            
            const phys = gui.addFolder(t.folder_phys);
            phys.add(parameters, 'gravityPower', 0.01, 0.8).name(t.gravity).onChange(generateGalaxy);
            phys.add(parameters, 'rotationSpeed').min(0).max(100.0).name(t.rot_speed); // Max hƒ±z ƒ±≈üƒ±k hƒ±zƒ± i√ßin artƒ±rƒ±ldƒ±
            phys.add(parameters, 'cometFrequency', 0, 0.2).name(t.comet_freq);
            
            const jet = gui.addFolder(t.folder_quasar);
            jet.add(parameters, 'jetLength', 1, 20).name(t.jet_len).onChange(generateGalaxy);
            jet.add(parameters, 'jetIntensity', 0.1, 5.0).name(t.jet_int).onChange(v => { 
                animatedObjects.forEach(obj => { if(obj.type === 'jet') obj.mesh.material.uniforms.uIntensity.value = v; });
            });
            jet.add(parameters, 'jetSpeed', 0.1, 5.0).name(t.jet_spd).onChange(v => { 
                animatedObjects.forEach(obj => { if(obj.type === 'jet') obj.mesh.material.uniforms.uSpeed.value = v; });
            });
            
            gui.add(parameters, 'cinematic').name(t.cinematic).onChange(val => {
                controls.autoRotate = val; 
                document.getElementById('cinematic-mode').style.display = val ? 'block' : 'none';
            });
        }

        // --- SENARYO Sƒ∞STEMƒ∞ (JS TABANLI) ---
        const defaultScenarios = [
            {
                id: 'milky_way', title: 'Samanyolu', type: 'Spiral', icon: 'üåå',
                desc: 'Evimiz. 4 kollu sarmal yapƒ±.',
                params: { 
                    name: 'Samanyolu', type: 'Spiral', branches: 4, insideColor: '#f8f9fa', outsideColor: '#4b6cb7', radius: 8, spin: 1, seed: 12345,
                    neighborList: [
                        { 
                            name: 'Andromeda', type: 'Spiral', branches: 2, insideColor: '#ffeebb', outsideColor: '#6688cc', radius: 10, count: 30000, offset: { x: 300, y: 50, z: -300 }, rotation: { x: 0.5, z: 0.5 },
                            specialSystems: [
                                { name: "Andromeda Core", type: "Singularity", distance: 1.0, color: 0xffffff },
                                { name: "Mayall II", type: "K√ºme", distance: 3.0, color: 0xffffaa },
                                { name: "PA-99-N2", type: "Egzotik", distance: 7.0, color: 0x00ff00 },
                                { name: "Alpheratz", type: "Buzul", distance: 5.0, color: 0xaaaaff },
                                { name: "Mirach", type: "Gaz Dev", distance: 6.5, color: 0xffcc00 }
                            ]
                        }
                    ],
                    specialSystems: [
                        { name: "G√ºne≈ü Sistemi", type: "Terra", distance: 5.5, color: 0xffff00 },
                        { name: "Proxima Centauri", type: "Kayalƒ±k", distance: 5.6, color: 0xff0000 },
                        { name: "Trappist-1", type: "Kayalƒ±k", distance: 5.8, color: 0xff3300 },
                        { name: "Betelgeuse", type: "Gaz Dev", distance: 4.2, color: 0xff5500 },
                        { name: "Rigel", type: "Buzul", distance: 4.8, color: 0x00ffff },
                        { name: "UY Scuti", type: "Lav", distance: 3.5, color: 0xff0000 },
                        { name: "Kepler-186", type: "Terra", distance: 6.0, color: 0xffaa00 }
                    ]
                }
            },
            {
                id: 'andromeda', title: 'Andromeda', type: 'Spiral', icon: 'üåÄ',
                desc: 'En yakƒ±n dev kom≈üu.',
                params: { 
                    name: 'Andromeda', type: 'Spiral', branches: 2, insideColor: '#ffeebb', outsideColor: '#6688cc', radius: 10, spin: 0.8, seed: 67890,
                    neighborList: [
                        { 
                            name: 'Samanyolu', type: 'Spiral', branches: 4, insideColor: '#f8f9fa', outsideColor: '#4b6cb7', radius: 8, count: 30000, offset: { x: -300, y: -50, z: 300 }, rotation: { x: -0.5, z: -0.5 },
                            specialSystems: [
                                { name: "G√ºne≈ü Sistemi", type: "Terra", distance: 5.5, color: 0xffff00 },
                                { name: "Proxima Centauri", type: "Kayalƒ±k", distance: 5.6, color: 0xff0000 },
                                { name: "Trappist-1", type: "Kayalƒ±k", distance: 5.8, color: 0xff3300 },
                                { name: "Betelgeuse", type: "Gaz Dev", distance: 4.2, color: 0xff5500 },
                                { name: "Rigel", type: "Buzul", distance: 4.8, color: 0x00ffff },
                                { name: "UY Scuti", type: "Lav", distance: 3.5, color: 0xff0000 },
                                { name: "Kepler-186", type: "Terra", distance: 6.0, color: 0xffaa00 }
                            ]
                        }
                    ],
                    specialSystems: [
                        { name: "Andromeda Core", type: "Singularity", distance: 1.0, color: 0xffffff },
                        { name: "Mayall II", type: "K√ºme", distance: 3.0, color: 0xffffaa },
                        { name: "PA-99-N2", type: "Egzotik", distance: 7.0, color: 0x00ff00 },
                        { name: "Alpheratz", type: "Buzul", distance: 5.0, color: 0xaaaaff },
                        { name: "Mirach", type: "Gaz Dev", distance: 6.5, color: 0xffcc00 }
                    ]
                }
            },
            {
                id: 'ic1101', title: 'IC-1101', type: 'Eliptik', icon: 'üü°',
                desc: 'Bilinen en b√ºy√ºk galaksi.',
                params: { name: 'IC-1101', type: 'Eliptik', branches: 0, insideColor: '#ffcc00', outsideColor: '#ffaa00', radius: 18, count: 100000, seed: 112233 }
            },
            {
                id: 'triangulum', title: 'Triangulum', type: 'Spiral', icon: '‚ú®',
                desc: 'Yerel grubun √º√ß√ºnc√ºs√º.',
                params: { name: 'Triangulum', type: 'Spiral', branches: 3, insideColor: '#ffffff', outsideColor: '#88ccff', radius: 6, spin: 1.2, seed: 445566 }
            },
            {
                id: 'sombrero', title: 'Sombrero', type: 'Spiral', icon: 'üõ∏',
                desc: 'Belirgin bir √ßekirdek.',
                params: { name: 'Sombrero', type: 'Spiral', branches: 5, insideColor: '#ffddaa', outsideColor: '#ffffff', radius: 7, spin: 2, seed: 778899 }
            },
            {
                id: 'cartwheel', title: 'Cartwheel', type: 'Kaotik', icon: 'üé°',
                desc: 'Halka benzeri yapƒ±.',
                params: { name: 'Cartwheel', type: 'Kaotik', branches: 0, insideColor: '#ff00ff', outsideColor: '#00ffff', radius: 9, randomness: 1.0, seed: 990011 }
            },
            {
                id: 'collision_mw_and', title: 'B√ºy√ºk √áarpƒ±≈üma', type: 'Olay', icon: 'üí•',
                desc: 'Samanyolu vs Andromeda.',
                collision: true,
                main: { name: 'Samanyolu', type: 'Spiral', branches: 4, insideColor: '#f8f9fa', outsideColor: '#4b6cb7', radius: 6, seed: 12345 },
                target: { name: 'Andromeda', type: 'Spiral', branches: 2, insideColor: '#ffeebb', outsideColor: '#6688cc', radius: 8, seed: 67890 }
            },
            {
                id: 'neutron_dance', title: 'N√∂tron Dansƒ±', type: 'Olay', icon: '‚ö°',
                desc: 'ƒ∞ki n√∂tron yƒ±ldƒ±zƒ±.',
                collision: true,
                main: { name: 'NS-Alpha', type: 'N√∂tron Yƒ±ldƒ±zƒ±', radius: 2, insideColor: '#0055ff', outsideColor: '#ffffff', rotationSpeed: 50, seed: 111 },
                target: { name: 'NS-Omega', type: 'N√∂tron Yƒ±ldƒ±zƒ±', radius: 2, insideColor: '#00ffff', outsideColor: '#ffffff', rotationSpeed: 50, seed: 222 }
            }
        ];

        function getStoredScenarios() {
            try {
                const stored = localStorage.getItem('custom_scenarios');
                return stored ? JSON.parse(stored) : [];
            } catch(e) { return []; }
        }

        function getAllScenarios() {
            return [...defaultScenarios, ...getStoredScenarios()];
        }

        function saveCurrentScenario() {
            const name = prompt("Senaryo Adƒ±:", parameters.name);
            if (!name) return;

            const newScenario = {
                id: 'custom_' + Date.now(),
                title: name,
                type: '√ñzel',
                icon: 'üíæ',
                desc: 'Kullanƒ±cƒ± tarafƒ±ndan kaydedildi.',
                params: JSON.parse(JSON.stringify(parameters)),
                isCustom: true
            };
            
            const custom = getStoredScenarios();
            custom.push(newScenario);
            localStorage.setItem('custom_scenarios', JSON.stringify(custom));
            
            const grid = document.getElementById('scenario-grid');
            if(grid) renderScenarioGrid(grid);
        }

        function deleteScenario(id, event) {
            event.stopPropagation();
            if(!confirm("Bu senaryoyu silmek istediƒüine emin misin?")) return;
            
            let custom = getStoredScenarios();
            custom = custom.filter(s => s.id !== id);
            localStorage.setItem('custom_scenarios', JSON.stringify(custom));
            
            const grid = document.getElementById('scenario-grid');
            if(grid) renderScenarioGrid(grid);
        }

        function renderScenarioGrid(grid) {
            grid.innerHTML = '';
            const allScenarios = getAllScenarios();
            
            const categories = {
                'Galaksi Senaryolarƒ±': [],
                '√áarpƒ±≈üma Senaryolarƒ±': [],
                '√ñzel Senaryolar': []
            };

            allScenarios.forEach(sc => {
                if (sc.isCustom) {
                    categories['√ñzel Senaryolar'].push(sc);
                } else if (sc.collision || sc.type === 'Olay') {
                    categories['√áarpƒ±≈üma Senaryolarƒ±'].push(sc);
                } else {
                    categories['Galaksi Senaryolarƒ±'].push(sc);
                }
            });

            for (const [catName, scList] of Object.entries(categories)) {
                if (scList.length === 0) continue;

                const catHeader = document.createElement('div');
                catHeader.style.cssText = 'grid-column: 1 / -1; color: #60a5fa; font-weight: bold; margin-top: 10px; border-bottom: 1px solid rgba(59, 130, 246, 0.3); padding-bottom: 5px; font-family: "Space Grotesk", sans-serif;';
                catHeader.innerText = catName;
                grid.appendChild(catHeader);

                scList.forEach(sc => {
                    const item = document.createElement('div');
                    item.style.cssText = 'aspect-ratio:1/1; background:rgba(255, 255, 255, 0.05); border:1px solid rgba(255, 255, 255, 0.1); border-radius:8px; cursor:pointer; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:10px; transition:all 0.3s; position:relative;';
                    
                    if (sc.isCustom) {
                        const delBtn = document.createElement('div');
                        delBtn.innerHTML = '&times;';
                        delBtn.style.cssText = 'position:absolute; top:5px; right:5px; color:#ef4444; font-weight:bold; padding:2px 6px; border-radius:4px; background:rgba(0,0,0,0.5); font-size:0.8rem; z-index:10;';
                        delBtn.onclick = (e) => deleteScenario(sc.id, e);
                        item.appendChild(delBtn);
                    }

                    const iconDiv = document.createElement('div');
                    iconDiv.style.cssText = 'font-size:2rem; margin-bottom:10px;';
                    iconDiv.innerText = sc.icon;
                    item.appendChild(iconDiv);

                    const titleDiv = document.createElement('div');
                    titleDiv.style.cssText = "font-size:0.9rem; font-weight:bold; color:#fff; font-family:'Space Grotesk', sans-serif;";
                    titleDiv.innerText = sc.title;
                    item.appendChild(titleDiv);

                    const typeDiv = document.createElement('div');
                    typeDiv.style.cssText = 'font-size:0.7rem; color:#94a3b8; margin-top:5px;';
                    typeDiv.innerText = sc.type;
                    item.appendChild(typeDiv);

                    item.onmouseover = () => { item.style.background = 'rgba(59, 130, 246, 0.2)'; item.style.borderColor = '#60a5fa'; item.style.transform = 'translateY(-3px)'; };
                    item.onmouseout = () => { item.style.background = 'rgba(255, 255, 255, 0.05)'; item.style.borderColor = 'rgba(255, 255, 255, 0.1)'; item.style.transform = 'translateY(0)'; };
                    item.onclick = () => loadScenario(sc);
                    grid.appendChild(item);
                });
            }
        }

        function createScenarioModal() {
            if(document.getElementById('js-scenario-overlay')) return;

            const overlay = document.createElement('div');
            overlay.id = 'js-scenario-overlay';
            overlay.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(5px); z-index:10000; display:flex; justify-content:center; align-items:center;';
            
            const modal = document.createElement('div');
            modal.id = 'js-scenario-modal';
            modal.style.cssText = 'width:600px; height:500px; background:rgba(15, 23, 42, 0.95); border:1px solid #3b82f6; border-radius:12px; box-shadow:0 0 50px rgba(59, 130, 246, 0.4); display:flex; flex-direction:column; position:relative; overflow:hidden;';
            
            const header = document.createElement('div');
            header.style.cssText = 'padding:15px; background:rgba(30, 41, 59, 0.8); border-bottom:1px solid rgba(59, 130, 246, 0.3); cursor:move; display:flex; justify-content:space-between; align-items:center; user-select:none;';
            header.innerHTML = '<h2 style="margin:0; color:#60a5fa; font-family:\'Space Grotesk\', sans-serif; font-weight:bold; letter-spacing:1px;">SENARYOLAR</h2>';
            
            const saveBtn = document.createElement('button');
            saveBtn.innerText = "+ KAYDET";
            saveBtn.style.cssText = "background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981; padding: 5px 12px; color: #34d399; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight:bold; margin-left: auto; margin-right: 15px; transition: all 0.2s;";
            saveBtn.onmouseover = () => { saveBtn.style.background = "rgba(16, 185, 129, 0.4)"; saveBtn.style.color = "white"; };
            saveBtn.onmouseout = () => { saveBtn.style.background = "rgba(16, 185, 129, 0.2)"; saveBtn.style.color = "#34d399"; };
            saveBtn.onclick = saveCurrentScenario;
            header.appendChild(saveBtn);

            const closeBtn = document.createElement('div');
            closeBtn.innerHTML = '&times;';
            closeBtn.style.cssText = 'cursor:pointer; color:#94a3b8; font-size:1.5rem; transition:color 0.2s;';
            closeBtn.onclick = () => overlay.style.display = 'none';
            header.appendChild(closeBtn);
            
            const grid = document.createElement('div');
            grid.id = 'scenario-grid';
            grid.style.cssText = 'padding:20px; display:grid; grid-template-columns:repeat(auto-fill, minmax(130px, 1fr)); gap:15px; overflow-y:auto; height:100%;';
            
            renderScenarioGrid(grid);

            modal.appendChild(header);
            modal.appendChild(grid);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            let isDragging = false, startX, startY;
            header.onmousedown = (e) => { isDragging = true; startX = e.clientX; startY = e.clientY; const rect = modal.getBoundingClientRect(); modal.style.position = 'absolute'; modal.style.left = rect.left + 'px'; modal.style.top = rect.top + 'px'; modal.style.margin = '0'; };
            document.addEventListener('mousemove', (e) => { if (isDragging) { const dx = e.clientX - startX; const dy = e.clientY - startY; modal.style.left = (parseFloat(modal.style.left) + dx) + 'px'; modal.style.top = (parseFloat(modal.style.top) + dy) + 'px'; startX = e.clientX; startY = e.clientY; } });
            document.addEventListener('mouseup', () => { isDragging = false; });
        }

        function openScenarioModal() {
            let overlay = document.getElementById('js-scenario-overlay');
            if(!overlay) { 
                createScenarioModal(); 
                overlay = document.getElementById('js-scenario-overlay'); 
            }
            renderScenarioGrid(document.getElementById('scenario-grid')); // Her a√ßƒ±lƒ±≈üta yenile
            overlay.style.display = 'flex';
        }

        function loadScenario(sc) {
            document.getElementById('js-scenario-overlay').style.display = 'none';
            enterSimulation(); // Eƒüer landing page'deysek gir

            if (sc.collision) {
                // √áarpƒ±≈üma Senaryosu
                // 1. Ana Galaksiyi Kur
                Object.assign(parameters, defaultParams, sc.main);
                parameters.name = sc.title; // ƒ∞sim g√ºncelle
                currentSeed = sc.main.seed || Math.random();
                
                // Navigasyon listesini g√ºncelle
                galaxies[currentGalaxyIndex] = { ...parameters };
                
                generateGalaxy();
                
                // 2. Hedef Galaksiyi Kur (Kom≈üu olarak ekle ve √ßarpƒ±≈üma ba≈ülat)
                const targetParams = { ...defaultParams, ...sc.target };
                const neighborGroup = createGalaxyGroup(targetParams);
                
                // Pozisyon ayarla (√áarpƒ±≈üma i√ßin)
                neighborGroup.position.set(20, 0, 0); // Yakƒ±n ba≈ülat
                neighborGroup.userData = { isNeighbor: true, isGalaxy: true, params: targetParams, rotationSpeed: parameters.rotationSpeed };
                
                scene.add(neighborGroup);
                galaxyGroups.push(neighborGroup);
                addBlackHoleToGroup(neighborGroup, targetParams);
                
                // Seed'i deƒüi≈ütirip yƒ±ldƒ±zlarƒ± ekle
                currentSeed = sc.target.seed || Math.random();
                createStarSystems(neighborGroup, targetParams, 50);

                // √áarpƒ±≈ümayƒ± tetikle
                collisionMainGroup = galaxyGroups.find(g => g.userData.isMain);
                collisionTargetGroup = neighborGroup;
                startGalacticCollision();
                
                // Kamerayƒ± ayarla
                camera.position.set(0, 20, 40);
                controls.target.set(10, 0, 0);

            } else {
                // Tek Galaksi Senaryosu
                Object.assign(parameters, defaultParams, sc.params);
                parameters.name = sc.title; // ƒ∞sim g√ºncelle
                currentSeed = sc.params.seed || Math.random();
                
                // Navigasyon listesini g√ºncelle
                galaxies[currentGalaxyIndex] = { ...parameters };
                
                generateGalaxy();
                updateGalaxyNameDisplay();
                setupGUI();
            }
            renderGalaxyList(); // Listeyi aray√ºzde yenile
        }

        // --- EKLENEN generateGalaxy FONKSƒ∞YONU ---
        function generateGalaxy() {
            galaxyGroups.forEach(g => scene.remove(g));
            galaxyGroups = []; 
            specialStructures.forEach(s => scene.remove(s));
            specialStructures = [];
            interactables = [];
            animatedObjects = []; 
            clearLabels(); 

            // Seed kontrol√º (Eƒüer parametrelerde seed yoksa rastgele devam et)
            // Eƒüer loadScenario ile geldiyse currentSeed zaten ayarlanmƒ±≈ütƒ±r.
            if (!currentSeed) currentSeed = Math.random();

            if (!parameters.rotation) parameters.rotation = { x: 0, z: 0 };
            const mainParams = { ...parameters, name: parameters.name };
            const mainGroup = createGalaxyGroup(mainParams);
            mainGroup.position.set(0, 0, 0);
            mainGroup.rotation.x = parameters.rotation.x;
            mainGroup.rotation.z = parameters.rotation.z;
            mainGroup.userData.isMain = true; 
            mainGroup.userData.isGalaxy = true; 
            mainGroup.userData.params = mainParams;
            scene.add(mainGroup);
            galaxyGroups.push(mainGroup);

            addBlackHoleToGroup(mainGroup, parameters);
            createStarSystems(mainGroup, parameters);
            
            if (parameters.specialSystems) createSpecialSystems(mainGroup, parameters.specialSystems);

            if (parameters.hasMicroBlackHoles) {
                createMicroBlackHoles(mainGroup, parameters, 5);
            }

            // YENƒ∞: Uzak Nebulalar (Her evrende 1-2 tane)
            if (currentGraphicsQuality !== 'low') {
                const nebulaCount = 1 + Math.floor(rng() * 2);
                for(let i=0; i<nebulaCount; i++) {
                    generateDistantNebula();
                }
            }

            if (parameters.neighborList && parameters.neighborList.length > 0 && !isCollisionActive) {
                parameters.neighborList.forEach(np => {
                    const neighborConfig = { ...parameters, ...np, nebulaCount: parameters.nebulaCount / 3, dustCount: parameters.dustCount / 3 };
                    const neighborGroup = createGalaxyGroup(neighborConfig);
                    neighborGroup.position.set(np.offset.x, np.offset.y, np.offset.z);
                    neighborGroup.rotation.x = np.rotation ? np.rotation.x : Math.random() * Math.PI;
                    neighborGroup.rotation.z = np.rotation ? np.rotation.z : Math.random() * Math.PI;
                    neighborGroup.userData = { isNeighbor: true, isGalaxy: true, params: neighborConfig, rotationSpeed: parameters.rotationSpeed };
                    
                    // YENƒ∞: Galaksi Etiketi
                    const gLabel = document.createElement('div');
                    gLabel.className = 'galaxy-label';
                    
                    // Tooltip ƒ∞√ßeriƒüi
                    const typeName = getTranslatedGalaxyType(neighborConfig.type);
                    const starCount = (neighborConfig.count / 1000).toFixed(1) + 'k';
                    const radius = neighborConfig.radius.toFixed(1) + ' IY';

                    gLabel.innerHTML = `${neighborConfig.name}
                        <div class="galaxy-tooltip">
                            <div class="tooltip-row"><span class="tooltip-key">T√ºr:</span> <span class="tooltip-val">${typeName}</span></div>
                            <div class="tooltip-row"><span class="tooltip-key">Yƒ±ldƒ±z:</span> <span class="tooltip-val">${starCount}</span></div>
                            <div class="tooltip-row"><span class="tooltip-key">√áap:</span> <span class="tooltip-val">${radius}</span></div>
                        </div>`;

                    document.body.appendChild(gLabel);
                    neighborGroup.userData.label = gLabel;

                    scene.add(neighborGroup);
                    galaxyGroups.push(neighborGroup);
                    
                    addBlackHoleToGroup(neighborGroup, neighborConfig);
                    createStarSystems(neighborGroup, neighborConfig, 5); // 5 adet sistem olu≈ütur
                    if (np.specialSystems) createSpecialSystems(neighborGroup, np.specialSystems);
                });
            }
            
            updateCollisionButtonVisibility();
        }

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0005); 

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.01, 25000);
            camera.position.copy(defaultCamPos);
            // FREECAM i√ßin rotasyon sƒ±rasƒ±nƒ± ayarla
            camera.rotation.order = 'YXZ';

            renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
            renderer.setSize(window.innerWidth, window.innerHeight);
            // renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // applyGraphicsSettings ile ayarlanacak
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            document.body.appendChild(renderer.domElement);

            applyGraphicsSettings(currentGraphicsQuality);

            // FPS Sayacƒ±
            if (typeof Stats !== 'undefined') {
                stats = new Stats();
                stats.dom.style.display = parameters.showFPS ? 'block' : 'none';
                stats.dom.style.zIndex = '1000';
                stats.dom.style.top = 'auto';
                stats.dom.style.bottom = '0px';
                stats.dom.style.left = '0px';
                document.body.appendChild(stats.dom);
            }

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = false; 
            controls.autoRotateSpeed = 0.5;
            controls.maxDistance = 15000; 

            starTexture = createTexture('star');
            nebulaTexture = createTexture('nebula');
            cometTexture = createTexture('comet');
            explosionTexture = createTexture('explosion');

            raycaster = new THREE.Raycaster();
            raycaster.params.Points.threshold = 0.5; 
            mouse = new THREE.Vector2();

            // YENƒ∞: Ses dosyasƒ±nƒ± y√ºkle (Dramatik uzay uƒüultusu)
            collisionSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2176/2176-preview.mp3'); 
            collisionSound.loop = true;
            collisionSound.volume = 0.5;

            createLandingInterface();
            generateBackgroundStars();
            createWarpEffect(); // Warp efektini olu≈ütur
            generateGalaxy(); 
            initPostProcessing();
            setupGUI();
            renderGalaxyList();

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onMouseClick); 

            // FREECAM KLAVYE Dƒ∞NLEYƒ∞Cƒ∞LERƒ∞
            window.addEventListener('keydown', (e) => {
                keysPressed[e.key.toLowerCase()] = true;
            });
            window.addEventListener('keyup', (e) => {
                keysPressed[e.key.toLowerCase()] = false;
            });
            // FREECAM MOUSE Dƒ∞NLEYƒ∞Cƒ∞LERƒ∞
            window.addEventListener('mousedown', (e) => {
                if (e.button === 0) isDragging = true; // Sol tƒ±k
            });
            window.addEventListener('mouseup', () => {
                isDragging = false;
            });
            // FREECAM WHEEL (ZOOM)
            window.addEventListener('wheel', (e) => {
                if (isFreeCam) {
                    // FOV'u deƒüi≈ütir
                    camera.fov += e.deltaY * 0.05;
                    // Sƒ±nƒ±rla
                    camera.fov = Math.max(10, Math.min(120, camera.fov));
                    camera.updateProjectionMatrix();
                }
            });

            // Ba≈ülangƒ±√ßta GUI'yi g√ºncelle (varsayƒ±lan dil TR)
            changeLanguage('en');

            // Landing Page ve Y√ºkleme y√∂netimi
            // Ba≈ülangƒ±√ßta loading gizli, landing page a√ßƒ±k
            // Y√ºkleme bitince (init sonu) landing page kalƒ±r
            // Butona basƒ±nca landing page gider
            
            setTimeout(() => {
                // Burada bir ≈üey yapmaya gerek yok, landing page zaten √ºstte
                // Sadece loading textini g√ºncelleyebiliriz
                document.getElementById('loading-text').innerHTML = translations['en'].loading;
            }, 100);

            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            
            if (parameters.resolution === 'Native') {
                renderer.setSize(window.innerWidth, window.innerHeight, false);
                composer.setSize(window.innerWidth, window.innerHeight);
            } else {
                const [w, h] = parameters.resolution.split('x').map(Number);
                renderer.setSize(w, h, false);
                composer.setSize(w, h);
            }
        }

        function generateBackgroundStars() {
            if (bgPoints) {
                scene.remove(bgPoints);
                bgPoints.traverse(c => { if(c.geometry) c.geometry.dispose(); if(c.material) c.material.dispose(); });
            }
            
            bgPoints = new THREE.Group();
            
            // 1. SEYREK ARKA PLAN (Void hissi i√ßin az sayƒ±da)
            const geoBase = new THREE.BufferGeometry();
            const countBase = 1000; 
            const posBase = new Float32Array(countBase * 3);
            const colBase = new Float32Array(countBase * 3);
            
            for(let i=0; i<countBase; i++) {
                // Mesafeyi biraz daha yakƒ±na √ßekelim ki hareket edince parallax olsun (4000 - 20000 arasƒ±)
                const r = 4000 + Math.random() * 16000; 
                const theta = 2 * Math.PI * Math.random();
                const phi = Math.acos(2 * Math.random() - 1);
                
                posBase[i*3] = r * Math.sin(phi) * Math.cos(theta);
                posBase[i*3+1] = r * Math.sin(phi) * Math.sin(theta);
                posBase[i*3+2] = r * Math.cos(phi);
                
                // Daha parlak ve canlƒ± renkler
                const c = new THREE.Color().setHSL(0.6 + Math.random()*0.2, 0.6, Math.random() * 0.5 + 0.5);
                colBase[i*3] = c.r; colBase[i*3+1] = c.g; colBase[i*3+2] = c.b;
            }
            geoBase.setAttribute('position', new THREE.BufferAttribute(posBase, 3));
            geoBase.setAttribute('color', new THREE.BufferAttribute(colBase, 3));
            // Yuvarlak doku (map: starTexture) ve artƒ±rƒ±lmƒ±≈ü parlaklƒ±k
            const matBase = new THREE.PointsMaterial({ size: 70.0, sizeAttenuation: true, map: starTexture, color: 0xffffff, vertexColors: true, transparent: true, opacity: 0.9, depthWrite: false, fog: false, blending: THREE.AdditiveBlending });
            bgPoints.add(new THREE.Points(geoBase, matBase));

            // 2. GALAKSƒ∞ K√úMELERƒ∞ (Uzak galaksi hissi veren yoƒüun b√∂lgeler)
            const clusterCount = 15; 
            const starsPerCluster = 300;
            const dustPerCluster = 150; // K√ºmeler i√ßin toz bulutlarƒ±
            
            const geoCluster = new THREE.BufferGeometry();
            const totalClusterStars = clusterCount * starsPerCluster;
            const posCluster = new Float32Array(totalClusterStars * 3);
            const colCluster = new Float32Array(totalClusterStars * 3);
            
            // Toz Bulutlarƒ± i√ßin Geometri
            const geoDust = new THREE.BufferGeometry();
            const totalDust = clusterCount * dustPerCluster;
            const posDust = new Float32Array(totalDust * 3);
            const colDust = new Float32Array(totalDust * 3);

            let idx = 0;
            let dustIdx = 0;

            for(let c=0; c<clusterCount; c++) {
                // Galaksi Merkezi ve Y√∂n√º
                const distBase = 8000 + Math.random() * 12000;
                const centerTheta = Math.random() * Math.PI * 2;
                const centerPhi = Math.acos(2 * Math.random() - 1);
                
                const cx = distBase * Math.sin(centerPhi) * Math.cos(centerTheta);
                const cy = distBase * Math.sin(centerPhi) * Math.sin(centerTheta);
                const cz = distBase * Math.cos(centerPhi);
                const center = new THREE.Vector3(cx, cy, cz);
                
                // Galaksi Oryantasyonu
                const rotX = Math.random() * Math.PI;
                const rotY = Math.random() * Math.PI;
                const rotZ = Math.random() * Math.PI;
                const euler = new THREE.Euler(rotX, rotY, rotZ);
                
                // Galaksi Tipi ve Rengi (Daha bulutsu ve yumu≈üak)
                const clusterColor = new THREE.Color().setHSL(Math.random(), 0.6, 0.5);
                const spreadBase = 600 + Math.random() * 800;
                
                // Yƒ±ldƒ±zlar
                for(let s=0; s<starsPerCluster; s++) {
                    // Bulutsu Yapƒ± (Amorf)
                    const r = Math.pow(Math.random(), 0.5) * spreadBase;
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.acos(2 * Math.random() - 1);
                    
                    let lx = r * Math.sin(phi) * Math.cos(theta);
                    let ly = r * Math.sin(phi) * Math.sin(theta) * 0.7; // Hafif basƒ±k
                    let lz = r * Math.cos(phi);
                    
                    const pos = new THREE.Vector3(lx, ly, lz).applyEuler(euler).add(center);
                    
                    posCluster[idx*3] = pos.x;
                    posCluster[idx*3+1] = pos.y;
                    posCluster[idx*3+2] = pos.z;
                    
                    const starCol = clusterColor.clone().offsetHSL(0, 0, (Math.random()-0.5)*0.3);
                    colCluster[idx*3] = starCol.r; colCluster[idx*3+1] = starCol.g; colCluster[idx*3+2] = starCol.b;
                    
                    idx++;
                }

                // Toz Bulutlarƒ± (Nebula)
                for(let d=0; d<dustPerCluster; d++) {
                    const r = Math.pow(Math.random(), 0.5) * spreadBase * 1.2;
                    const angle = Math.random() * Math.PI * 2;
                    const phi = Math.acos(2 * Math.random() - 1);
                    
                    let lx = r * Math.sin(phi) * Math.cos(angle);
                    let ly = r * Math.sin(phi) * Math.sin(angle) * 0.8;
                    let lz = r * Math.cos(phi);
                    
                    const pos = new THREE.Vector3(lx, ly, lz).applyEuler(euler).add(center);
                    
                    posDust[dustIdx*3] = pos.x;
                    posDust[dustIdx*3+1] = pos.y;
                    posDust[dustIdx*3+2] = pos.z;
                    
                    // Toz rengi (biraz daha koyu ve atmosferik)
                    const dustCol = clusterColor.clone().offsetHSL(0, -0.1, -0.1);
                    colDust[dustIdx*3] = dustCol.r; colDust[dustIdx*3+1] = dustCol.g; colDust[dustIdx*3+2] = dustCol.b;
                    
                    dustIdx++;
                }
            }
            
            geoCluster.setAttribute('position', new THREE.BufferAttribute(posCluster, 3));
            geoCluster.setAttribute('color', new THREE.BufferAttribute(colCluster, 3));
            const matCluster = new THREE.PointsMaterial({ size: 100.0, sizeAttenuation: true, map: starTexture, vertexColors: true, transparent: true, opacity: 0.6, depthWrite: false, blending: THREE.AdditiveBlending, fog: false });
            bgPoints.add(new THREE.Points(geoCluster, matCluster));

            // Toz Katmanƒ±nƒ± Ekle
            geoDust.setAttribute('position', new THREE.BufferAttribute(posDust, 3));
            geoDust.setAttribute('color', new THREE.BufferAttribute(colDust, 3));
            const matDust = new THREE.PointsMaterial({ size: 1200.0, sizeAttenuation: true, map: nebulaTexture, vertexColors: true, transparent: true, opacity: 0.1, depthWrite: false, blending: THREE.AdditiveBlending, fog: false });
            bgPoints.add(new THREE.Points(geoDust, matDust));

            scene.add(bgPoints);
            scene.background = new THREE.Color(0x000005); // Derin siyah arka plan
        }

        function createNewGalaxy() {
            if(isWarping) return;
            // Yeni galaksi yaratƒ±rken freecam'i kapat
            if(isFreeCam) toggleFreeCam();

            activeWarpTargetUUID = null;
            lockedTarget = null;
            lastTargetPos = new THREE.Vector3();

            const newName = generateCreativeGalaxyName();
            const rColor = () => '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');

            const neighborCount = Math.floor(Math.random() * 3); 
            const neighborList = [];

            for(let i=0; i<neighborCount; i++) {
                neighborList.push({
                    radius: 2 + Math.random() * 3, count: 20000,
                    insideColor: rColor(), outsideColor: rColor(),
                    branches: Math.floor(2 + Math.random() * 3),
                    offset: { 
                        x: (Math.random() - 0.5) * 300, 
                        z: (Math.random() - 0.5) * 300, 
                        y: (Math.random() - 0.5) * 100 
                    },
                    rotation: { x: Math.random() * Math.PI, z: Math.random() * Math.PI },
                    name: generateCreativeGalaxyName(), 
                    type: 'Uydu Galaksi',
                    gravityPower: 0.05 + Math.random() * 0.2,
                    jetLength: 5 + Math.random() * 5,
                    jetIntensity: 1.0 + Math.random() * 2.0,
                    jetWidth: 0.2 + Math.random() * 0.3,
                    jetSpeed: 0.8 + Math.random() * 0.5
                });
            }

            // N√∂tron Yƒ±ldƒ±zƒ± ≈ûansƒ± (%15)
            const isNeutronStar = Math.random() < 0.15;
            
            let newGalaxy;
            
            if (isNeutronStar) {
                newGalaxy = {
                    ...defaultParams, id: 'gal-' + Date.now(), name: newName + " (NS)",
                    type: 'N√∂tron Yƒ±ldƒ±zƒ±',
                    branches: 0, // Disk ≈üeklinde
                    spin: 5 + Math.random() * 5, // Hƒ±zlƒ± sarmal g√∂r√ºn√ºm√º i√ßin
                    radius: 2 + Math.random() * 2, // K√º√ß√ºk ve yoƒüun
                    randomness: 0.5,
                    insideColor: '#0055ff', // Koyu Mavi
                    outsideColor: '#ffffff', // Beyaz
                    theme: 'Buzul', 
                    gravityPower: 0.5 + Math.random() * 0.3, // √áok g√º√ßl√º k√ºtle √ßekimi
                    rotationSpeed: 50.0 + Math.random() * 30.0, // I≈ûIK HIZI (A≈üƒ±rƒ± hƒ±zlƒ± d√∂n√º≈ü)
                    jetLength: 20 + Math.random() * 10, // √áok uzun jetler
                    jetIntensity: 5.0, // √áok parlak
                    jetWidth: 0.5 + Math.random() * 0.5, 
                    jetSpeed: 5.0, // Hƒ±zlƒ± akƒ±≈ü
                    nebulaOpacity: 0.8, // Yoƒüun toz bulutu
                    dustOpacity: 0.6,
                    count: 50000, // Yoƒüun yƒ±ldƒ±z/toz
                    neighborList: neighborList,
                    rotation: { x: (Math.random() - 0.5) * Math.PI, z: (Math.random() - 0.5) * Math.PI }, // Yamuk/Eƒüik A√ßƒ±
                    year: 3024
                };
            } else {
                newGalaxy = {
                    ...defaultParams, id: 'gal-' + Date.now(), name: newName,
                    type: galaxyTypes[Math.floor(Math.random() * galaxyTypes.length)],
                    branches: Math.floor(2 + Math.random() * 7), spin: (Math.random() - 0.5) * 3,
                    radius: 3 + Math.random() * 7, randomness: 0.1 + Math.random() * 0.5,
                    insideColor: rColor(), outsideColor: rColor(), theme: 'Custom',
                    gravityPower: 0.05 + Math.random() * 0.3, 
                    neighborList: neighborList,
                    rotation: { x: (Math.random()-0.5)*0.5, z: (Math.random()-0.5)*0.5 },
                    year: 3024 
                };
            }

            galaxies.push(newGalaxy);
            renderGalaxyList();
            
            document.getElementById('reset-view-btn').style.display = 'none';
            controls.target.copy(defaultTarget); 
            
            switchGalaxy(galaxies.length - 1);
        }

        function renderGalaxyList() {
            const list = document.getElementById('galaxy-list');
            list.innerHTML = '';
            
            // √áeviriye eri≈üim
            const t = translations[currentLang];
            const locCenter = t.loc_center || "Merkez Sekt√∂r";
            const locLabel = t.loc_prefix || "Konum:";

            galaxies.forEach((gal, index) => {
                const item = document.createElement('div');
                item.className = `galaxy-item ${index === currentGalaxyIndex ? 'active' : ''}`;
                item.onclick = () => switchGalaxy(index);
                const neighborText = gal.neighborList && gal.neighborList.length > 0 ? `(+${gal.neighborList.length} ${getTranslatedGalaxyType("Uydu Galaksi")})` : '';
                
                // Konum bilgisini de √ßeviriyoruz
                item.innerHTML = `<div><div class="galaxy-name">${gal.name}</div><div class="galaxy-type">${getTranslatedGalaxyType(gal.type)} ${neighborText}</div><div class="sub-info" id="info-${index}">${locLabel} ${locCenter}</div></div><div style="font-size:0.8rem; opacity:0.7">Online</div>`;
                list.appendChild(item);
            });
        }

        function switchGalaxy(indexOrParams) {
            let targetParams;
            if (typeof indexOrParams === 'number') {
                if (indexOrParams === currentGalaxyIndex && !isWarping) return;
                
                galaxies[currentGalaxyIndex].year = cosmicYear;
                Object.assign(galaxies[currentGalaxyIndex], parameters); 
                
                currentGalaxyIndex = indexOrParams;
                targetParams = galaxies[currentGalaxyIndex];
            } else return;

            isWarping = true;
            if(isFreeCam) toggleFreeCam(); // Galaksi deƒüi≈ütirirken freecam kapa
            activeWarpTargetUUID = null; 
            lockedTarget = null; 
            
            document.getElementById('cinematic-mode').style.display = 'block';
            // Sinematik modu √ßeviriyle g√ºncelle
            document.getElementById('cinematic-mode').innerText = translations[currentLang].cinematic_warp + " " + targetParams.name;
            const startPos = camera.position.clone();
            
            let progress = 0;
            const warpAnim = setInterval(() => {
                progress += 0.05;
                camera.fov = 75 + Math.sin(progress * Math.PI) * 40;
                camera.updateProjectionMatrix();
                composer.bloomPass.strength = parameters.bloomStrength + Math.sin(progress * Math.PI) * 5.0;
                
                if(chromaticAberrationPass) chromaticAberrationPass.uniforms.uAmount.value = Math.sin(progress * Math.PI) * 0.05;
                
                const shake = Math.sin(progress * Math.PI) * 0.5;
                camera.position.copy(startPos).add(new THREE.Vector3((Math.random()-0.5)*shake, (Math.random()-0.5)*shake, (Math.random()-0.5)*shake));

                
                if(progress < 0.5) {
                    controls.target.lerpVectors(controls.target.clone(), defaultTarget, progress * 2);
                }

                if (progress >= 1) {
                    clearInterval(warpAnim);
                    clearLabels();
                    if(chromaticAberrationPass) chromaticAberrationPass.uniforms.uAmount.value = 0;
                    
                    Object.assign(parameters, targetParams);
                    cosmicYear = targetParams.year || 3024; 
                    
                    setupGUI();
                    generateGalaxy();
                    
                    updateGalaxyNameDisplay();
                    renderGalaxyList();
                    isWarping = false;
                    document.getElementById('cinematic-mode').style.display = 'none';
                    camera.fov = 75;
                    camera.updateProjectionMatrix();
                    composer.bloomPass.strength = parameters.bloomStrength;
                    camera.position.copy(defaultCamPos);
                    controls.target.copy(defaultTarget);
                    camera.lookAt(defaultTarget);
                    document.getElementById('reset-view-btn').style.display = 'none';
                }
            }, 16);
        }

        function warpToTarget(targetObj, targetName, isNeighborGalaxy) {
            if (isWarping) return;
            isWarping = true;
            if(isFreeCam) toggleFreeCam();
            
            document.getElementById('cinematic-mode').style.display = 'block';
            document.getElementById('cinematic-mode').innerText = translations[currentLang].cinematic_route + " " + targetName;
            
            if(isNeighborGalaxy) {
                activeWarpTargetUUID = targetObj.uuid;
            }
            
            const targetPos = new THREE.Vector3();
            targetObj.getWorldPosition(targetPos);
            
            const isPlanet = targetObj.userData.isPlanet;
            const isSystem = targetObj.userData.isSystem; // YENƒ∞

            let dist = 40;
            if (isPlanet) dist = 0.15;
            if (isSystem) dist = 0.2; // Kamera √ßok yakƒ±na girsin
            
            // YENƒ∞: Kamerayƒ± sisteme yakla≈üƒ±rken biraz yukarƒ±dan baktƒ±r
            const offsetVec = new THREE.Vector3(0, (isPlanet ? 0.05 : (isSystem ? 0.05 : 10)), dist);

            const finalCamPos = targetPos.clone().add(offsetVec);
            const startCamPos = camera.position.clone();
            const startLookAt = controls.target.clone(); 
            
            let progress = 0;
            const warpAnim = setInterval(() => {
                progress += 0.02;
                const t = progress < .5 ? 2 * progress * progress : -1 + (4 - 2 * progress) * progress; 
                camera.position.lerpVectors(startCamPos, finalCamPos, t);
                controls.target.lerpVectors(startLookAt, targetPos, t);
                camera.fov = 75 + Math.sin(progress * Math.PI) * 20;
                camera.updateProjectionMatrix();
                
                if(bgPoints) {
                    bgPoints.children.forEach(c => {
                        if(c.material) c.material.opacity = Math.max(0.2, 1.0 - progress);
                    });
                }
                composer.bloomPass.strength = parameters.bloomStrength + Math.sin(progress * Math.PI) * 3.0;
                
                if(chromaticAberrationPass) chromaticAberrationPass.uniforms.uAmount.value = Math.sin(progress * Math.PI) * (isNeighborGalaxy ? 0.04 : 0.01);
                
                const shake = Math.sin(progress * Math.PI) * (isNeighborGalaxy ? 0.4 : 0.1);
                camera.position.add(new THREE.Vector3((Math.random()-0.5)*shake, (Math.random()-0.5)*shake, (Math.random()-0.5)*shake));
                
                // --- WARP Bƒ∞TTƒ∞ƒûƒ∞NDE ---
                if (progress >= 1) {
                    clearInterval(warpAnim);
                    isWarping = false;
                    
                    // YENƒ∞: Eƒüer bir yƒ±ldƒ±z sistemine vardƒ±ysak, ƒ∞N≈ûA ET
                    if(chromaticAberrationPass) chromaticAberrationPass.uniforms.uAmount.value = 0;
                    if (targetObj.userData.isSystem && !targetObj.userData.isLoaded) {
                        buildSolarSystem(targetObj);
                        // Kamera a√ßƒ±sƒ±nƒ± d√ºzelt
                         controls.target.copy(targetObj.position);
                    }

                    lockedTarget = targetObj;
                    targetObj.getWorldPosition(lastTargetPos);

                    document.getElementById('cinematic-mode').style.display = 'none';
                    camera.fov = 75;
                    camera.updateProjectionMatrix();
                    composer.bloomPass.strength = parameters.bloomStrength;
                    controls.target.copy(targetPos);
                    document.getElementById('current-galaxy-name').innerText = `${translations[currentLang].loc_prefix} ${targetName}`;
                    document.getElementById('reset-view-btn').style.display = 'block';
                }
            }, 16);
        }

        function resetCameraView() {
            if (isWarping) return;
            isWarping = true;
            if(isFreeCam) toggleFreeCam(); // Reset yaparken freecam kapa
            activeWarpTargetUUID = null;
            lockedTarget = null;

            document.getElementById('cinematic-mode').style.display = 'block';
            document.getElementById('cinematic-mode').innerText = translations[currentLang].cinematic_return;
            const startCamPos = camera.position.clone();
            const startLookAt = controls.target.clone();
            let progress = 0;
            const warpAnim = setInterval(() => {
                progress += 0.03;
                const t = progress < .5 ? 2 * progress * progress : -1 + (4 - 2 * progress) * progress;
                camera.position.lerpVectors(startCamPos, defaultCamPos, t);
                controls.target.lerpVectors(startLookAt, defaultTarget, t);
                camera.fov = 75 + Math.sin(progress * Math.PI) * 10; 
                camera.updateProjectionMatrix();
                
                if(bgPoints) {
                    bgPoints.children.forEach(c => {
                        if(c.material) c.material.opacity = Math.min(1.0, 0.2 + progress);
                    });
                }
                if(chromaticAberrationPass) chromaticAberrationPass.uniforms.uAmount.value = Math.sin(progress * Math.PI) * 0.02;
                const shake = Math.sin(progress * Math.PI) * 0.2;
                camera.position.add(new THREE.Vector3((Math.random()-0.5)*shake, (Math.random()-0.5)*shake, (Math.random()-0.5)*shake));
                

                if (progress >= 1) {
                    clearInterval(warpAnim);
                    isWarping = false;
                    if(chromaticAberrationPass) chromaticAberrationPass.uniforms.uAmount.value = 0;
                    
                    // RESET: T√ºm sistemleri k√º√ß√ºlterek unload et
                    interactables.forEach(obj => {
                        // Hedef scale'i 0 yap, animate fonksiyonu unload edecek
                        if (obj.userData.isSystem && obj.userData.isLoaded) obj.userData.targetScale = 0;
                    });

                    document.getElementById('cinematic-mode').style.display = 'none';
                    camera.fov = 75;
                    camera.updateProjectionMatrix();
                    controls.target.copy(defaultTarget);
                    updateGalaxyNameDisplay();
                    document.getElementById('reset-view-btn').style.display = 'none'; 
                }
            }, 16);
        }

        let cinematicTime = 0;
        const tempV = new THREE.Vector3(); 

        function animate() {
            requestAnimationFrame(animate);
            if(stats) stats.update();
            const rawTime = Date.now() * 0.001;
            
            // --- FREECAM MANTIƒûI ---
            updateFreeCamMovement();
            
            // YENƒ∞: Sistem √ñl√ßeklendirme Animasyonu (Render <-> Unrender Ge√ßi≈üi)
            interactables.forEach(obj => {
                if (obj.userData.isSystem && obj.userData.isLoaded && obj.userData.targetScale !== undefined) {
                    const s = obj.scale.x;
                    const t = obj.userData.targetScale;
                    const newS = THREE.MathUtils.lerp(s, t, 0.1);
                    obj.scale.set(newS, newS, newS);

                    if (t === 0 && newS < 0.05) {
                        unloadSolarSystem(obj);
                        obj.scale.set(1, 1, 1); 
                        obj.userData.targetScale = undefined;
                    } else if (t === 1 && Math.abs(newS - 1) < 0.01) {
                        obj.scale.set(1, 1, 1);
                        obj.userData.targetScale = undefined;
                    }
                }
            });

            // YENƒ∞: Uzakla≈üƒ±nca sistemleri unload et (Render optimizasyonu)
            if (!isWarping) {
                interactables.forEach(obj => {
                    if (obj.userData.isSystem && obj.userData.isLoaded) {
                        // Kilitli hedef deƒüilse direkt unload et
                        if (lockedTarget && lockedTarget !== obj) {
                            unloadSolarSystem(obj);
                            return;
                        }

                        obj.getWorldPosition(tempV);
                        const dist = camera.position.distanceTo(tempV);
                        if (dist > 5) { // Unload mesafesi d√º≈ü√ºr√ºld√º
                            obj.userData.targetScale = 0; // Animasyonlu √ßƒ±kƒ±≈ü ba≈ülat (Takƒ±lmayƒ± √∂nler)
                        }
                    }
                });
            }

            // YENƒ∞: Warp Efekti Animasyonu (Star Streak)
            if (warpLines) {
                if (isWarping) {
                    // G√∂r√ºn√ºr yap (Fade in)
                    warpLines.userData.opacity = THREE.MathUtils.lerp(warpLines.userData.opacity, 0.8, 0.05);
                    
                    const positions = warpLines.geometry.attributes.position.array;
                    const speed = 4.0; // Warp hƒ±zƒ±
                    
                    for(let i=0; i<1000; i++) {
                        let z = positions[i*6+2];
                        z += speed; // Kameraya doƒüru (veya tersine) hareket
                        if (z > 50) z = -100; // D√∂ng√º
                        
                        positions[i*6+2] = z;
                        positions[i*6+5] = z - 15.0; // √áizgiyi uzat (Streak etkisi)
                    }
                    warpLines.geometry.attributes.position.needsUpdate = true;
                    
                    // Efekti kameraya sabitle
                    warpLines.position.copy(camera.position);
                    const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
                    warpLines.lookAt(camera.position.clone().add(dir)); // Hareket y√∂n√ºne bak
                    
                } else {
                    // Gizle (Fade out)
                    warpLines.userData.opacity = THREE.MathUtils.lerp(warpLines.userData.opacity, 0, 0.1);
                }
                warpLines.material.opacity = warpLines.userData.opacity;
                warpLines.visible = warpLines.userData.opacity > 0.01;
            }

            // YENƒ∞: OLAY UFKU (EVENT HORIZON) KONTROL√ú
            if (!isWarping && !isInEventHorizon && !isFreeCam) {
                // Galaksi merkezine (0,0,0) olan uzaklƒ±k
                const distToCenter = camera.position.length();
                
                // Eƒüer merkeze √ßok yakla≈ütƒ±ysak (Karadelik yarƒ±√ßapƒ± civarƒ±)
                if (distToCenter < 2.0) {
                    isInEventHorizon = true;
                    const overlay = document.getElementById('event-horizon-overlay');
                    
                    // Efekt Ba≈ülat
                    overlay.style.opacity = 1;
                    document.body.classList.add('spaghettification'); // Titreme efekti eklenebilir
                    
                    // 2 Saniye sonra yeni evrene at
                    setTimeout(() => {
                        overlay.style.opacity = 0;
                        document.body.classList.remove('spaghettification');
                        isInEventHorizon = false;
                        
                        // Rastgele yeni bir galaksi yarat ve oraya git (Solucan deliƒüi)
                        createNewGalaxy();
                        // Kullanƒ±cƒ±ya bildirim
                        document.getElementById('event-title').innerText = "SOLUCAN DELƒ∞ƒûƒ∞";
                        document.getElementById('event-desc').innerText = "Olay ufkundan ge√ßildi. Yeni evrene ula≈üƒ±ldƒ±.";
                        document.getElementById('event-notification').style.opacity = 1;
                        setTimeout(() => { document.getElementById('event-notification').style.opacity = 0; }, 4000);
                    }, 2000);
                }
            }

            let deltaTime = 0;
            if(!isTimePaused) {
                deltaTime = 0.01 * parameters.timeSpeed; 
                cumulativeTime += deltaTime;
                
                cosmicYear += deltaTime * 50; 
                updateCosmicDateDisplay();
                
                galaxies[currentGalaxyIndex].year = cosmicYear;

                triggerCosmicEvent();
                checkGalacticCollision(); 

                galaxyGroups.forEach(group => {
                    if(group.userData.isGalaxy) {
                        group.rotation.y += parameters.rotationSpeed * 0.1 * parameters.timeSpeed; 
                    }
                });
                
                if(isCollisionActive && collisionMainGroup && collisionTargetGroup) {
                    // YENƒ∞: √ñl√ºm Sarmalƒ± Mantƒ±ƒüƒ± (Death Spiral)
                    const speed = 0.05 * Math.abs(parameters.timeSpeed);
                    
                    // Yarƒ±√ßapƒ± k√º√ß√ºlt (Yakla≈üma)
                    collisionRadius -= speed * 0.04; // Yakla≈üma hƒ±zƒ± daha da d√º≈ü√ºr√ºld√º (Daha sƒ±kƒ± sarmal)
                    
                    // A√ßƒ±yƒ± artƒ±r (D√∂n√º≈ü - Mesafe azaldƒ±k√ßa hƒ±zlanƒ±r)
                    // Kepler benzeri etki: Yarƒ±√ßap k√º√ß√ºld√ºk√ße a√ßƒ±sal hƒ±z artar
                    collisionAngle += (speed * 0.8) / (Math.max(0.1, collisionRadius) * 0.5); // D√∂n√º≈ü hƒ±zƒ± dengelendi (Strobing √∂nlendi)
                    
                    // Yeni pozisyonlarƒ± hesapla (Merkez etrafƒ±nda d√∂nerek yakla≈üma)
                    collisionMainGroup.position.x = collisionCenter.x + Math.cos(collisionAngle) * collisionRadius;
                    collisionMainGroup.position.z = collisionCenter.z + Math.sin(collisionAngle) * collisionRadius;
                    
                    // Hedef galaksi tam zƒ±t tarafta (180 derece / PI faz farkƒ±)
                    collisionTargetGroup.position.x = collisionCenter.x + Math.cos(collisionAngle + Math.PI) * collisionRadius;
                    collisionTargetGroup.position.z = collisionCenter.z + Math.sin(collisionAngle + Math.PI) * collisionRadius;
                    
                    // Kendi eksenleri etrafƒ±nda d√∂n√º≈ü√º hƒ±zlandƒ±r (Gelgit etkisi sim√ºlasyonu)
                    collisionMainGroup.rotation.y += 0.02 * (10 / Math.max(1, collisionRadius));
                    collisionTargetGroup.rotation.y += 0.02 * (10 / Math.max(1, collisionRadius));

                    // √áarpƒ±≈üma anƒ±
                    if(collisionRadius <= 0.01) { // Neredeyse temas edene kadar bekle
                        mergeGalaxies();
                        // Patlama efekti i√ßin ekstra par√ßacƒ±klar
                        for(let i=0; i<5; i++) explosions.push(new Explosion(collisionCenter, new THREE.Color(0xffaa00), 0.005, 0.8));
                    }
                }

                animatedObjects.forEach(obj => {
                    if(obj.type === 'core') obj.mesh.rotation.y += 0.01 * parameters.timeSpeed;
                    if(obj.type === 'halo' || obj.type === 'jet') {
                        if(obj.mesh.material.uniforms && obj.mesh.material.uniforms.uTime) {
                            obj.mesh.material.uniforms.uTime.value = cumulativeTime;
                        }
                    }
                    if(obj.type === 'planet') {
                        if(obj.mesh.material.uniforms && obj.mesh.material.uniforms.uTime) {
                            obj.mesh.material.uniforms.uTime.value += 0.01 * parameters.planetEvolutionSpeed * Math.abs(parameters.timeSpeed);
                        }
                        
                        // Kepler Y√∂r√ºnge Hareketi (G√ºne≈ü Sistemi i√ßindeyse)
                        if (obj.mesh.userData.orbitSpeed) {
                            obj.mesh.userData.orbitAngle += obj.mesh.userData.orbitSpeed * parameters.timeSpeed * 0.5;
                            obj.mesh.position.x = Math.cos(obj.mesh.userData.orbitAngle) * obj.mesh.userData.orbitRadius;
                            obj.mesh.position.z = Math.sin(obj.mesh.userData.orbitAngle) * obj.mesh.userData.orbitRadius;
                        }

                        obj.mesh.rotation.y += 0.002 * parameters.timeSpeed;
                        
                        // Gezegenin uydularƒ±nƒ± d√∂nd√ºr (Basit√ße gezegeni kendi ekseninde d√∂nd√ºrerek)
                        if (obj.mesh.children.length > 0) {
                            obj.mesh.rotation.y += 0.01 * parameters.timeSpeed; // Uydular i√ßin ekstra d√∂n√º≈ü
                        }
                    }
                    if(obj.type === 'halo') obj.mesh.lookAt(camera.position);
                });
            } else {
                // Zaman durduƒüunda bile halo kameraya baksƒ±n
                animatedObjects.forEach(obj => {
                    if(obj.type === 'halo') obj.mesh.lookAt(camera.position);
                });
            }
            
            // YENƒ∞: Galaksi Doƒüum Animasyonu (Scale Lerp)
            galaxyGroups.forEach(g => {
                if (g.userData.isBorn) {
                    // 0.01'den 1.0'a doƒüru yumu≈üak b√ºy√ºme (Patlama hissi)
                    g.scale.lerp(new THREE.Vector3(1, 1, 1), 0.05);
                    if (g.scale.x > 0.99) {
                        g.scale.set(1, 1, 1);
                        g.userData.isBorn = false;
                    }
                }
            });

            if (lockedTarget && !isWarping && !isFreeCam) { // Freecam'deyken kilitlenme √ßalƒ±≈ümasƒ±n
                const currentWorldPos = new THREE.Vector3();
                lockedTarget.getWorldPosition(currentWorldPos);
                
                if (!isTimePaused) {
                    const delta = currentWorldPos.clone().sub(lastTargetPos);
                    camera.position.add(delta);
                }
                controls.target.copy(currentWorldPos);
                lastTargetPos.copy(currentWorldPos);
            }
            
            interactables.forEach(planet => {
                const label = planet.userData.label;
                if(label) {
                    planet.updateWorldMatrix(true, false);
                    planet.getWorldPosition(tempV);
                    const dist = tempV.distanceTo(camera.position);
                    tempV.project(camera);
                    const x = (tempV.x * .5 + .5) * window.innerWidth;
                    const y = (tempV.y * -.5 + .5) * window.innerHeight;
                    
                    if (Math.abs(tempV.z) > 1 || dist > 25 || dist < 0.001) { // ƒ∞sim g√∂r√ºnme mesafesi artƒ±rƒ±ldƒ± (25)
                        label.style.opacity = 0;
                    } else {
                        label.style.opacity = 1;
                        label.style.left = `${x}px`;
                        label.style.top = `${y}px`;
                    }
                }
            });
            
            // YENƒ∞: Kom≈üu Galaksi Etiketlerini G√ºncelle
            galaxyGroups.forEach(g => {
                if (g.userData.isNeighbor && g.userData.label) {
                    const label = g.userData.label;
                    g.updateWorldMatrix(true, false);
                    g.getWorldPosition(tempV);
                    
                    const dist = tempV.distanceTo(camera.position);
                    
                    // Ekran pozisyonu hesapla
                    tempV.project(camera);
                    const x = (tempV.x * .5 + .5) * window.innerWidth;
                    const y = (tempV.y * -.5 + .5) * window.innerHeight;

                    // Mesafe bazlƒ± opaklƒ±k: Uzaktayken (100+) tam g√∂r√ºn√ºr, yakla≈ütƒ±k√ßa (40-) kaybolur
                    let opacity = Math.max(0, Math.min(1, (dist - 40) / 60));
                    
                    if (Math.abs(tempV.z) > 1 || opacity <= 0.01) {
                        label.style.opacity = 0;
                    } else {
                        label.style.opacity = opacity;
                        label.style.left = `${x}px`;
                        label.style.top = `${y}px`;
                    }
                }
            });

            if(parameters.cinematic && !isTimePaused) {
                cinematicTime += 0.005 * parameters.timeSpeed; // Kamera hareketi de zamanla √∂l√ßeklenir
                camera.position.x = Math.sin(cinematicTime) * 7;
                camera.position.z = Math.cos(cinematicTime * 0.7) * 7;
                camera.position.y = Math.sin(cinematicTime * 0.5) * 3 + 2;
                camera.lookAt(0,0,0);
            } else {
                if (!isFreeCam) controls.update(); // Freecam'de Orbit update'i durdur
            }
            
            if (!isTimePaused && !isCollisionActive && Math.random() < parameters.cometFrequency * Math.abs(parameters.timeSpeed)) {
                comets.push(new Comet());
            }
            
            for (let i = comets.length - 1; i >= 0; i--) { if (!comets[i].update()) comets.splice(i, 1); }
            for (let i = explosions.length - 1; i >= 0; i--) { if (!explosions[i].update()) explosions.splice(i, 1); }
            for (let i = shockwaves.length - 1; i >= 0; i--) { if (!shockwaves[i].update()) shockwaves.splice(i, 1); }
            composer.render();
        }

        const apiKey = ""; 
        async function generateStory() {
            const btn = document.getElementById('generate-btn');
            const output = document.getElementById('story-output');
            const title = document.getElementById('story-title');
            btn.disabled = true;
            
            // Y√ºkleniyor mesajƒ±nƒ± √ßevir
            document.getElementById('ai-btn-text').innerHTML = translations[currentLang].ai_analyzing;
            
            const prompt = `Sen yaratƒ±cƒ± bir yapay zekasƒ±n. "${parameters.name}" adlƒ±, ${parameters.type} t√ºr√ºndeki bu e≈üsiz galaksi i√ßin kƒ±sa, epik bir rapor yaz. √ñzellikler: Renkler ${parameters.insideColor}-${parameters.outsideColor}, ${parameters.branches} kollu. Raporu ≈üu dilde yaz: ${currentLang}`;
            
            try {
                const response = await fetchWithRetry(prompt);
                if (response) {
                    title.style.display = 'block';
                    output.innerHTML = response.replace(/\n/g, '<br>');
                } else { output.innerText = "Baƒülantƒ± hatasƒ±."; }
            } catch (error) { output.innerText = "Hata olu≈ütu."; } 
            finally {
                btn.disabled = false;
                // Butonu eski haline getir
                document.getElementById('ai-btn-text').innerHTML = translations[currentLang].ai_btn;
            }
        }

        async function fetchWithRetry(userQuery) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: userQuery }] }] }) });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (e) { return null; }
        }

        function createLandingInterface() {
            const t = translations[currentLang];
            const landing = document.getElementById('landing-page');
            
            // Sol Alt Butonlar Konteyneri
            const leftBottomContainer = document.createElement('div');
            leftBottomContainer.style.cssText = 'position: absolute; bottom: 30px; left: 30px; display: flex; gap: 15px; z-index: 2001;';

            // Patreon Button (Sol Alt)
            const patreonBtn = document.createElement('button');
            patreonBtn.id = 'landing-patreon-btn';
            patreonBtn.innerHTML = `<i class="fab fa-patreon" style="font-size: 1.2rem;"></i> ${t.landing_support}`;
            patreonBtn.style.cssText = 'background: rgba(249, 104, 84, 0.8); color: white; border: 1px solid #f96854; padding: 12px 24px; border-radius: 8px; font-family: "Space Grotesk", sans-serif; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s; backdrop-filter: blur(5px);';
            patreonBtn.onmouseover = () => { patreonBtn.style.transform = 'scale(1.05)'; patreonBtn.style.background = 'rgba(249, 104, 84, 1)'; };
            patreonBtn.onmouseout = () => { patreonBtn.style.transform = 'scale(1)'; patreonBtn.style.background = 'rgba(249, 104, 84, 0.8)'; };
            patreonBtn.onclick = () => window.open('https://www.patreon.com/c/ATOStudios', '_blank');
            
            // GitHub Button (Sol Alt - Patreon Yanƒ±)
            const githubBtn = document.createElement('button');
            githubBtn.id = 'landing-github-btn';
            githubBtn.innerHTML = `<i class="fab fa-github" style="font-size: 1.2rem;"></i> ${t.landing_github}`;
            githubBtn.style.cssText = 'background: rgba(0, 0, 0, 0.8); color: white; border: 1px solid #333; padding: 12px 24px; border-radius: 8px; font-family: "Space Grotesk", sans-serif; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s; backdrop-filter: blur(5px);';
            githubBtn.onmouseover = () => { githubBtn.style.transform = 'scale(1.05)'; githubBtn.style.background = 'rgba(0, 0, 0, 1)'; githubBtn.style.borderColor = '#666'; };
            githubBtn.onmouseout = () => { githubBtn.style.transform = 'scale(1)'; githubBtn.style.background = 'rgba(0, 0, 0, 0.8)'; githubBtn.style.borderColor = '#333'; };
            githubBtn.onclick = () => window.open('https://github.com/ATOStudios/Universal-A.T.O.', '_blank');

            leftBottomContainer.appendChild(patreonBtn);
            leftBottomContainer.appendChild(githubBtn);
            landing.appendChild(leftBottomContainer);

            // Bug Report Button (Saƒü Alt)
            const bugBtn = document.createElement('button');
            bugBtn.id = 'landing-bug-btn';
            bugBtn.innerHTML = `<i class="fas fa-bug"></i> ${t.landing_report}`;
            bugBtn.style.cssText = 'position: absolute; bottom: 30px; right: 30px; background: rgba(220, 38, 38, 0.8); color: white; border: 1px solid #ef4444; padding: 12px 24px; border-radius: 8px; font-family: "Space Grotesk", sans-serif; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s; z-index: 2001; backdrop-filter: blur(5px);';
            bugBtn.onmouseover = () => { bugBtn.style.transform = 'scale(1.05)'; bugBtn.style.background = 'rgba(220, 38, 38, 1)'; };
            bugBtn.onmouseout = () => { bugBtn.style.transform = 'scale(1)'; bugBtn.style.background = 'rgba(220, 38, 38, 0.8)'; };
            bugBtn.onclick = showBugReportModal;
            landing.appendChild(bugBtn);

            // Dil Se√ßici (Saƒü √úst)
            const langContainer = document.createElement('div');
            langContainer.style.cssText = 'position: absolute; top: 30px; right: 30px; z-index: 2001;';
            
            const langBtn = document.createElement('div');
            langBtn.innerHTML = '<i class="fas fa-globe"></i>';
            langBtn.style.cssText = 'background: rgba(15, 23, 42, 0.9); border: 1px solid #475569; color: #e2e8f0; padding: 8px; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.5);';
            langBtn.onmouseover = () => { langBtn.style.background = '#334155'; langBtn.style.color = 'white'; };
            langBtn.onmouseout = () => { langBtn.style.background = 'rgba(15, 23, 42, 0.9)'; langBtn.style.color = '#e2e8f0'; };
            
            const langDropdown = document.createElement('div');
            langDropdown.style.cssText = 'position: absolute; top: 50px; right: 0; background: rgba(15, 23, 42, 0.95); border: 1px solid #475569; border-radius: 8px; padding: 5px; display: none; flex-direction: column; width: 120px; backdrop-filter: blur(5px);';
            
            langBtn.onclick = (e) => {
                e.stopPropagation();
                langDropdown.style.display = langDropdown.style.display === 'flex' ? 'none' : 'flex';
            };

            document.addEventListener('click', () => {
                langDropdown.style.display = 'none';
            });

            const languages = [
                { code: 'tr', label: 'üáπüá∑ T√ºrk√ße' },
                { code: 'en', label: 'üá¨üáß English' },
                { code: 'fr', label: 'üá´üá∑ Fran√ßais' },
                { code: 'de', label: 'üá©üá™ Deutsch' },
                { code: 'ja', label: 'üáØüáµ Êó•Êú¨Ë™û' },
                { code: 'es', label: 'üá™üá∏ Espa√±ol' }
            ];

            languages.forEach(lang => {
                const option = document.createElement('div');
                option.innerText = lang.label;
                option.style.cssText = 'padding: 8px 12px; color: #cbd5e1; cursor: pointer; font-size: 0.8rem; border-radius: 4px; transition: background 0.2s; display: flex; align-items: center; gap: 8px;';
                option.onmouseover = () => { option.style.background = 'rgba(59, 130, 246, 0.3)'; option.style.color = 'white'; };
                option.onmouseout = () => { option.style.background = 'transparent'; option.style.color = '#cbd5e1'; };
                option.onclick = () => {
                    changeLanguage(lang.code);
                    langDropdown.style.display = 'none';
                };
                langDropdown.appendChild(option);
            });

            langContainer.appendChild(langBtn);
            langContainer.appendChild(langDropdown);
            landing.appendChild(langContainer);
        }

        function showBugReportModal() {
            if (document.getElementById('js-bug-modal')) return;
            const t = translations[currentLang];

            const overlay = document.createElement('div');
            overlay.id = 'js-bug-modal';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); z-index: 10000; display: flex; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s;';
            
            const modal = document.createElement('div');
            modal.style.cssText = 'width: 400px; background: rgba(15, 23, 42, 0.95); border: 1px solid #3b82f6; border-radius: 12px; padding: 30px; box-shadow: 0 0 50px rgba(59, 130, 246, 0.4); display: flex; flex-direction: column; gap: 15px; transform: scale(0.9); transition: transform 0.3s;';
            
            const title = document.createElement('h2');
            title.innerText = t.bug_modal_title;
            title.style.cssText = 'margin: 0; color: #60a5fa; font-family: "Space Grotesk", sans-serif; font-size: 1.5rem; font-weight: bold;';
            
            const emailInput = document.createElement('input');
            emailInput.type = 'email';
            emailInput.placeholder = t.bug_email_ph;
            emailInput.style.cssText = 'padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: white; font-family: "Segoe UI", sans-serif; outline: none;';
            emailInput.onfocus = () => emailInput.style.borderColor = '#3b82f6';
            emailInput.onblur = () => emailInput.style.borderColor = 'rgba(255, 255, 255, 0.1)';

            const subjectInput = document.createElement('input');
            subjectInput.type = 'text';
            subjectInput.placeholder = t.bug_subject_ph;
            subjectInput.style.cssText = 'padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: white; font-family: "Segoe UI", sans-serif; outline: none;';
            subjectInput.onfocus = () => subjectInput.style.borderColor = '#3b82f6';
            subjectInput.onblur = () => subjectInput.style.borderColor = 'rgba(255, 255, 255, 0.1)';

            const bugText = document.createElement('textarea');
            bugText.placeholder = t.bug_text_ph;
            bugText.rows = 5;
            bugText.style.cssText = 'padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: white; font-family: "Segoe UI", sans-serif; outline: none; resize: vertical;';
            bugText.onfocus = () => bugText.style.borderColor = '#3b82f6';
            bugText.onblur = () => bugText.style.borderColor = 'rgba(255, 255, 255, 0.1)';

            const btnContainer = document.createElement('div');
            btnContainer.style.cssText = 'display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;';

            const cancelBtn = document.createElement('button');
            cancelBtn.innerText = t.bug_cancel;
            cancelBtn.style.cssText = 'padding: 8px 20px; background: transparent; border: 1px solid #64748b; color: #94a3b8; border-radius: 6px; cursor: pointer; font-family: "Space Grotesk", sans-serif; transition: all 0.2s;';
            cancelBtn.onmouseover = () => { cancelBtn.style.borderColor = '#cbd5e1'; cancelBtn.style.color = '#cbd5e1'; };
            cancelBtn.onmouseout = () => { cancelBtn.style.borderColor = '#64748b'; cancelBtn.style.color = '#94a3b8'; };
            cancelBtn.onclick = () => {
                overlay.style.opacity = 0;
                modal.style.transform = 'scale(0.9)';
                setTimeout(() => document.body.removeChild(overlay), 300);
            };

            const sendBtn = document.createElement('button');
            sendBtn.innerText = t.bug_send;
            sendBtn.style.cssText = 'padding: 8px 25px; background: #2563eb; border: none; color: white; border-radius: 6px; cursor: pointer; font-family: "Space Grotesk", sans-serif; font-weight: bold; transition: all 0.2s;';
            sendBtn.onmouseover = () => { sendBtn.style.background = '#1d4ed8'; sendBtn.style.boxShadow = '0 0 15px rgba(37, 99, 235, 0.5)'; };
            sendBtn.onmouseout = () => { sendBtn.style.background = '#2563eb'; sendBtn.style.boxShadow = 'none'; };
            sendBtn.onclick = () => {
                if(!emailInput.value || !subjectInput.value || !bugText.value) {
                    alert(t.bug_alert_empty);
                    return;
                }

                // Formspree entegrasyonu
                // L√ºtfen https://formspree.io/ adresinden bir form olu≈üturup URL'i buraya yapƒ±≈ütƒ±rƒ±n.
                const formEndpoint = "https://formspree.io/f/xykjzjlg"; 

                sendBtn.innerText = "...";
                sendBtn.disabled = true;

                fetch(formEndpoint, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: emailInput.value, subject: subjectInput.value, message: bugText.value })
                }).then(response => {
                    if (response.ok) {
                        alert(t.bug_alert_success);
                        overlay.style.opacity = 0;
                        modal.style.transform = 'scale(0.9)';
                        setTimeout(() => document.body.removeChild(overlay), 300);
                    } else {
                        alert("Hata olu≈ütu. L√ºtfen tekrar deneyin.");
                        sendBtn.innerText = t.bug_send;
                        sendBtn.disabled = false;
                    }
                }).catch(error => {
                    alert("Baƒülantƒ± hatasƒ±: " + error);
                    sendBtn.innerText = t.bug_send;
                    sendBtn.disabled = false;
                });
            };

            btnContainer.appendChild(cancelBtn);
            btnContainer.appendChild(sendBtn);
            
            modal.appendChild(title);
            modal.appendChild(emailInput);
            modal.appendChild(subjectInput);
            modal.appendChild(bugText);
            modal.appendChild(btnContainer);
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            requestAnimationFrame(() => {
                overlay.style.opacity = 1;
                modal.style.transform = 'scale(1)';
            });
        }

        init();
    </script>
</body>

</html>
